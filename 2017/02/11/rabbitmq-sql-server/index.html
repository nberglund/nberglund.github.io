<!DOCTYPE html>
<html lang="en-us">

  <head>
  <link href="http://gmpg.org/xfn/11" rel="profile" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <meta http-equiv="content-type" content="text/html; charset=utf-8" />

  <!-- Enable responsiveness on mobile devices-->
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1" />

  <title>
    
      RabbitMQ - SQL Server &middot; Niels Berglund
    
  </title>

  


  <!-- CSS -->
  <link rel="stylesheet" href="/assets/css/main.css" />
  
  

<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Abril+Fatface" />

  <!-- Icons -->
  <link rel="apple-touch-icon-precomposed" sizes="144x144" href="/favicon.png" />
<link rel="shortcut icon" href="/favicon.ico" />

  <!-- RSS -->
  <link rel="alternate" type="application/rss+xml" title="RSS" href="/feed.xml" />

  <!-- Additional head bits without overriding original head -->
</head>


  <body class="post">

    <div id="sidebar">
  <header>
    <div class="site-title">
      <a href="/">
        
          <span class="back-arrow icon"><svg fill="#000000" height="24" viewBox="0 0 24 24" width="24" xmlns="http://www.w3.org/2000/svg">
  <path d="M0 0h24v24H0z" fill="none"/>
  <path d="M20 11H7.83l5.59-5.59L12 4l-8 8 8 8 1.41-1.41L7.83 13H20v-2z"/>
</svg></span>
        
        Niels Berglund
      </a>
    </div>
    <p class="lead">Technology musings about coding and data. Some topics: .NET, SQL Server, Data Science, R, Windows Azure and a lot more.</p>
  </header>
  <div>
    <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
<!-- Sidebar_rectangle -->
<ins class="adsbygoogle"
     style="display:inline-block;width:300px;height:250px"
     data-ad-client="ca-pub-3005153158271538"
     data-ad-slot="7704601332"></ins>
<script>
(adsbygoogle = window.adsbygoogle || []).push({});
</script>
  </div>
  <br/>
  
  <nav id="sidebar-nav-links">
  
    <a class="home-link "
        href="/">Home</a>
  
  

  

  


  

  
    
      <a class="page-link "
          href="/about/">About Me</a>
    
  

  
    
      <a class="page-link "
          href="/archive/">Posts Archive</a>
    
  

  
    
      <a class="page-link "
          href="/categories/">Categories</a>
    
  

  
    
  

  
    
      <a class="page-link "
          href="/disclaimer/">Disclaimer</a>
    
  

  
    
  

  
    
  

  

  
    
      <a class="page-link "
          href="/series/">Blog Post Series</a>
    
  

  
    
  

  
    
  

  
    
  

  
    
      <a class="page-link "
          href="/tags/">Tags</a>
    
  

  

  
    
  

  
    
  

  
    
  

  
    
  

  
    
  

  
    
  

  
    
  

  
    
  

  
    
  

  
    
  

  
    
  

  
    
  

  
    
  

  
    
  

  
    
  

  
    
  

  
    
  

  
    
  

  
    
  

  
    
  

  
    
  

  
    
  

  
    
  

  
    
  

  
    
  

  
    
  

  
    
  

  
    
  

  
    
  


  


  

  
    
  

  
    
  

  
    
  

  
    
  

  
    
  

  
    
  

  
    
  

  

  
    
  

  
    
  

  
    
  

  
    
  

  
    
  

  

  
    
  

  
    
  

  
    
  

  
    
  

  
    
  

  
    
  

  
    
  

  
    
  

  
    
  

  
    
  

  
    
  

  
    
  

  
    
  

  
    
  

  
    
  

  
    
  

  
    
  

  
    
  

  
    
  

  
    
  

  
    
  

  
    
  

  
    
  

  
    
  

  
    
  

  
    
  

  
    
  

  
    
  

  
    
  


  <!-- Optional additional links to insert in sidebar nav -->
</nav>


  
  <br/>
  <img src="/images/MVP_Logo_large.png"/>


  <section>
  <h3 style="color:#ffffff">Follow Me:</h3>
  <ul>
    <li><a href="https://twitter.com/nielsberglund" target="_blank">Twitter</a></li>
    <li><a href="http://feeds.feedburner.com/manageddata/" target="_blank">RSS/Atom Feed</a></li>
  </ul>
</section>
  
  <p>
  &copy; 2018.
  <a href="/LICENSE.md">MIT License.</a>
</p>

</div>

    <main class="container">
      <header>
  <h1 class="post-title">RabbitMQ - SQL Server</h1>
  <div class="post-subheading">
  <span class="post-date">11 Feb 2017</span>

  <span class="post-tag">
    
      <br/>
      <span class="post-tagdesc">Categories:</span>
    

    
     <a href="/categories/#SQL Server">SQL Server</a>
    
     <a href="/categories/#RabbitMQ">RabbitMQ</a>
    

      
  </span>
</div>
  <br/>
  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
<!-- Ad1 -->
<ins class="adsbygoogle"
     style="display:block"
     data-ad-client="ca-pub-3005153158271538"
     data-ad-slot="6668073777"
     data-ad-format="auto"></ins>
<script>
(adsbygoogle = window.adsbygoogle || []).push({});
</script>
</header>
<div class="content">
  <div class="post-body">
    <p>A week or two ago I came across a <a href="https://groups.google.com/forum/#!searchin/rabbitmq-users/sql$20server%7Csort:relevance/rabbitmq-users/T8fA1KdVtYE/bkRz3JkOCwAJ">post</a> on the <a href="https://groups.google.com/forum/#!forum/rabbitmq-users">RabbitMQ Users</a> forum, about how to communicate from SQL Server to RabbitMQ. Seeing that we do that a lot at <a href="/Derivco">Derivco</a>, I came with some suggestions, and also said that I was writing a blog-post about how it can be done. The part of writing was not entirely correct - at least not until now (sorry Jim, it’s been hectic at work).</p>

<!--more-->

<p><strong>SQL Server</strong> is awesome, and it is super easy to get data into the database. Getting data out is easy as well by querying the database. What is a bit tricker though is to get data out at the time the data is inserted or updated. Think real-time events; a purchase is made - someone needs to be notified about it at the very second it happens. We can arguable say that the data we are interested in should not be pushed out from the database, but from somewhere else. Sure, that is true - but quite often you don’t have a choice.</p>

<p>This was the case for <a href="/Derivco">us</a> - we needed to send events out of the database for some further processing, and the question was how to do it.</p>

<h2 id="sql-server-and-external-communication">SQL Server and External Communication</h2>

<p>There has been a couple of initiatives in SQL Server to allow for communication out of the database; <strong>SQL Server Notification Services</strong> (NS), which was introduced in SQL Server 2000, and more recently <strong>SQL Server Service Broker</strong> (SSB) introduced in SQL Server 2005. I covered both NS and SSB in the book I wrote together with Bob Beauchemin and Dan Sullivan - <a href="https://www.amazon.com/First-Look-Server-2005-Developers/dp/0321180593/ref=sr_1_1?ie=UTF8&amp;qid=1486701050&amp;sr=8-1&amp;keywords=A+First+Look+at+SQL+Server+2005+for+Developers"><em>A First Look at SQL Server 2005 for Developers</em></a>. NS was introduced in SQL Server 2000, as I mentioned, and had an overhaul in the beta releases for SQL Server 2005. However, NS was cut before SQL Server 2005 went RTM.</p>

<blockquote>
  <p><strong>NOTE:</strong> If you read the <a href="https://www.amazon.com/First-Look-Server-2005-Developers/dp/0321180593/ref=sr_1_1?ie=UTF8&amp;qid=1486701050&amp;sr=8-1&amp;keywords=A+First+Look+at+SQL+Server+2005+for+Developers">book</a>, you can find us covering a couple of features that never made it to RTM.</p>
</blockquote>

<p>SSB survived, and in SQL Server 2008 Feature Pack, Microsoft introduced <a href="https://blogs.msdn.microsoft.com/sql_service_broker/2008/11/21/announcing-service-broker-external-activator/"><strong>Service Broker External Activator</strong></a> (EA). This is a way through SSB to be able to communicate outside of the local database. The theory sounds good, but in reality, it is cumbersome and convoluted. We did some tests with it, but we quickly realized it didn’t do what we wanted. Also, SSB did not give us the performance we needed, so we had to come up with something else.</p>

<h2 id="sqlclr">SQLCLR</h2>

<p>What we came up with was based on <strong>SQLCLR</strong>. SQLCLR is where the .NET framework is embedded in the SQL engine, and you execute .NET code in the SQL Server process. Since you execute .NET code, you can <em>almost</em> do anything you can in a “normal” .NET application.</p>

<blockquote>
  <p><strong>NOTE:</strong> I wrote “almost” above, as there actually are certain limitations. For this discussion however, the limitations have <strong>almost</strong> no impact on what we want to do.</p>
</blockquote>

<p>The way SQLCLR works is that you compile your code into a dll, and you then register the <strong>assembly</strong> with SQL Server:</p>

<div class="language-sql highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">CREATE</span> <span class="n">ASSEMBLY</span> <span class="p">[</span><span class="n">RabbitMQ</span><span class="p">.</span><span class="n">SqlServer</span><span class="p">]</span>
<span class="k">AUTHORIZATION</span> <span class="n">rmq</span>
<span class="k">FROM</span> <span class="s1">'F:</span><span class="se">\s</span><span class="s1">ome_path</span><span class="se">\R</span><span class="s1">abbitMQSqlClr4.dll'</span>
<span class="k">WITH</span> <span class="n">PERMISSION_SET</span> <span class="o">=</span> <span class="n">UNSAFE</span><span class="p">;</span>
<span class="k">GO</span>
</code></pre></div></div>
<p><strong>Code Snippet 1:</strong> <em>Creating an Assembly from Absolute Path</em></p>

<p>The code does the following:</p>

<ul>
  <li><code class="highlighter-rouge">CREATE ASSEMBLY</code> - creates an assembly with a given name (whatever you want it to be).</li>
  <li><code class="highlighter-rouge">AUTHORIZATION</code> - indicates the <em>owner</em> of the assembly. In this case <code class="highlighter-rouge">rmq</code> is a pre-defined SQL Server role.</li>
  <li><code class="highlighter-rouge">FROM</code> - defines where the original assembly lives. The <code class="highlighter-rouge">FROM</code> statement can also take an UNC patch or a binary definition of the assembly. The installation files for this project uses the binary representation.</li>
  <li><code class="highlighter-rouge">WITH PERMISSION_SET</code> - sets the permissions. <code class="highlighter-rouge">UNSAFE</code> is the least restrictive, and needed in this case.</li>
</ul>

<blockquote>
  <p><strong>NOTE:</strong> Whatever role/login the <code class="highlighter-rouge">AUTHORIZATION</code> sets, will also cause an appdomain to be created with that name, as well as loading the assembly into that domain, when the assembly is loaded. It is good practice to try and keep your assemblies separated in different appdomains to prevent an error in one assembly taking down multiple assemblies. If the assemblies have dependencies on each other however, they cannot be separated in different appdomains.</p>
</blockquote>

<p>When the assembly is created you create wrappers around the .NET methods in your assembly:</p>

<div class="language-sql highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">CREATE</span> <span class="k">PROCEDURE</span> <span class="n">rmq</span><span class="p">.</span><span class="n">pr_clr_PostRabbitMsg</span> <span class="o">@</span><span class="n">EndpointID</span> <span class="n">int</span><span class="p">,</span> <span class="o">@</span><span class="n">Message</span> <span class="n">nvarchar</span><span class="p">(</span><span class="k">max</span><span class="p">)</span>
<span class="k">AS</span>
<span class="k">EXTERNAL</span> <span class="n">NAME</span>  <span class="p">[</span><span class="n">RabbitMQ</span><span class="p">.</span><span class="n">SqlServer</span><span class="p">].[</span><span class="n">RabbitMQSqlClr</span><span class="p">.</span><span class="n">RabbitMQSqlServer</span><span class="p">].[</span><span class="n">pr_clr_PostRabbitMsg</span><span class="p">];</span>
<span class="k">GO</span>
</code></pre></div></div>
<p><strong>Code Snippet 2:</strong> <em>.NET Method Wrappers</em></p>

<p>The code above does:</p>

<ul>
  <li>Create a T-SQL stored procedure named <code class="highlighter-rouge">rmq.pr_clr_PostRabbitMsg</code>, and it takes two parameters; @EndpointID and @Message.</li>
  <li>Instead of having a body, the procedure is created against an external source, which consists of:
    <ul>
      <li>An assembly named <code class="highlighter-rouge">RabbitMQ.SqlServer</code>, i.e. the assembly we created above in <em>Code Snippet 1</em>.</li>
      <li>A fully qualified type (name-space and class): <code class="highlighter-rouge">RabbitMQSqlClr.RabbitMQSqlServer</code></li>
      <li>A method in the above name-space and class: <code class="highlighter-rouge">pr_clr_PostRabbitMsg</code>.</li>
    </ul>
  </li>
</ul>

<p>When executing  the procedure <code class="highlighter-rouge">rmq.pr_clr_PostRabbitMsg</code>, the method <code class="highlighter-rouge">pr_clr_PostRabbitMsg</code> will be called.</p>

<blockquote>
  <p><strong>NOTE:</strong> When creating the procedure, the assembly name is not case sensitive, however the fully qualified type and method name are. There is no requirement that the procedure name being created are the same as the method name. However, the eventual data types for the parameters have to match.</p>
</blockquote>

<p>As I mentioned before, at <a href="/Derivco">Derivco</a> we have the requirement to send data out of SQL server, and for that we use SQLCLR and <strong><a href="http://www.rabbitmq.com/">RabbitMQ</a></strong> (RMQ).</p>

<h2 id="rabbitmq">RabbitMQ</h2>

<p>RMQ is an open source message broker software that implements the Advanced Message Queuing Protocol (AMQP), and is written in the Erlang programming language. As the RMQ is  a message broker, you need AMQP client libraries to connect to the broker. Your application references the client libraries, opens a connection and send messages - think ADO.NET to SQL Server. As opposed to ADO.NET, where you most likely opens a connection each time you communicate with the database, you will keep the connection open for the lifetime of the application.</p>

<p>So, in order to be able to communicate from the database to RabbitMQ we need an application and the .NET client library for RabbitMQ.</p>

<blockquote>
  <p><strong>NOTE:</strong> In the rest of this post three will be some code snippets showing RabbitMQ code, but there won’t be much explanation what they do. If you are new to RabbitMQ I suggest you have a look at the various <a href="http://www.rabbitmq.com/getstarted.html">RabbitMQ Tutorials</a>, to get a feel for what the code is doing. The <a href="http://www.rabbitmq.com/tutorials/tutorial-one-dotnet.html"><em>Hello World</em></a> tutorial for <em>C#</em> is a good place to start. One thing different between the tutorials and the demo code is that in the demo code no exchanges are declared. The expectation is that they are pre-defined.</p>
</blockquote>

<h2 id="rabbitmqsqlserver">RabbitMQ.SqlServer</h2>

<p><strong>RabbitMQ.SqlServer</strong> is an assembly that uses the .NET client library for RabbitMQ and exposes functionality to post messages from the database to one or more RabbitMQ endpoints (VHosts and Exchanges). The code can be downloaded/forked from my GitHub repository <a href="https://github.com/nberglund/RabbitMQ-SqlServer">RabbitMQ-SqlServer</a>. It contains source code of assemblies as well as install files (so you don’t have to build from source).</p>

<blockquote>
  <p><strong>NOTE: This is demo code, to give an idea how SQL Server can call RabbitMQ. This is NOT production ready code in any shape or form. If the code burns down your house and kills your cat - don’t blame me - it is DEMO code.</strong></p>
</blockquote>

<h3 id="functionality">Functionality</h3>

<p>When the assembly is being loaded, either due to en explicit call to initialize it - or implicit by calling wrapper procedure, the assembly loads the connection-string to the local database where the assembly is installed, as well as RabbitMQ endpoints, to which it also connects:</p>

<div class="language-cs highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">internal</span> <span class="kt">bool</span> <span class="nf">InternalConnect</span><span class="p">()</span>
<span class="p">{</span>
  <span class="k">try</span>
  <span class="p">{</span>
    <span class="n">_connFactory</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">ConnectionFactory</span><span class="p">();</span>
    <span class="n">_connFactory</span><span class="p">.</span><span class="n">Uri</span> <span class="p">=</span> <span class="n">_connString</span><span class="p">;</span>
    <span class="n">_connFactory</span><span class="p">.</span><span class="n">AutomaticRecoveryEnabled</span> <span class="p">=</span> <span class="k">true</span><span class="p">;</span>
    <span class="n">_connFactory</span><span class="p">.</span><span class="n">TopologyRecoveryEnabled</span> <span class="p">=</span> <span class="k">true</span><span class="p">;</span>
    <span class="n">RabbitConn</span> <span class="p">=</span> <span class="n">_connFactory</span><span class="p">.</span><span class="nf">CreateConnection</span><span class="p">();</span>
    

    <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">x</span> <span class="p">=</span> <span class="m">0</span><span class="p">;</span> <span class="n">x</span> <span class="p">&lt;</span> <span class="n">_channels</span><span class="p">;</span> <span class="n">x</span><span class="p">++)</span>
    <span class="p">{</span>
      <span class="kt">var</span> <span class="n">ch</span> <span class="p">=</span> <span class="n">RabbitConn</span><span class="p">.</span><span class="nf">CreateModel</span><span class="p">();</span>
      <span class="n">_rabbitChannels</span><span class="p">.</span><span class="nf">Push</span><span class="p">(</span><span class="n">ch</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="k">return</span> <span class="k">true</span><span class="p">;</span>
  <span class="p">}</span>
  <span class="k">catch</span><span class="p">(</span><span class="n">Exception</span> <span class="n">ex</span><span class="p">)</span>
  <span class="p">{</span>
    <span class="k">return</span> <span class="k">false</span><span class="p">;</span>
  <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div>
<p><strong>Code Snippet 3:</strong> <em>Connection to an Endpoint</em></p>

<p>While part of connecting to the endpoint it also creates <code class="highlighter-rouge">IModel</code>s on the connection, and these are used when posting messages:</p>

<div class="language-cs highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">internal</span> <span class="kt">bool</span> <span class="nf">Post</span><span class="p">(</span><span class="kt">string</span> <span class="n">exchange</span><span class="p">,</span> <span class="kt">byte</span><span class="p">[]</span> <span class="n">msg</span><span class="p">,</span> <span class="kt">string</span> <span class="n">topic</span><span class="p">)</span>
<span class="p">{</span>
  <span class="n">IModel</span> <span class="k">value</span> <span class="p">=</span> <span class="k">null</span><span class="p">;</span>
  <span class="kt">int</span> <span class="n">channelTryCount</span> <span class="p">=</span> <span class="m">0</span><span class="p">;</span>
  <span class="k">try</span>
  <span class="p">{</span>
    <span class="k">while</span> <span class="p">((!</span><span class="n">_rabbitChannels</span><span class="p">.</span><span class="nf">TryPop</span><span class="p">(</span><span class="k">out</span> <span class="k">value</span><span class="p">))</span> <span class="p">&amp;&amp;</span> <span class="n">channelTryCount</span> <span class="p">&lt;</span> <span class="m">100</span><span class="p">)</span>
    <span class="p">{</span>
      <span class="n">channelTryCount</span> <span class="p">+=</span> <span class="m">1</span><span class="p">;</span>
      <span class="n">Thread</span><span class="p">.</span><span class="nf">Sleep</span><span class="p">(</span><span class="m">50</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="k">if</span> <span class="p">(</span><span class="n">channelTryCount</span> <span class="p">==</span> <span class="m">100</span><span class="p">)</span>
    <span class="p">{</span>
      <span class="kt">var</span> <span class="n">errMsg</span> <span class="p">=</span> <span class="s">$"Channel pool blocked when trying to post message to Exchange: </span><span class="p">{</span><span class="n">exchange</span><span class="p">}</span><span class="s">."</span><span class="p">;</span>
      <span class="k">throw</span> <span class="k">new</span> <span class="nf">ApplicationException</span><span class="p">(</span><span class="n">errMsg</span><span class="p">);</span>
      <span class="p">}</span>

    <span class="k">value</span><span class="p">.</span><span class="nf">BasicPublish</span><span class="p">(</span><span class="n">exchange</span><span class="p">,</span> <span class="n">topic</span><span class="p">,</span> <span class="k">false</span><span class="p">,</span> <span class="k">null</span><span class="p">,</span> <span class="n">msg</span><span class="p">);</span>
    <span class="n">_rabbitChannels</span><span class="p">.</span><span class="nf">Push</span><span class="p">(</span><span class="k">value</span><span class="p">);</span>
    <span class="k">return</span> <span class="k">true</span><span class="p">;</span>

  <span class="p">}</span>
  <span class="k">catch</span> <span class="p">(</span><span class="n">Exception</span> <span class="n">ex</span><span class="p">)</span>
  <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="k">value</span> <span class="p">!=</span> <span class="k">null</span><span class="p">)</span>
    <span class="p">{</span>
      <span class="n">_rabbitChannels</span><span class="p">.</span><span class="nf">Push</span><span class="p">(</span><span class="k">value</span><span class="p">);</span>
    <span class="p">}</span>
    <span class="k">throw</span><span class="p">;</span>
  <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div>
<p><strong>Code Snippet 4:</strong> <em>Sending a Message Using an IModel</em></p>

<p>The <code class="highlighter-rouge">Post</code> method is called via the method <code class="highlighter-rouge">pr_clr_PostRabbitMsg(int endPointId, string msgToPost)</code> which is exposed as a procedure to the <code class="highlighter-rouge">CREATE PROCEDURE</code> statement in <em>Code Snippet 2</em>:</p>

<div class="language-cs highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">public</span> <span class="k">static</span> <span class="k">void</span> <span class="nf">pr_clr_PostRabbitMsg</span><span class="p">(</span><span class="kt">int</span> <span class="n">endPointId</span><span class="p">,</span> <span class="kt">string</span> <span class="n">msgToPost</span><span class="p">)</span>
<span class="p">{</span>
  <span class="k">try</span>
  <span class="p">{</span>
    <span class="k">if</span><span class="p">(</span><span class="n">endPointId</span> <span class="p">==</span> <span class="m">0</span><span class="p">)</span>
    <span class="p">{</span>
      <span class="k">throw</span> <span class="k">new</span> <span class="nf">ApplicationException</span><span class="p">(</span><span class="s">"EndpointId cannot be 0"</span><span class="p">);</span>
    <span class="p">}</span>
    <span class="k">if</span> <span class="p">(!</span><span class="n">_isInitialised</span><span class="p">)</span>
    <span class="p">{</span>
      <span class="nf">pr_clr_InitialiseRabbitMq</span><span class="p">();</span>
    <span class="p">}</span>
    <span class="kt">var</span> <span class="n">msg</span> <span class="p">=</span> <span class="n">Encoding</span><span class="p">.</span><span class="n">UTF8</span><span class="p">.</span><span class="nf">GetBytes</span><span class="p">(</span><span class="n">msgToPost</span><span class="p">);</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">endPointId</span> <span class="p">==</span> <span class="p">-</span><span class="m">1</span><span class="p">)</span>
    <span class="p">{</span>
      <span class="k">foreach</span> <span class="p">(</span><span class="kt">var</span> <span class="n">rep</span> <span class="k">in</span> <span class="n">_remoteEndpoints</span><span class="p">)</span>
      <span class="p">{</span>
        <span class="kt">var</span> <span class="n">exch</span> <span class="p">=</span> <span class="n">rep</span><span class="p">.</span><span class="n">Value</span><span class="p">.</span><span class="n">Exchange</span><span class="p">;</span>
        <span class="kt">var</span> <span class="n">topic</span> <span class="p">=</span> <span class="n">rep</span><span class="p">.</span><span class="n">Value</span><span class="p">.</span><span class="n">RoutingKey</span><span class="p">;</span>
        <span class="k">foreach</span> <span class="p">(</span><span class="kt">var</span> <span class="n">pub</span> <span class="k">in</span> <span class="n">_rabbitPublishers</span><span class="p">.</span><span class="n">Values</span><span class="p">)</span>
        <span class="p">{</span>
          <span class="n">pub</span><span class="p">.</span><span class="nf">Post</span><span class="p">(</span><span class="n">exch</span><span class="p">,</span> <span class="n">msg</span><span class="p">,</span> <span class="n">topic</span><span class="p">);</span>
        <span class="p">}</span>
      <span class="p">}</span>
    <span class="p">}</span>
    <span class="k">else</span>
    <span class="p">{</span>
      <span class="n">RabbitPublisher</span> <span class="n">pub</span><span class="p">;</span>
      <span class="k">if</span> <span class="p">(</span><span class="n">_rabbitPublishers</span><span class="p">.</span><span class="nf">TryGetValue</span><span class="p">(</span><span class="n">endPointId</span><span class="p">,</span> <span class="k">out</span> <span class="n">pub</span><span class="p">))</span>
      <span class="p">{</span>
        <span class="n">pub</span><span class="p">.</span><span class="nf">Post</span><span class="p">(</span><span class="n">_remoteEndpoints</span><span class="p">[</span><span class="n">endPointId</span><span class="p">].</span><span class="n">Exchange</span><span class="p">,</span> <span class="n">msg</span><span class="p">,</span> <span class="n">_remoteEndpoints</span><span class="p">[</span><span class="n">endPointId</span><span class="p">].</span><span class="n">RoutingKey</span><span class="p">);</span>
      <span class="p">}</span>
      <span class="k">else</span>
      <span class="p">{</span>
        <span class="k">throw</span> <span class="k">new</span> <span class="nf">ApplicationException</span><span class="p">(</span><span class="s">$"EndpointId: </span><span class="p">{</span><span class="n">endPointId</span><span class="p">}</span><span class="s">, does not exist"</span><span class="p">);</span>
      <span class="p">}</span>
    <span class="p">}</span>
  <span class="p">}</span>
  <span class="k">catch</span>
  <span class="p">{</span>
    <span class="k">throw</span><span class="p">;</span>
  <span class="p">}</span>
<span class="p">}</span>  
</code></pre></div></div>
<p><strong>Code Snippet 5:</strong> <em>Method to be Exposed as Procedure</em></p>

<p>When executing the method the assumption is that the caller sends in the id of the endpoint to which to send the message, as well as the actual message. If -1 is sent in as endpoint id, we loop through all endpoints and send it to all. The message comes in as a string and from the string we are getting bytes by using <code class="highlighter-rouge">Encoding.UTF8.GetBytes</code>. Calling <code class="highlighter-rouge">Encoding.UTF8.GetBytes</code> should in a production environment be replaced with some type of serialization.</p>

<h3 id="installation">Installation</h3>

<p>In the <em>src\sql</em> folder are all files needed for installing and running this demo code. To install:</p>

<ol>
  <li>Run the <code class="highlighter-rouge">01.create_database_and_role.sql</code> file. This creates:
    <ul>
      <li>the test database <code class="highlighter-rouge">RabbitMQTest</code> where the assembly will be created.</li>
      <li>a SQL Server <code class="highlighter-rouge">ROLE</code>: <code class="highlighter-rouge">rmq</code>, which will own the assembly when it is created.</li>
      <li>a <code class="highlighter-rouge">SCHEMA</code>, also called <code class="highlighter-rouge">rmq</code>. The various database objects are created in this schema.</li>
    </ul>
  </li>
  <li>Run <code class="highlighter-rouge">02.create_database_objects.sql</code>. This script creates:
    <ul>
      <li>a table <code class="highlighter-rouge">rmq.tb_RabbitSetting</code>, in which the local database connection string will be stored.</li>
      <li>a table <code class="highlighter-rouge">rmq.tb_RabbitEndpoint</code>, in which one or more RabbitMQ endpoints is stored.</li>
    </ul>
  </li>
  <li>Edit the <code class="highlighter-rouge">@connString</code> variable in <code class="highlighter-rouge">03.create_localhost_connstring.sql</code> to the correct connection string for the <code class="highlighter-rouge">RabbitMQTest</code> database created in step 1. Then run the script.</li>
</ol>

<p>Before continuing, you need to have an RabbitMQ broker up and running and a VHost (the default VHost <code class="highlighter-rouge">/</code> will do). We tend to have quite a few VHosts, purely for isolation purposes. The VHost also needs an exchange, in the demo code we use <code class="highlighter-rouge">amq.topic</code>. When you have a RabbitMQ broker you edit the parameters in the <code class="highlighter-rouge">rmq.pr_UpsertRabbitEndpoint</code> procedure which is in the <code class="highlighter-rouge">04.upsert_rabbit_endpoint.sql</code> file:</p>

<div class="language-sql highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">EXEC</span> <span class="n">rmq</span><span class="p">.</span><span class="n">pr_UpsertRabbitEndpoint</span> <span class="o">@</span><span class="k">Alias</span> <span class="o">=</span> <span class="s1">'rabbitEp1'</span><span class="p">,</span>
                                 <span class="o">@</span><span class="n">ServerName</span> <span class="o">=</span> <span class="s1">'RabbitServer'</span><span class="p">,</span>
                                 <span class="o">@</span><span class="n">Port</span> <span class="o">=</span> <span class="mi">5672</span><span class="p">,</span>
                                 <span class="o">@</span><span class="n">VHost</span> <span class="o">=</span> <span class="s1">'testHost'</span><span class="p">,</span>
                                 <span class="o">@</span><span class="n">LoginName</span> <span class="o">=</span> <span class="s1">'rabbitAdmin'</span><span class="p">,</span>
                                 <span class="o">@</span><span class="n">LoginPassword</span> <span class="o">=</span> <span class="s1">'some_secret_password'</span><span class="p">,</span>
                                 <span class="o">@</span><span class="n">Exchange</span> <span class="o">=</span> <span class="s1">'amq.topic'</span><span class="p">,</span>
                                 <span class="o">@</span><span class="n">RoutingKey</span> <span class="o">=</span> <span class="s1">'#'</span><span class="p">,</span>
                                 <span class="o">@</span><span class="n">ConnectionChannels</span> <span class="o">=</span> <span class="mi">5</span><span class="p">,</span>
                                 <span class="o">@</span><span class="n">IsEnabled</span> <span class="o">=</span> <span class="mi">1</span>
</code></pre></div></div>
<p><strong>Code Snippet 6:</strong> <em>Creating a RabbitMQ Endpoint</em></p>

<p>At this stage it is time to deploy the assemblies. What we deploy is different if the SQL Server version is pre SQL Server 2014 (2005, 2008, 2008R2, 2012), or version 2014 or later. The difference comes what version of CLR is supported. Pre SQL Server 2014, the .NET framework ran on version 2 of CLR, whereas for SQL Server 2014, and later, it is version 4.</p>

<h4 id="sql-server-2005---2012">SQL Server 2005 - 2012</h4>

<p>Let us start with the SQL server versions that run on CLR 2, as it is not completely straight forward what to do. We know that we need to deploy the assembly we wrote, and we also need to deploy the .NET client library assembly for RabbitMQ (<code class="highlighter-rouge">RabbitMQ.Client</code>). The RabbitMQ client library should be referenced from our assembly. As we target CLR 2, our assembly as well as the <code class="highlighter-rouge">RabbitMQ.Client</code> need to be compiled against no later .NET version than 3.5. This is where there are some issues.</p>

<p>All the later versions of the <code class="highlighter-rouge">RabbitMQ.Client</code> libraries are compiled against CLR 4, which means they cannot be used by our assembly. The latest version of the client libraries compiled against CLR 2 is 3.4.3. However, if we try to deploy that assembly we get a “nasty” error message:</p>

<p><img src="/images/posts/missing_assembly_servicemodel.png" alt="" /></p>

<p><strong>Figure 1:</strong> <em>Missing Assembly System.ServiceModel</em></p>

<p>This version of the <code class="highlighter-rouge">RabbitMQ.Client</code> references an assembly which is not part of CLR inside SQL Server. It is a WCF assembly, and when I - above - wrote of certain limitations in SQLCR, this is one of them: that particular assembly are for all intents and purposes not allowed to run within SQL Server. The latest versions of <code class="highlighter-rouge">RabbitMQ.Client</code> does not have this reference, and can therefore be used without any issues - apart from that “pesky” CLR 4 requirement. What to do?</p>

<p>Well, RabbitMQ is open source, and we are developers so, let’s recompile from source. Before the latest releases of <code class="highlighter-rouge">RabbitMQ.Client</code> (i.e for versions &lt;3.5.0) I removed the <code class="highlighter-rouge">System.ServiceModel</code> reference, and re-compiled. I did have to change a couple of lines of code which used functionality from <code class="highlighter-rouge">System.ServiceModel</code>, but it was minor changes.</p>

<p>For this demo code I did not use the 3.4.3 version, but grabbed the <a href="https://github.com/rabbitmq/rabbitmq-dotnet-client/tree/stable">3.6.6 stable release</a>, and recompiled using .NET 3.5 (CLR 2). That almost worked :), except for that later releases of <code class="highlighter-rouge">RabbitMQ.Client</code> uses <code class="highlighter-rouge">Task</code>’s, which are not part of .NET 3.5 natively.</p>

<p>Fortunately there is a version of <a href="https://www.nuget.org/packages/System.Threading.dll/"><code class="highlighter-rouge">System.Threading.dll</code></a> for .NET 3.5 which includes <code class="highlighter-rouge">Task</code>. I downloaded that, referenced it and all is good! The implication this has is that <code class="highlighter-rouge">System.Threading.dll</code> need to be installed as well as an assembly.</p>

<blockquote>
  <p><strong>NOTE:</strong> The source for the <code class="highlighter-rouge">RabbitMQ.Client</code> from which I built the .NET 3.5 version is in my <a href="https://github.com/nberglund/rabbitmq-dotnet-client-3.6.6-stable_net_3.5"><strong>RabbitMQ Client 3.6.6 .NET 3.5</strong></a> GitHub repository. The compiled dll together with the <code class="highlighter-rouge">System.Threading.dll</code> for .NET 3.5 is also in the <em>lib\NET3.5</em> folder in the <a href="https://github.com/nberglund/RabbitMQ-SqlServer">demo code (RabbitMQ-SqlServer)</a> repo.</p>
</blockquote>

<p>To install the necessary assemblies (System.Threading, RabbitMQ.Client, and RabbitMQ.SqlServer) run the install scripts from <em>src\sql</em>, in following order:</p>

<ol>
  <li><code class="highlighter-rouge">05.51.System.Threading.sql2k5-12.sql</code> - System.Threading</li>
  <li><code class="highlighter-rouge">05.52.RabbitMQ.Client.sql2k5-12.sql</code> - RabbitMQ.Client</li>
  <li><code class="highlighter-rouge">05.53.RabbitMQ.SqlServer.sql2k5-12.sql</code> - RabbitMQ.SqlServer</li>
</ol>

<h4 id="sql-server-2014">SQL Server 2014+</h4>

<p>For SQL Server 2014 and later, you compile your assembly as .NET 4.xx (the demo code is 4.5.2), and you can reference any of the later <code class="highlighter-rouge">RabbitMQ.Client</code> versions, which you can get from <a href="https://www.nuget.org/packages/RabbitMQ.Client">NuGet</a>. For the demo code I use 4.1.1. The <code class="highlighter-rouge">RabbitMQ.Client</code> is also in the <em>lib\NET4</em> folder in the <a href="https://github.com/nberglund/RabbitMQ-SqlServer">demo code (RabbitMQ-SqlServer)</a> repo.</p>

<p>To install you run the install scripts from <em>src\sql</em>, in following order:</p>

<ol>
  <li><code class="highlighter-rouge">05.141.RabbitMQ.Client.sql2k14+.sql</code> - RabbitMQ.Client</li>
  <li><code class="highlighter-rouge">05.142.RabbitMQ.SqlServer.sql2k14+.sql</code> - RabbitMQ.SqlServer</li>
</ol>

<h4 id="sql-method-wrappers">SQL Method Wrappers</h4>

<p>To create procedures that can be used from created assemblies (3.5 or 4), you run the <code class="highlighter-rouge">06.create_sqlclr_procedures.sql</code> script which creates T-SQL procedures for the three .NET methods:</p>

<ul>
  <li><code class="highlighter-rouge">rmq.pr_clr_InitialiseRabbitMq</code> calls <code class="highlighter-rouge">pr_clr_InitialiseRabbitMq</code>. Used to load and initialize the <code class="highlighter-rouge">RabbitMQ.SqlServer</code> assembly.</li>
  <li><code class="highlighter-rouge">rmq.pr_clr_ReloadRabbitEndpoints</code> calls <code class="highlighter-rouge">pr_clr_ReloadRabbitEndpoints</code>. Loads the various RabbitMQ endpoints.</li>
  <li><code class="highlighter-rouge">rmq.pr_clr_PostRabbitMsg</code> calls <code class="highlighter-rouge">pr_clr_PostRabbitMsg</code>. Used to post a message to RabbitMQ.</li>
</ul>

<p>The script also creates a “pure” T-SQL procedure - <code class="highlighter-rouge">rmq.pr_PostRabbitMsg</code> - which executes against the <code class="highlighter-rouge">rmq.pr_clr_PostRabbitMsg</code>. This procedure is a “wrapper”, which knows what to do with the data and handles errors etc. In production we have multiple procedures like this, handling different types of messages. More about that in <strong>Usage</strong> below.</p>

<h3 id="usage">Usage</h3>

<p>From all of the above we can see that to post a message to RabbitMQ we call the <code class="highlighter-rouge">rmq.pr_PostRabbitMsg</code> or <code class="highlighter-rouge">rmq.pr_clr_PostRabbitMsg</code> with an endpoint id and the message in string format. That is cool, but how would it be used in the “real world”.</p>

<p>What <a href="/Derivco">we</a> do in the production systems - in the stored procedures that processes data and the data should be sent to RabbitMQ - is to build up the data we want to send and then in a “hook point” we call the equivalent of <code class="highlighter-rouge">rmq.pr_PostRabbitMsg</code>. Below is a very simplified example of such a procedure:</p>

<div class="language-sql highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">ALTER</span> <span class="k">PROCEDURE</span> <span class="n">dbo</span><span class="p">.</span><span class="n">pr_SomeProcessingStuff</span> <span class="o">@</span><span class="n">id</span> <span class="n">int</span>
<span class="k">AS</span>
<span class="k">BEGIN</span>
  <span class="k">SET</span> <span class="n">NOCOUNT</span> <span class="k">ON</span><span class="p">;</span>
  <span class="k">BEGIN</span> <span class="n">TRY</span>
    <span class="c1">--create a variable for the endpoint</span>
    <span class="k">DECLARE</span> <span class="o">@</span><span class="n">endPointId</span> <span class="n">int</span><span class="p">;</span>
    <span class="c1">--create a variable for the message</span>
    <span class="k">DECLARE</span> <span class="o">@</span><span class="n">msg</span> <span class="n">nvarchar</span><span class="p">(</span><span class="k">max</span><span class="p">)</span> <span class="o">=</span> <span class="s1">'{'</span>
    <span class="c1">--do important stuff, and collect data for the message</span>
    <span class="k">SET</span> <span class="o">@</span><span class="n">msg</span> <span class="o">=</span> <span class="o">@</span><span class="n">msg</span> <span class="o">+</span> <span class="s1">'"Id":'</span> <span class="o">+</span> <span class="k">CAST</span><span class="p">(</span><span class="o">@</span><span class="n">id</span> <span class="k">AS</span> <span class="n">varchar</span><span class="p">(</span><span class="mi">10</span><span class="p">))</span> <span class="o">+</span> <span class="s1">','</span>
    <span class="c1">-- do some more stuff</span>
    <span class="k">SET</span> <span class="o">@</span><span class="n">msg</span> <span class="o">=</span> <span class="o">@</span><span class="n">msg</span> <span class="o">+</span> <span class="s1">'"FName":"Hello",'</span><span class="p">;</span>
    <span class="k">SET</span> <span class="o">@</span><span class="n">msg</span> <span class="o">=</span> <span class="o">@</span><span class="n">msg</span> <span class="o">+</span> <span class="s1">'"LName":"World"'</span><span class="p">;</span>
    <span class="k">SET</span> <span class="o">@</span><span class="n">msg</span> <span class="o">=</span> <span class="o">@</span><span class="n">msg</span> <span class="o">+</span> <span class="s1">'}'</span><span class="p">;</span>

    <span class="c1">--do more stuff</span>
    <span class="c1">-- get the endpoint id from somewhere, based on something</span>
    <span class="k">SELECT</span> <span class="o">@</span><span class="n">endPointId</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
    <span class="c1">--here is the hook-point</span>
    <span class="c1">--call the procedure to send the message</span>
    <span class="k">EXEC</span> <span class="n">rmq</span><span class="p">.</span><span class="n">pr_PostRabbitMsg</span> <span class="o">@</span><span class="n">Message</span> <span class="o">=</span> <span class="o">@</span><span class="n">msg</span><span class="p">,</span> <span class="o">@</span><span class="n">EndpointID</span> <span class="o">=</span> <span class="o">@</span><span class="n">endPointId</span><span class="p">;</span>
  <span class="k">END</span> <span class="n">TRY</span>
  <span class="k">BEGIN</span> <span class="n">CATCH</span>
    <span class="k">DECLARE</span> <span class="o">@</span><span class="n">errMsg</span> <span class="n">nvarchar</span><span class="p">(</span><span class="k">max</span><span class="p">);</span>
    <span class="k">DECLARE</span> <span class="o">@</span><span class="n">errLine</span> <span class="n">int</span><span class="p">;</span>
    <span class="k">SELECT</span> <span class="o">@</span><span class="n">errMsg</span> <span class="o">=</span> <span class="n">ERROR_MESSAGE</span><span class="p">(),</span> <span class="o">@</span><span class="n">errLine</span> <span class="o">=</span> <span class="n">ERROR_LINE</span><span class="p">();</span>
    <span class="n">RAISERROR</span><span class="p">(</span><span class="s1">'Error: %s at line: %d'</span><span class="p">,</span> <span class="mi">16</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="o">@</span><span class="n">errMsg</span><span class="p">,</span> <span class="o">@</span><span class="n">errLine</span><span class="p">);</span>
  <span class="k">END</span> <span class="n">CATCH</span>
<span class="k">END</span>
</code></pre></div></div>
<p><strong>Code Snippet 7:</strong> <em>Procedure with Hook-point</em></p>

<p>In <em>Code Snippet 7</em> we see how the data to be sent is captured in the procedure, and when processing is done the data is sent. To use this procedure execute the <code class="highlighter-rouge">07.create_processing_procedure.sql</code> script in the <em>src\sql</em> folder.</p>

<h3 id="make-it-all-happen">Make it All Happen</h3>

<p>At this stage you should now be ready to send some messages. Before you test it, make sure you have a RabbitMQ queue bound to the exchange your end-point in <code class="highlighter-rouge">rmq.tb_RabbitEndpoint</code> points to.</p>

<p>So, to test this:</p>

<ul>
  <li>Open the script file <code class="highlighter-rouge">99.test_send_message.sql</code>.</li>
  <li>Execute <code class="highlighter-rouge">EXEC rmq.pr_clr_InitialiseRabbitMq;</code>, to initialize the assembly and load the RabbitMQ endpoints. This is not necessarily required, but it is good practice to “pre-load” the assembly after it has been created or altered.</li>
  <li>Execute <code class="highlighter-rouge">EXEC dbo.pr_SomeProcessingStuff @id = 101</code> (use any id value you want).</li>
</ul>

<p>If no errors happened you should now see a message in your bound queue in the RabbitMQ broker! Congratulations, you have now used SQLCLR to send a message to a RabbitMQ broker.</p>

<p>If you have comments, questions etc., please comment on this post or <a href="mailto:niels.it.berglund@gmail.com">ping</a> me.</p>



    
<p>
<h2>Share this Post:</h2> 
<a href="https://twitter.com/intent/tweet?url=http://nielsberglund.com/2017/02/11/rabbitmq-sql-server/&text=RabbitMQ - SQL Server&via=nielsberglund" 
   target="_blank">Twitter</a>
<a href="https://plus.google.com/share?url=http://www.nielsberglund.com//2017/02/11/rabbitmq-sql-server/" 
   onclick="javascript:window.open(this.href,'', 'menubar=no,toolbar=no,resizable=yes,scrollbars=yes,height=600,width=600');return false;">
    | Google+</a>
<a href="https://www.linkedin.com/shareArticle?
         mini=true
         &url=http://www.nielsberglund.com/2017/02/11/rabbitmq-sql-server/
         &title=RabbitMQ - SQL Server
         &summary=Blog post: SQL Server to RabbitMQ. A post about how SQL Server can communicate with RabbitMQ to push data out of the database.
         &source=http://www.nielsberglund.com/2017/02/11/rabbitmq-sql-server/"> | LinkedIn</a> 

</p>   
   <!--<script async src="//platform.twitter.com/widgets.js" charset="utf-8"></script>

   http://www.linkedin.com/shareArticle?mini=true&url=<URL>&title=<TITILE>&summary=<DESCRIPTION>&sourc


   https://www.linkedin.com/shareArticle?mini=true&url=http://nielsberglund.com/2017/02/11/rabbitmq-sql-server/

   -->



    <p>
<h2>Blog Feed:</h2>
To automatically receive more posts like this, please
<a href="http://feeds.feedburner.com/manageddata/" target="_blank"> subscribe to my RSS/Atom feed</a> in your feed reader!</p>


    <br/>
    <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
<!-- Ad2 -->
<ins class="adsbygoogle"
     style="display:block"
     data-ad-client="ca-pub-3005153158271538"
     data-ad-slot="1158080725"
     data-ad-format="auto"></ins>
<script>
(adsbygoogle = window.adsbygoogle || []).push({});
</script>
    <br/>

    


  

  

  

  

  

  

  

  

  

  

  

  

  

  
    
    <h2>Post Tags:</h2>
  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  


<div class="post-tags">
  
    
    <a href="/tags/#sql-server">
    
      <span class="icon">
        <svg fill="#000000" height="24" viewBox="0 0 24 24" width="24" xmlns="http://www.w3.org/2000/svg">
    <path d="M0 0h24v24H0z" fill="none"/>
    <path d="M17.63 5.84C17.27 5.33 16.67 5 16 5L5 5.01C3.9 5.01 3 5.9 3 7v10c0 1.1.9 1.99 2 1.99L16 19c.67 0 1.27-.33 1.63-.84L22 12l-4.37-6.16z"/>
</svg>
      </span>&nbsp;<span class="tag-name">SQL Server</span>
    </a>
  
    
    <a href="/tags/#rabbitmq">
    
      <span class="icon">
        <svg fill="#000000" height="24" viewBox="0 0 24 24" width="24" xmlns="http://www.w3.org/2000/svg">
    <path d="M0 0h24v24H0z" fill="none"/>
    <path d="M17.63 5.84C17.27 5.33 16.67 5 16 5L5 5.01C3.9 5.01 3 5.9 3 7v10c0 1.1.9 1.99 2 1.99L16 19c.67 0 1.27-.33 1.63-.84L22 12l-4.37-6.16z"/>
</svg>
      </span>&nbsp;<span class="tag-name">RabbitMQ</span>
    </a>
  
    
    <a href="/tags/#message-brokers">
    
      <span class="icon">
        <svg fill="#000000" height="24" viewBox="0 0 24 24" width="24" xmlns="http://www.w3.org/2000/svg">
    <path d="M0 0h24v24H0z" fill="none"/>
    <path d="M17.63 5.84C17.27 5.33 16.67 5 16 5L5 5.01C3.9 5.01 3 5.9 3 7v10c0 1.1.9 1.99 2 1.99L16 19c.67 0 1.27-.33 1.63-.84L22 12l-4.37-6.16z"/>
</svg>
      </span>&nbsp;<span class="tag-name">message brokers</span>
    </a>
  
    
    <a href="/tags/#streaming">
    
      <span class="icon">
        <svg fill="#000000" height="24" viewBox="0 0 24 24" width="24" xmlns="http://www.w3.org/2000/svg">
    <path d="M0 0h24v24H0z" fill="none"/>
    <path d="M17.63 5.84C17.27 5.33 16.67 5 16 5L5 5.01C3.9 5.01 3 5.9 3 7v10c0 1.1.9 1.99 2 1.99L16 19c.67 0 1.27-.33 1.63-.84L22 12l-4.37-6.16z"/>
</svg>
      </span>&nbsp;<span class="tag-name">streaming</span>
    </a>
  
</div>
  </div>

  
  <section class="comments">
    <h2>Comments</h2>
    
  <div id="disqus_thread">
    <button class="disqus-load" onClick="loadDisqusComments()">
      Load Comments
    </button>
  </div>
  <script>

  /**
  *  RECOMMENDED CONFIGURATION VARIABLES: EDIT AND UNCOMMENT THE SECTION BELOW
  *  TO INSERT DYNAMIC VALUES FROM YOUR PLATFORM OR CMS.
  *  LEARN WHY DEFINING THESE VARIABLES IS IMPORTANT:s
  *  https://disqus.com/admin/universalcode/#configuration-variables
  */
  var disqus_config = function () {
    this.page.url = "http://nielsberglund.com/2017/02/11/rabbitmq-sql-server/";
    this.page.identifier = "" ||
                           "http://nielsberglund.com/2017/02/11/rabbitmq-sql-server/";
  }
  function loadDisqusComments() { // DON'T EDIT BELOW THIS LINE
    var d = document, s = d.createElement('script');
    s.src = '//manageddata.disqus.com/embed.js';
    s.setAttribute('data-timestamp', +new Date());
    (d.head || d.body).appendChild(s);
  }
  </script>
  <noscript>
    Please enable JavaScript to view the
    <a href="https://disqus.com/?ref_noscript">comments powered by Disqus</a>.
  </noscript>



  </section>

  <section class="related">
  <h2>Related Posts</h2>
  <ul class="posts-list">
    
      <li>
        <h3>
          <a href="/2018/08/05/interesting-stuff-week-31/">
            Interesting Stuff - Week 31
            <small>05 Aug 2018</small>
          </a>
        </h3>
      </li>
    
      <li>
        <h3>
          <a href="/2018/08/04/sp-execute-external-script-and-sql-compute-context-iii/">
            sp_execute_external_script and SQL Compute Context - III
            <small>04 Aug 2018</small>
          </a>
        </h3>
      </li>
    
      <li>
        <h3>
          <a href="/2018/07/29/interesting-stuff-week-30/">
            Interesting Stuff - Week 30
            <small>29 Jul 2018</small>
          </a>
        </h3>
      </li>
    
  </ul>
</section>

</div>

    </main>
    <script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-18914734-2', 'auto');
  ga('send', 'pageview');

</script>

    <!-- Optional footer content -->

  </body>
</html>
