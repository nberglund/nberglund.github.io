<!DOCTYPE html> <html lang="en-us"> <head> <link href="http://gmpg.org/xfn/11" rel="profile"> <meta http-equiv="X-UA-Compatible" content="IE=edge"> <meta http-equiv="content-type" content="text/html; charset=utf-8"> <!-- Enable responsiveness on mobile devices--> <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1"> <title> Using F# in SQLCLR &middot; MANAGED DATA </title> <!-- CSS --> <link rel="stylesheet" href="/public/css/poole.css"> <link rel="stylesheet" href="/public/css/syntax.css"> <link rel="stylesheet" href="/public/css/hyde.css"> <link rel="stylesheet" href="http://fonts.googleapis.com/css?family=PT+Sans:400,400italic,700|Abril+Fatface"> <!-- Icons --> <link rel="apple-touch-icon-precomposed" sizes="144x144" href="/public/apple-touch-icon-144-precomposed.png"> <link rel="shortcut icon" href="/public/favicon.ico"> <!-- RSS --> <link rel="alternate" type="application/rss+xml" title="RSS" href="/atom.xml"> <link href='/stylesheets/all-4ea1a6dda72a418bf18a844155e0bba5.css' media='all' rel='stylesheet' type='text/css'> <!-- Begin Jekyll SEO tag v2.2.0 --> <title>Using F# in SQLCLR | MANAGED DATA</title> <meta property="og:title" content="Using F# in SQLCLR" /> <meta name="author" content="nielsb" /> <meta property="og:locale" content="en_US" /> <meta name="description" content="Recently I have become very interested in F# and I am at the moment trying to get to grips with it. It is definitely a different beast than C#, but so far I like it - a lot! Anyway, I am a SQL nerd, and many moons ago I was very heavily involved in SQLCLR (for you who don&#39;t know what that is; it is the ability to run .NET code inside the SQL Server engine. It was first introduced with SQL Server 2005). So I thought it would be a &quot;giggle&quot; to see if I could get some F# code running inside SQL Server." /> <meta property="og:description" content="Recently I have become very interested in F# and I am at the moment trying to get to grips with it. It is definitely a different beast than C#, but so far I like it - a lot! Anyway, I am a SQL nerd, and many moons ago I was very heavily involved in SQLCLR (for you who don&#39;t know what that is; it is the ability to run .NET code inside the SQL Server engine. It was first introduced with SQL Server 2005). So I thought it would be a &quot;giggle&quot; to see if I could get some F# code running inside SQL Server." /> <link rel="canonical" href="http://nielsberglund.com//2010/11/15/using-fsharp-in-sqlclr/" /> <meta property="og:url" content="http://nielsberglund.com//2010/11/15/using-fsharp-in-sqlclr/" /> <meta property="og:site_name" content="MANAGED DATA" /> <meta property="og:type" content="article" /> <meta property="article:published_time" content="2010-11-15T09:27:56+02:00" /> <script type="application/ld+json"> {"@context": "http://schema.org", "@type": "BlogPosting", "headline": "Using F# in SQLCLR", "author": {"@type": "Person", "name": "nielsb"}, "datePublished": "2010-11-15T09:27:56+02:00", "description": "Recently I have become very interested in F# and I am at the moment trying to get to grips with it. It is definitely a different beast than C#, but so far I like it - a lot! Anyway, I am a SQL nerd, and many moons ago I was very heavily involved in SQLCLR (for you who don&#39;t know what that is; it is the ability to run .NET code inside the SQL Server engine. It was first introduced with SQL Server 2005). So I thought it would be a &quot;giggle&quot; to see if I could get some F# code running inside SQL Server.", "mainEntityOfPage": {"@type": "WebPage", "@id": "http://nielsberglund.com//2010/11/15/using-fsharp-in-sqlclr/"}, "url": "http://nielsberglund.com//2010/11/15/using-fsharp-in-sqlclr/"}</script> <!-- End Jekyll SEO tag --> </head> <body> <div class="sidebar"> <div class="container sidebar-sticky"> <div class="sidebar-about"> <h1> <a href="/"> MANAGED DATA </a> </h1> <p class="lead">Technology musings about coding and data. Topics covered are - amongst others - .NET, SQL Server, Data Science, R, Windows Azure and a lot more.</p> </div> <nav class="sidebar-nav"> <a class="sidebar-nav-item" href="/">Home</a> <a class="sidebar-nav-item" href="/about/">About</a> <a class="sidebar-nav-item" href="/archive/">Posts Archive</a> </nav> <section> <h3 style="color:#ffffff">Follow Me:</h3> <ul> <li><a href="https://twitter.com/nielsberglund" target="_blank">Twitter</a></li> <li><a href="http://feeds.feedburner.com/manageddata/" target="_blank">RSS/Atom Feed</a></li> </ul> </section> <section> <h3 style="color:#ffffff">Disclaimer</h3> <p>This is my personal blog. The views expressed on these pages are mine alone and not those of my employer.</p> </section> <p>&copy; 2017. All rights reserved.</p> <div class="sidebar-social"> <div><a href="https://github.com/nberglund"> GitHub </a></div> <div><a href="https://twitter.com/nielsberglund"> Twitter </a></div> <div><a href="https://za.linkedin.com/in/niels-berglund-0122593"> LinkedIn </a></div> <div><a href="https://plus.google.com/u/0/109374849138720664008"> Google+ </a></div> </div> </div> </div> <div class="content container"> <div class="post"> <h1 class="post-title">Using F# in SQLCLR</h1> <div class="post-subheading"> <span class="post-date">15 Nov 2010</span> <span class="post-tag"> <span class="post-tagdesc">in categories:</span> .NET SQL Server <span class="post-tagdesc">tags:</span> F# SQLCLR </span> </div> <p>Recently I have become very interested in F# and I am at the moment trying to get to grips with it. It is definitely a different beast than C#, but so far I like it - a lot!</p> <p>Anyway, I am a SQL nerd, and many moons ago I was very heavily involved in SQLCLR (for you who don't know what that is; it is the ability to run .NET code inside the SQL Server engine. It was first introduced with SQL Server 2005). So I thought it would be a "giggle" to see if I could get some F# code running inside SQL Server.</p> <!--more--> <p>I created the simplest of the simple F# dll's. SQLCLR requires you have a public class and your publicly exposed SQLCLR methods to be static, so my F# code looked like so:</p> <p><figure class='code-highlight-figure'><figcaption class='code-highlight-caption'><span class='code-highlight-caption-title'>Avesome Stuff</span></figcaption><div class='code-highlight'><pre class='code-highlight-pre'><div data-line='1' class='code-highlight-row numbered'><div class='code-highlight-line'>namespace ManagedData.Samples.FSharp
</div></div><div data-line='2' class='code-highlight-row numbered'><div class='code-highlight-line'>  type SqlClr =
</div></div><div data-line='3' class='code-highlight-row numbered'><div class='code-highlight-line'>    static member Adder a b = a + b
</div></div><div data-line='4' class='code-highlight-row numbered'><div class='code-highlight-line'>    static member Factorial n =
</div></div><div data-line='5' class='code-highlight-row numbered'><div class='code-highlight-line'>      match n with
</div></div><div data-line='6' class='code-highlight-row numbered'><div class='code-highlight-line'>      | 0  ->; 1
</div></div><div data-line='7' class='code-highlight-row numbered'><div class='code-highlight-line'>      | _ -> n * (SqlClr.Factorial( n - 1))</div></div></pre></div></figure></p> <p>As you can see my class is extremely advanced (not); it has two methods:</p> <ul> <li>The canonical <code>Adder</code> method (every SQLCLR dll has to have an <code>Adder</code> method, it's the law - nah, I'm just kidding), which takes two integers and returns an integer.</li> <li>A factorial method, which takes an integer and calculates the factorial from that.</li> </ul> <p>By the way, any pointers about how to write efficient F# code are very welcome .</p> <p>Having written and compiled the code, it was time to deploy! When running .NET code in SQL Server, you need to deploy your assembly to the database you want to execute your code in, and SQL Server will actually load the assembly from the database. In fact most assemblies are loaded from the database, even quite a few of Microsoft's own system assemblies which normally are loaded from the GAC. There are only about 13 system assemblies that are allowed to be loaded from the GAC these are known as the "blessed list". You also need to create T-SQL wrapper objects (procedures, functions, triggers, etc.) around the methods you want to publicly expose.</p> <p>In my SQL Server 2008R2 instance I created a database in which I wanted my F# assembly to, and then it was time to deploy. You can deploy in several ways, the easiest is something like this (in the database you want to use):</p> <p><figure class='code-highlight-figure'><div class='code-highlight'><pre class='code-highlight-pre'><div data-line='1' class='code-highlight-row numbered'><div class='code-highlight-line'><span class="k">CREATE</span> <span class="n">ASSEMBLY</span> <span class="n">fsasm</span>
</div></div><div data-line='2' class='code-highlight-row numbered'><div class='code-highlight-line'><span class="k">FROM</span> <span class="s1">'c:</span><span class="se">\</span><span class="s1">repos</span><span class="se">\</span><span class="s1">F#</span><span class="se">\</span><span class="s1">testcode</span><span class="se">\</span><span class="s1">fssqlclr</span><span class="se">\</span><span class="s1">fslib</span><span class="se">\b</span><span class="s1">in</span><span class="se">\</span><span class="s1">debug</span><span class="se">\</span><span class="s1">fslib.dll'</span>
</div></div><div data-line='3' class='code-highlight-row numbered'><div class='code-highlight-line'><span class="k">WITH</span> <span class="n">permission_set</span> <span class="o">=</span> <span class="n">SAFE</span><span class="p">;</span>
</div></div><div data-line='4' class='code-highlight-row numbered'><div class='code-highlight-line'><span class="k">GO</span></div></div></pre></div></figure></p> <p>The problem with the code above is that F# projects have a dependency on the assembly <code>FSharp.Core.dll</code>, so when I tried to deploy my assembly as per above, I got an exception. What I had to do was to deploy <code>FSharp.Core.dll</code> to my database first:</p> <p><figure class='code-highlight-figure'><div class='code-highlight'><pre class='code-highlight-pre'><div data-line='1' class='code-highlight-row numbered'><div class='code-highlight-line'><span class="k">CREATE</span> <span class="n">ASSEMBLY</span> <span class="n">fsasm</span>
</div></div><div data-line='2' class='code-highlight-row numbered'><div class='code-highlight-line'><span class="k">FROM</span> <span class="s1">'C:</span><span class="se">\</span><span class="s1">path to ...</span><span class="se">\</span><span class="s1">FSharp.Core.dll'</span>
</div></div><div data-line='3' class='code-highlight-row numbered'><div class='code-highlight-line'><span class="k">WITH</span> <span class="n">permission_set</span> <span class="o">=</span> <span class="n">UNSAFE</span><span class="p">;</span>
</div></div><div data-line='4' class='code-highlight-row numbered'><div class='code-highlight-line'><span class="k">GO</span></div></div></pre></div></figure></p> <p>Notice the use of <code>permission_set = UNSAFE</code>, this is to tell SQL Server that I know what I am doing and SQL Server should keep from doing a lot if validation. When I had catalogued the <code>FSharp.Core.dll</code> assembly I had no problems deploying my assembly to the database.</p> <p>All there remained to do now was to create the T-SQL wrapper object(s) around my F# methods. This is done with "normal" <code>CREATE ...</code> syntax. The code for my factorial looks like so:</p> <p><figure class='code-highlight-figure'><div class='code-highlight'><pre class='code-highlight-pre'><div data-line='1' class='code-highlight-row numbered'><div class='code-highlight-line'><span class="k">CREATE</span> <span class="k">FUNCTION</span> <span class="n">FsFactorial</span><span class="p">(</span><span class="o">@</span><span class="n">x</span> <span class="n">int</span><span class="p">)</span>
</div></div><div data-line='2' class='code-highlight-row numbered'><div class='code-highlight-line'><span class="k">RETURNS</span> <span class="n">int</span>
</div></div><div data-line='3' class='code-highlight-row numbered'><div class='code-highlight-line'><span class="k">EXTERNAL</span> <span class="n">NAME</span> <span class="n">fsasm</span><span class="p">.[</span><span class="n">ManagedData</span><span class="p">.</span><span class="n">Samples</span><span class="p">.</span><span class="n">FSharp</span><span class="p">.</span><span class="n">SqlClr</span><span class="p">].</span><span class="n">Factorial</span><span class="p">;</span>
</div></div><div data-line='4' class='code-highlight-row numbered'><div class='code-highlight-line'><span class="k">GO</span></div></div></pre></div></figure></p> <p>This also went without problems, so now it is "crunch-time". Can I execute a F# method in SQLCLR?</p> <p><figure class='code-highlight-figure'><div class='code-highlight'><pre class='code-highlight-pre'><div data-line='1' class='code-highlight-row numbered'><div class='code-highlight-line'><span class="k">SELECT</span> <span class="n">dbo</span><span class="p">.</span><span class="n">FsFactorial</span><span class="p">(</span><span class="mi">4</span><span class="p">);</span></div></div></pre></div></figure></p> <p>Lo and behold, it executed and I received 24 back! I had just now executed F# running inside SQL Server!!</p> <p>So, what does this prove? Nothing really, it was just an exercise from me to see if it could be done. However, F# is really suitable for quite a few tasks you would want to use SQLCLR for, so it now gives a database developer another tool in his tool-belt.</p> <p>If anyone is interested in the full code for this, please drop me a comment and I'll email it to you.</p> <p> <h2>Share this Post:</h2> <a href="https://twitter.com/intent/tweet?url=http://nielsberglund.com/2010/11/15/using-fsharp-in-sqlclr/&text=Using F# in SQLCLR&via=nielsberglund" target="_blank">Twitter</a> <a href="https://plus.google.com/share?url=http://www.nielsberglund.com//2010/11/15/using-fsharp-in-sqlclr/" onclick="javascript:window.open(this.href,'', 'menubar=no,toolbar=no,resizable=yes,scrollbars=yes,height=600,width=600');return false;"> | Google+</a> <a href="https://www.linkedin.com/shareArticle? mini=true &url=http://www.nielsberglund.com/2010/11/15/using-fsharp-in-sqlclr/ &title=Using F# in SQLCLR &summary=Blog post: &source=http://www.nielsberglund.com/2010/11/15/using-fsharp-in-sqlclr/"> | LinkedIn</a> </p> <!--<script async src="//platform.twitter.com/widgets.js" charset="utf-8"></script> http://www.linkedin.com/shareArticle?mini=true&url=<URL>&title=<TITILE>&summary=<DESCRIPTION>&sourc https://www.linkedin.com/shareArticle?mini=true&url=http://nielsberglund.com/2010/11/15/using-fsharp-in-sqlclr/ --> <p> <h2>Blog Feed:</h2> To automatically receive more posts like this, please <a href="http://feeds.feedburner.com/manageddata/" target="_blank"> subscribe to my RSS/Atom feed</a> in your feed reader!</p> </div> <div class="related"> <h2>Related Posts</h2> </div> <div id="disqus_thread"></div> <script> var disqus_developer = 1; (function() { /*DON'T EDIT BELOW THIS LINE*/ var d = document, s = d.createElement('script'); s.src = '//manageddata.disqus.com/embed.js'; s.setAttribute('data-timestamp', +new Date()); (d.head || d.body).appendChild(s); })(); </script> <noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript" rel="nofollow">comments powered by Disqus.</a></noscript> </div> <script> (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){ (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o), m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m) })(window,document,'script','//www.google-analytics.com/analytics.js','ga'); ga('create', 'UA-18914734-2', 'auto'); ga('send', 'pageview'); </script> </body> </html>
