<!DOCTYPE html> <html lang="en-us"> <head> <link href="http://gmpg.org/xfn/11" rel="profile"> <meta http-equiv="X-UA-Compatible" content="IE=edge"> <meta http-equiv="content-type" content="text/html; charset=utf-8"> <!-- Enable responsiveness on mobile devices--> <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1"> <title> New T-SQL Features in SQL 11 / Denali - Error Handling &middot; MANAGED DATA </title> <!-- CSS --> <link rel="stylesheet" href="/public/css/poole.css"> <link rel="stylesheet" href="/public/css/syntax.css"> <link rel="stylesheet" href="/public/css/hyde.css"> <link rel="stylesheet" href="http://fonts.googleapis.com/css?family=PT+Sans:400,400italic,700|Abril+Fatface"> <!-- Icons --> <link rel="apple-touch-icon-precomposed" sizes="144x144" href="/public/apple-touch-icon-144-precomposed.png"> <link rel="shortcut icon" href="/public/favicon.ico"> <!-- RSS --> <link rel="alternate" type="application/rss+xml" title="RSS" href="/atom.xml"> <link href='/stylesheets/all-8aac91bf76fd8197e7ec41da1b285399.css' media='all' rel='stylesheet' type='text/css'> <!-- Begin Jekyll SEO tag v2.2.0 --> <title>New T-SQL Features in SQL 11 / Denali - Error Handling | MANAGED DATA</title> <meta property="og:title" content="New T-SQL Features in SQL 11 / Denali - Error Handling" /> <meta name="author" content="nielsb" /> <meta property="og:locale" content="en_US" /> <meta name="description" content="A couple of days ago I wrote my wish-list to Santa what I wanted to see in next version of SQL Server (SQL 11 / Denali). I was pleasantly surprised that I could find out for myself shortly after; i.e. SQL Server Denali CTP1 was released during the PASS Summit. I have literally finished installing the next version of SQL Server (Denali / SQL 11) on a new VM, like 10 minutes ago, and I have done a quick check of the new features of SQL Server Denali (what I could find at least) against my wish-list." /> <meta property="og:description" content="A couple of days ago I wrote my wish-list to Santa what I wanted to see in next version of SQL Server (SQL 11 / Denali). I was pleasantly surprised that I could find out for myself shortly after; i.e. SQL Server Denali CTP1 was released during the PASS Summit. I have literally finished installing the next version of SQL Server (Denali / SQL 11) on a new VM, like 10 minutes ago, and I have done a quick check of the new features of SQL Server Denali (what I could find at least) against my wish-list." /> <link rel="canonical" href="http://localhost:4000//2010/11/10/new-t-sql-features-in-sql-11-denali-error-handling/" /> <meta property="og:url" content="http://localhost:4000//2010/11/10/new-t-sql-features-in-sql-11-denali-error-handling/" /> <meta property="og:site_name" content="MANAGED DATA" /> <meta property="og:type" content="article" /> <meta property="article:published_time" content="2010-11-10T11:27:56+02:00" /> <script type="application/ld+json"> {"@context": "http://schema.org", "@type": "BlogPosting", "headline": "New T-SQL Features in SQL 11 / Denali - Error Handling", "author": {"@type": "Person", "name": "nielsb"}, "datePublished": "2010-11-10T11:27:56+02:00", "description": "A couple of days ago I wrote my wish-list to Santa what I wanted to see in next version of SQL Server (SQL 11 / Denali). I was pleasantly surprised that I could find out for myself shortly after; i.e. SQL Server Denali CTP1 was released during the PASS Summit. I have literally finished installing the next version of SQL Server (Denali / SQL 11) on a new VM, like 10 minutes ago, and I have done a quick check of the new features of SQL Server Denali (what I could find at least) against my wish-list.", "mainEntityOfPage": {"@type": "WebPage", "@id": "http://localhost:4000//2010/11/10/new-t-sql-features-in-sql-11-denali-error-handling/"}, "url": "http://localhost:4000//2010/11/10/new-t-sql-features-in-sql-11-denali-error-handling/"}</script> <!-- End Jekyll SEO tag --> </head> <body> <div class="sidebar"> <div class="container sidebar-sticky"> <div class="sidebar-about"> <h1> <a href="/"> MANAGED DATA </a> </h1> <p class="lead">Technology musings about coding and data. Topics covered are - amongst others - .NET, SQL Server, Data Science, R, Windows Azure and a lot more.</p> </div> <nav class="sidebar-nav"> <a class="sidebar-nav-item" href="/">Home</a> <a class="sidebar-nav-item" href="/about/">About</a> <a class="sidebar-nav-item" href="/archive/">Posts Archive</a> </nav> <section> <h3 style="color:#ffffff">Follow Me:</h3> <ul> <li><a href="https://twitter.com/nielsberglund" target="_blank">Twitter</a></li> <li><a href="http://feeds.feedburner.com/manageddata/" target="_blank">RSS/Atom Feed</a></li> </ul> </section> <section> <h3 style="color:#ffffff">Disclaimer</h3> <p>This is my personal blog. The views expressed on these pages are mine alone and not those of my employer.</p> </section> <p>&copy; 2017. All rights reserved.</p> <div class="sidebar-social"> <div><a href="https://github.com/nberglund"> GitHub </a></div> <div><a href="https://twitter.com/nielsberglund"> Twitter </a></div> <div><a href="https://za.linkedin.com/in/niels-berglund-0122593"> LinkedIn </a></div> <div><a href="https://plus.google.com/u/0/109374849138720664008"> Google+ </a></div> </div> </div> </div> <div class="content container"> <div class="post"> <h1 class="post-title">New T-SQL Features in SQL 11 / Denali - Error Handling</h1> <div class="post-subheading"> <span class="post-date">10 Nov 2010</span> <span class="post-tag"> <span class="post-tagdesc">in categories:</span> SQL Server <span class="post-tagdesc">tags:</span> SQL 11 t-sql </span> </div> <p>A couple of days ago I wrote my <a href="/2010/11/07/what-new-programmability-features-will-there-be-in-sql-11/">wish-list</a> to Santa what I wanted to see in next version of SQL Server (SQL 11 / Denali). I was pleasantly surprised that I could find out for myself shortly after; i.e. SQL Server Denali CTP1 was released during the PASS Summit. I have literally finished installing the next version of SQL Server (Denali / SQL 11) on a new VM, like 10 minutes ago, and I have done a quick check of the new features of SQL Server Denali (what I could find at least) against my <a href="/2010/11/07/what-new-programmability-features-will-there-be-in-sql-11/">wish-list</a>.</p> <!--more--> <p>So it seems that my autonomous transactions have not been implemented. That does not necessarily meat that they won’t be there in later releases, but for now it is a downer. In my list I also mentioned finally blocks. From what I can see that has not been implemented either, <strong>BUT</strong> something else has…</p> <h3>RAISERROR</h3> <p>No <code>RAISERROR</code> is not anything new. We have used <code>RAISERROR</code> since beginning of time to throw an error in SQL Server. When using <code>RAISERROR</code> we either indicate an error-number, or a message. If we were to raise based on a number, that error number had to exist in sys.messages. If we used a message instead, the error number we received back was 50000, i.e. something like so:</p> <p><figure class='code-highlight-figure'><div class='code-highlight'><pre class='code-highlight-pre'><div data-line='1' class='code-highlight-row numbered'><div class='code-highlight-line'><span class="n">RAISERROR</span><span class="p">(</span><span class="s1">'An error happened'</span><span class="p">,</span> <span class="mi">16</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span></div></div></pre></div></figure></p> <p>produced this:</p> <p><figure class='code-highlight-figure'><div class='code-highlight'><pre class='code-highlight-pre'><div data-line='1' class='code-highlight-row numbered'><div class='code-highlight-line'><span class="n">Msg</span> <span class="mi">50000</span><span class="p">,</span> <span class="k">Level</span> <span class="mi">16</span><span class="p">,</span> <span class="k">State</span> <span class="mi">1</span><span class="p">,</span> <span class="n">Line</span> <span class="mi">1</span>
</div></div><div data-line='2' class='code-highlight-row numbered'><div class='code-highlight-line'><span class="n">An</span> <span class="n">error</span> <span class="n">happened</span></div></div></pre></div></figure></p> <h3>TRY … CATCH</h3> <p>In SQL 2005 <del>proper</del> structured error handling was introduced using <code>TRY … CATCH</code> blocks. So instead of having to “litter” our code with <code>SELECT @@ERROR</code> statements, we could enclose our code in <code>BEGIN TRY END TRY</code> followed by <code>BEGIN CATCH END CATCH</code>. Something like so:</p> <p><figure class='code-highlight-figure'><div class='code-highlight'><pre class='code-highlight-pre'><div data-line='1' class='code-highlight-row numbered'><div class='code-highlight-line'><span class="k">BEGIN</span> <span class="n">TRY</span>
</div></div><div data-line='2' class='code-highlight-row numbered'><div class='code-highlight-line'>  <span class="k">SELECT</span> <span class="s1">'hello'</span><span class="p">;</span>
</div></div><div data-line='3' class='code-highlight-row numbered'><div class='code-highlight-line'>  <span class="k">SELECT</span> <span class="mi">1</span> <span class="o">/</span> <span class="mi">0</span><span class="p">;</span>
</div></div><div data-line='4' class='code-highlight-row numbered'><div class='code-highlight-line'>  <span class="k">SELECT</span> <span class="s1">'world'</span>
</div></div><div data-line='5' class='code-highlight-row numbered'><div class='code-highlight-line'><span class="k">END</span> <span class="n">TRY</span>
</div></div><div data-line='6' class='code-highlight-row numbered'><div class='code-highlight-line'><span class="k">BEGIN</span> <span class="n">CATCH</span>
</div></div><div data-line='7' class='code-highlight-row numbered'><div class='code-highlight-line'>  <span class="c1">--handle the error</span>
</div></div><div data-line='8' class='code-highlight-row numbered'><div class='code-highlight-line'><span class="k">END</span> <span class="n">CATCH</span></div></div></pre></div></figure></p> <p>… and life was good (IMHO the structured exception handling was one of the greatest new features in SQL Server 2005). However, we are never completely satisfied, we always want more. And what we wanted to do, was to be able to handle the error, and then perhaps re-throw the error (like we can do in other modern development languages). Up until SQL Server Denali / SQL 11 the only way to do that was to use <code>RAISERROR</code>. That would not have been so bad apart from the fact that we are not allowed to raise an error with a system defined error number, i.e. <code>RAISERROR(8134 …)</code>. So instead we had to resort to various “hack” to achieve what we wanted.</p> <h3>THROW</h3> <p>This has now been fixed in SQL Server Denali / SQL 11 by the introduction of <strong><code>THROW</code></strong>. <code>THROW</code> does not require that an error number being thrown exists in sys.messages, so you can raise an exception like so: <code>THROW 50001, ‘OOPS – something happened’, 1</code>. Notice how you do not define a severity when using <code>THROW</code>, all exceptions being raised by <code>THROW</code> has a severity of 16.</p> <p>The really great thing with <code>THROW</code> however is how you can use it like you would use <code>THROW</code> in other languages. In other words you use use it to re-throw an exception:</p> <p><figure class='code-highlight-figure'><div class='code-highlight'><pre class='code-highlight-pre'><div data-line='1' class='code-highlight-row numbered'><div class='code-highlight-line'><span class="k">BEGIN</span> <span class="n">TRY</span>
</div></div><div data-line='2' class='code-highlight-row numbered'><div class='code-highlight-line'>  <span class="k">SELECT</span> <span class="s1">'hello'</span><span class="p">;</span>
</div></div><div data-line='3' class='code-highlight-row numbered'><div class='code-highlight-line'>  <span class="k">SELECT</span> <span class="mi">1</span> <span class="o">/</span> <span class="mi">0</span><span class="p">;</span>
</div></div><div data-line='4' class='code-highlight-row numbered'><div class='code-highlight-line'>  <span class="k">SELECT</span> <span class="s1">'world'</span>
</div></div><div data-line='5' class='code-highlight-row numbered'><div class='code-highlight-line'><span class="k">END</span> <span class="n">TRY</span>
</div></div><div data-line='6' class='code-highlight-row numbered'><div class='code-highlight-line'><span class="k">BEGIN</span> <span class="n">CATCH</span>
</div></div><div data-line='7' class='code-highlight-row numbered'><div class='code-highlight-line'>  <span class="c1">--handle the error</span>
</div></div><div data-line='8' class='code-highlight-row numbered'><div class='code-highlight-line'>  <span class="n">PRINT</span> <span class="s1">'here we are handling the error'</span>
</div></div><div data-line='9' class='code-highlight-row numbered'><div class='code-highlight-line'>  <span class="n">THROW</span>
</div></div><div data-line='10' class='code-highlight-row numbered'><div class='code-highlight-line'><span class="k">END</span> <span class="n">CATCH</span></div></div></pre></div></figure></p> <p>The above code snippet produces this output:</p> <p><figure class='code-highlight-figure'><div class='code-highlight'><pre class='code-highlight-pre'><div data-line='1' class='code-highlight-row numbered'><div class='code-highlight-line'><span class="n">here</span> <span class="n">we</span> <span class="k">are</span> <span class="n">handling</span> <span class="n">the</span> <span class="n">error</span>
</div></div><div data-line='2' class='code-highlight-row numbered'><div class='code-highlight-line'><span class="n">Msg</span> <span class="mi">8134</span><span class="p">,</span> <span class="k">Level</span> <span class="mi">16</span><span class="p">,</span> <span class="k">State</span> <span class="mi">1</span><span class="p">,</span> <span class="n">Line</span> <span class="mi">3</span>
</div></div><div data-line='3' class='code-highlight-row numbered'><div class='code-highlight-line'><span class="n">Divide</span> <span class="k">by</span> <span class="n">zero</span> <span class="n">error</span> <span class="n">encountered</span><span class="p">.</span></div></div></pre></div></figure></p> <p>I do not know about you, but I think this is fairly cool. I do still want finally blocks and autonomous transactions, but right now I take what I can get.</p> <p>As I mentioned in the beginning of this post; I have just installed SQL Server Denali, and have not had time to do much “spelunking”. Stay tuned for more posts in the coming days. You should also check <a href="http://sqlblogcasts.com/blogs/simons/">Simon Sabin’s</a> blog, where he has quite a lot of <a href="http://sqlblogcasts.com/blogs/simons/archive/2010/11/07/sql-server-denali-whats-new.aspx">SQL Server Denali coverage</a>.</p> <p> <h2>Share this Post:</h2> <a href="https://twitter.com/intent/tweet?url=http://localhost:4000/2010/11/10/new-t-sql-features-in-sql-11-denali-error-handling/&text=New T-SQL Features in SQL 11 / Denali - Error Handling&via=nielsberglund" target="_blank">Twitter</a> <a href="https://plus.google.com/share?url=http://www.nielsberglund.com//2010/11/10/new-t-sql-features-in-sql-11-denali-error-handling/" onclick="javascript:window.open(this.href,'', 'menubar=no,toolbar=no,resizable=yes,scrollbars=yes,height=600,width=600');return false;"> | Google+</a> <a href="https://www.linkedin.com/shareArticle? mini=true &url=http://www.nielsberglund.com/2010/11/10/new-t-sql-features-in-sql-11-denali-error-handling/ &title=New T-SQL Features in SQL 11 / Denali - Error Handling &summary=Blog post: &source=http://www.nielsberglund.com/2010/11/10/new-t-sql-features-in-sql-11-denali-error-handling/"> | LinkedIn</a> </p> <!--<script async src="//platform.twitter.com/widgets.js" charset="utf-8"></script> http://www.linkedin.com/shareArticle?mini=true&url=<URL>&title=<TITILE>&summary=<DESCRIPTION>&sourc https://www.linkedin.com/shareArticle?mini=true&url=http://localhost:4000/2010/11/10/new-t-sql-features-in-sql-11-denali-error-handling/ --> <p> <h2>Blog Feed:</h2> To automatically receive more posts like this, please <a href="http://feeds.feedburner.com/manageddata/" target="_blank"> subscribe to my RSS/Atom feed</a> in your feed reader!</p> </div> <div class="related"> <h2>Related Posts</h2> <div class="related-posts"> <h3><a href="/2010/11/12/more-t-sql-error-functionality-in-denali-sql-11/"> More T-SQL Error Functionality in Denali / SQL 11 <small> (12 Nov 2010)</small> </a></h3> </div> </div> <div id="disqus_thread"></div> <script> var disqus_developer = 1; (function() { /*DON'T EDIT BELOW THIS LINE*/ var d = document, s = d.createElement('script'); s.src = '//manageddata.disqus.com/embed.js'; s.setAttribute('data-timestamp', +new Date()); (d.head || d.body).appendChild(s); })(); </script> <noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript" rel="nofollow">comments powered by Disqus.</a></noscript> </div> <script> (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){ (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o), m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m) })(window,document,'script','//www.google-analytics.com/analytics.js','ga'); ga('create', 'UA-18914734-2', 'auto'); ga('send', 'pageview'); </script> </body> </html>
