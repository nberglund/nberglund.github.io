<!DOCTYPE html> <html lang="en-us"> <head> <!-- Google Tag Manager --> <script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start': new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0], j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src= 'https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f); })(window,document,'script','dataLayer','GTM-K7B3642');</script> <!-- End Google Tag Manager --> <link href="http://gmpg.org/xfn/11" rel="profile"> <meta http-equiv="X-UA-Compatible" content="IE=edge"> <meta http-equiv="content-type" content="text/html; charset=utf-8"> <meta name="description" content="We look at what permissions a non-admin user needs to execute sp_execute_external_script"> <meta name="keywords" content="SQL Server R Services, SQL Server Machine Learning Services, R, Python, sp_execute_external_script, SQL Server Permissions"/> <!-- Enable responsiveness on mobile devices--> <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1"> <title> sp_execute_external_script and Permissions &middot; Niels Berglund </title> <!-- CSS --> <link rel="stylesheet" href="/public/css/poole.css"> <link rel="stylesheet" href="/public/css/syntax.css"> <link rel="stylesheet" href="/public/css/hyde.css"> <link rel="stylesheet" href="http://fonts.googleapis.com/css?family=PT+Sans:400,400italic,700|Abril+Fatface"> <!-- Icons --> <link rel="apple-touch-icon-precomposed" sizes="144x144" href="/public/apple-touch-icon-144-precomposed.png"> <link rel="shortcut icon" href="/public/favicon.ico"> <!-- RSS --> <link rel="alternate" type="application/rss+xml" title="RSS" href="/atom.xml"> <link href='/stylesheets/all-d361e701e0c0e75e121ac3e901cff1b8.css' media='all' rel='stylesheet' type='text/css'> <!-- Begin Jekyll SEO tag v2.5.0 --> <title>sp_execute_external_script and Permissions | Niels Berglund</title> <meta name="generator" content="Jekyll v3.8.2" /> <meta property="og:title" content="sp_execute_external_script and Permissions" /> <meta name="author" content="nielsb" /> <meta property="og:locale" content="en_US" /> <meta name="description" content="We look at what permissions a non-admin user needs to execute sp_execute_external_script" /> <meta property="og:description" content="We look at what permissions a non-admin user needs to execute sp_execute_external_script" /> <link rel="canonical" href="http://nielsberglund.com/2018/06/24/sp-execute-external-script-and-permissions/" /> <meta property="og:url" content="http://nielsberglund.com/2018/06/24/sp-execute-external-script-and-permissions/" /> <meta property="og:site_name" content="Niels Berglund" /> <meta property="og:type" content="article" /> <meta property="article:published_time" content="2018-06-24T14:36:36+02:00" /> <script type="application/ld+json"> {"@type":"BlogPosting","url":"http://nielsberglund.com/2018/06/24/sp-execute-external-script-and-permissions/","headline":"sp_execute_external_script and Permissions","dateModified":"2018-06-24T14:36:36+02:00","datePublished":"2018-06-24T14:36:36+02:00","author":{"@type":"Person","name":"nielsb"},"mainEntityOfPage":{"@type":"WebPage","@id":"http://nielsberglund.com/2018/06/24/sp-execute-external-script-and-permissions/"},"description":"We look at what permissions a non-admin user needs to execute sp_execute_external_script","@context":"http://schema.org"}</script> <!-- End Jekyll SEO tag --> <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script> <script> (adsbygoogle = window.adsbygoogle || []).push({ google_ad_client: "ca-pub-3005153158271538", enable_page_level_ads: true }); </script> </head> <body> <!-- Google Tag Manager (noscript) --> <noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-K7B3642" height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript> <!-- End Google Tag Manager (noscript) --> <div class="sidebar"> <div class="container"> <div class="sidebar-about"> <h1> <a href="/"> Niels Berglund </a> </h1> <p class="lead">Technology musings about coding and data. Some topics: .NET, SQL Server, Data Science, R, Windows Azure and a lot more.</p> </div> <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script> <!-- Sidebar_rectangle --> <ins class="adsbygoogle" style="display:inline-block;width:300px;height:250px" data-ad-client="ca-pub-3005153158271538" data-ad-slot="7704601332"></ins> <script> (adsbygoogle = window.adsbygoogle || []).push({}); </script> <nav class="sidebar-nav"> <a class="sidebar-nav-item" href="/">Home</a> <a class="sidebar-nav-item" href="/about/">About</a> <a class="sidebar-nav-item" href="/archive/">Posts Archive</a> <a class="sidebar-nav-item" href="/categories/">Categories</a> <a class="sidebar-nav-item" href="/disclaimer/">Disclaimer</a> <a class="sidebar-nav-item" href="/series/">Blog Post Series</a> <a class="sidebar-nav-item" href="/tags/">Tags</a> </nav> <img class="center" src="/images/MVP_Logo_large.png" width="300" height="121" > <section> <h3 style="color:#ffffff">Follow Me:</h3> <ul> <li><a href="https://twitter.com/nielsberglund" target="_blank">Twitter</a></li> <li><a href="http://feeds.feedburner.com/manageddata/" target="_blank">RSS/Atom Feed</a></li> </ul> </section> <p>&copy; 2018. All rights reserved.</p> <div class="sidebar-social"> <div><a href="https://github.com/nberglund"> GitHub </a></div> <div><a href="https://twitter.com/nielsberglund"> Twitter </a></div> <div><a href="https://za.linkedin.com/in/niels-berglund-0122593"> LinkedIn </a></div> <div><a href="https://plus.google.com/u/0/109374849138720664008"> Google+ </a></div> </div> </div> </div> <div class="content container"> <div class="post"> <h1 class="post-title">sp_execute_external_script and Permissions</h1> <div class="post-subheading"> <span class="post-date">24 Jun 2018</span> <span class="post-tag"> <span class="post-tagdesc">in categories:</span> <a href="/categories/#SQL Server">SQL Server</a> <a href="/categories/#Microsoft R Server">Microsoft R Server</a> <a href="/categories/#Microsoft Machine Learning Server">Microsoft Machine Learning Server</a> <a href="/categories/#Data Science">Data Science</a> <a href="/categories/#SQL Server R Services">SQL Server R Services</a> <a href="/categories/#SQL Server Machine Learning Services">SQL Server Machine Learning Services</a> <span class="post-tagdesc">tags:</span> <a href="/tags/#SQL Server R Services">SQL Server R Services</a> <a href="/tags/#SQL Server Machine Learning Services">SQL Server Machine Learning Services</a> <a href="/tags/#R">R</a> <a href="/tags/#Python">Python</a> <a href="/tags/#sp_execute_external_script">sp_execute_external_script</a> <a href="/tags/#SQL Server Permissions">SQL Server Permissions</a> </span> </div> <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script> <!-- Ad1 --> <ins class="adsbygoogle" style="display:block" data-ad-client="ca-pub-3005153158271538" data-ad-slot="6668073777" data-ad-format="auto"></ins> <script> (adsbygoogle = window.adsbygoogle || []).push({}); </script> <br/> <p>This post will (hopefully) be short and sweet. It came about as I was testing out "stuff" for the <a href="/series/sql_server_ml_services_install_packages">Install R Packages in SQL Server ML Services</a> series of posts and I could not get it to work as I had expected.</p> <!--more--> <h2>Background</h2> <p>Usually, when I work with <strong>SQL Server Machine Learning Services</strong>, I execute code in the context of admin (yeah I know, do not do that :)). In the <a href="/series/sql_server_ml_services_install_packages">Install R Packages in SQL Server ML Services</a> series I used non-admin accounts, and all of a sudden nothing worked.</p> <p>I tried to research (read Google) the issue, but I could not find a definitive answer, just tidbits here and there. So when I finally realised what the issues were, I decided to write a blog post about it.</p> <h2>Housekeeping</h2> <p>As in quite a few of my other blog posts, here follows some code to set things up if you want to follow along.</p> <h4>Code</h4> <p>This is the code to "set the scene":</p> <p><figure class='code-highlight-figure'><figcaption class='code-highlight-caption'><span class='code-highlight-caption-title'>Database</span></figcaption><div class='code-highlight'><pre class='code-highlight-pre'><div data-line='1' class='code-highlight-row numbered'><div class='code-highlight-line'><span class="n">IF</span> <span class="k">NOT</span> <span class="k">EXISTS</span><span class="p">(</span><span class="k">SELECT</span> <span class="mi">1</span> <span class="k">FROM</span> <span class="n">sys</span><span class="p">.</span><span class="n">server_principals</span>
</div></div><div data-line='2' class='code-highlight-row numbered'><div class='code-highlight-line'>              <span class="k">WHERE</span> <span class="n">name</span> <span class="o">=</span> <span class="s1">'user1'</span><span class="p">)</span>
</div></div><div data-line='3' class='code-highlight-row numbered'><div class='code-highlight-line'><span class="k">BEGIN</span>
</div></div><div data-line='4' class='code-highlight-row numbered'><div class='code-highlight-line'>  <span class="k">CREATE</span> <span class="n">LOGIN</span> <span class="n">user1</span>
</div></div><div data-line='5' class='code-highlight-row numbered'><div class='code-highlight-line'>  <span class="k">WITH</span> <span class="n">PASSWORD</span> <span class="o">=</span> <span class="s1">'password1234$'</span><span class="p">;</span>
</div></div><div data-line='6' class='code-highlight-row numbered'><div class='code-highlight-line'><span class="k">END</span>
</div></div><div data-line='7' class='code-highlight-row numbered'><div class='code-highlight-line'> </div></div><div data-line='8' class='code-highlight-row numbered'><div class='code-highlight-line'><span class="k">DROP</span> <span class="k">DATABASE</span> <span class="n">IF</span> <span class="k">EXISTS</span> <span class="n">PermissionDB</span><span class="p">;</span>
</div></div><div data-line='9' class='code-highlight-row numbered'><div class='code-highlight-line'><span class="k">GO</span>
</div></div><div data-line='10' class='code-highlight-row numbered'><div class='code-highlight-line'> </div></div><div data-line='11' class='code-highlight-row numbered'><div class='code-highlight-line'><span class="k">CREATE</span> <span class="k">DATABASE</span> <span class="n">PermissionDB</span><span class="p">;</span>
</div></div><div data-line='12' class='code-highlight-row numbered'><div class='code-highlight-line'><span class="k">GO</span>
</div></div><div data-line='13' class='code-highlight-row numbered'><div class='code-highlight-line'> </div></div><div data-line='14' class='code-highlight-row numbered'><div class='code-highlight-line'><span class="n">USE</span> <span class="n">PermissionDB</span><span class="p">;</span>
</div></div><div data-line='15' class='code-highlight-row numbered'><div class='code-highlight-line'><span class="k">GO</span>
</div></div><div data-line='16' class='code-highlight-row numbered'><div class='code-highlight-line'> </div></div><div data-line='17' class='code-highlight-row numbered'><div class='code-highlight-line'><span class="k">CREATE</span> <span class="k">USER</span> <span class="n">user1</span>
</div></div><div data-line='18' class='code-highlight-row numbered'><div class='code-highlight-line'><span class="k">FROM</span> <span class="n">LOGIN</span> <span class="n">user1</span><span class="p">;</span>
</div></div><div data-line='19' class='code-highlight-row numbered'><div class='code-highlight-line'><span class="k">GO</span></div></div></pre></div></figure></p> <p><strong>Code Snippet 1:</strong> <em>Create Login, Database and User</em></p> <p>In <em>Code Snippet 1</em> we create a login, a database, and then we create a user for the login in the database.</p> <blockquote><p><strong>NOTE:</strong> Below you see in quite a few places the abbreviation SPEES. That is short for <code>sp_excute_external_script</code>.</p></blockquote> <h2>Permissions</h2> <p>What we see in <em>Code Snippet 1</em> is that we have not assigned <code>user1</code> to any particular roles on either the server or the database, so <code>user1</code> has whatever default permissions he gets during creation. Let us look in <em>SSMS</em> UI and see what server level roles <code>user1</code> belongs to:</p> <p><img class="center" src="/images/posts/sql_ml_speess_permissions1.png" width="485" height="235" > <strong>Figure 1:</strong> <em>Roles User1</em></p> <p>In <em>Figure 1</em> we see how <code>user1</code> belongs to the server role <code>public</code>, and that is the only role he belongs to. So what if we have code like so:</p> <p><figure class='code-highlight-figure'><figcaption class='code-highlight-caption'><span class='code-highlight-caption-title'>SPEES</span></figcaption><div class='code-highlight'><pre class='code-highlight-pre'><div data-line='1' class='code-highlight-row numbered'><div class='code-highlight-line'><span class="c1">--uncomment the following and execute</span>
</div></div><div data-line='2' class='code-highlight-row numbered'><div class='code-highlight-line'><span class="c1">--to execute as user1</span>
</div></div><div data-line='3' class='code-highlight-row numbered'><div class='code-highlight-line'><span class="c1">--EXECUTE AS USER = 'user1';</span>
</div></div><div data-line='4' class='code-highlight-row numbered'><div class='code-highlight-line'><span class="c1">--GO</span>
</div></div><div data-line='5' class='code-highlight-row numbered'><div class='code-highlight-line'> </div></div><div data-line='6' class='code-highlight-row numbered'><div class='code-highlight-line'><span class="k">EXECUTE</span> <span class="n">sp_execute_external_script</span>
</div></div><div data-line='7' class='code-highlight-row numbered'><div class='code-highlight-line'>             <span class="o">@</span><span class="k">language</span> <span class="o">=</span> <span class="n">N</span><span class="s1">'R'</span>
</div></div><div data-line='8' class='code-highlight-row numbered'><div class='code-highlight-line'>           <span class="p">,</span> <span class="o">@</span><span class="n">script</span> <span class="o">=</span> <span class="n">N</span><span class="s1">'
</div></div><div data-line='9' class='code-highlight-row numbered'><div class='code-highlight-line'>               d&lt;-42
</div></div><div data-line='10' class='code-highlight-row numbered'><div class='code-highlight-line'>               OutputDataSet &lt;- as.data.frame(d)'</span>
</div></div><div data-line='11' class='code-highlight-row numbered'><div class='code-highlight-line'> </div></div><div data-line='12' class='code-highlight-row numbered'><div class='code-highlight-line'><span class="c1">--to switch back from user1 uncomment and execute</span>
</div></div><div data-line='13' class='code-highlight-row numbered'><div class='code-highlight-line'><span class="c1">--the following</span>
</div></div><div data-line='14' class='code-highlight-row numbered'><div class='code-highlight-line'><span class="c1">--REVERT</span></div></div></pre></div></figure></p> <p><strong>Code Snippet 2:</strong> <em>Simple Test Code</em></p> <p>The code in <em>Code Snippet 2</em> allows you to switch between admin/sa and <code>user1</code> without having to log in as <code>user1</code>.</p> <p>If someone with sufficient permissions ran the code in <em>Code Snippet 2</em>, the result looks like so:</p> <p><img class="center" src="/images/posts/sql_ml_spees_sa_exec.png" width="160" height="70" > <strong>Figure 2:</strong> <em>sa Executes SPEES</em></p> <p>As we see in <em>Figure 2</em> we get back <a href="https://www.independent.co.uk/life-style/history/42-the-answer-to-life-the-universe-and-everything-2205734.html"><em>The Answer to the Ultimate Question of Life, the Universe and Everything.</em></a>, but if <code>user1</code> runs the same code, the result is:</p> <p><img class="center" src="/images/posts/sql_ml_spees_sa_exec_error1.png" width="555" height="95" > <strong>Figure 3:</strong> <em>SPEES Execution Error</em></p> <p>Oh, dear me, <code>user1</code> receives a permission denied exception! Well, from what we know about SQL Server and permissions it probably was not that unexpected. No problem, we know about SQL Server permissions, so we realise we probably have to <code>GRANT EXECUTE</code> permissions on <em>SPEES</em> to <code>user1</code> (or <code>public</code>):</p> <p><figure class='code-highlight-figure'><figcaption class='code-highlight-caption'><span class='code-highlight-caption-title'>Grant Permission</span></figcaption><div class='code-highlight'><pre class='code-highlight-pre'><div data-line='1' class='code-highlight-row numbered'><div class='code-highlight-line'><span class="k">GRANT</span> <span class="k">EXECUTE</span> <span class="k">ON</span> <span class="n">sp_execute_external_script</span> <span class="k">to</span> <span class="n">user1</span><span class="p">;</span></div></div></pre></div></figure></p> <p><strong>Code Snippet 3:</strong> <em>Grant Execute Permission</em></p> <p>Being in the database where <code>user1</code> exists and executing the code in <em>Code Snippet 3</em> as admin/sa - what could possibly go wrong:</p> <p><img class="center" src="/images/posts/sql_ml_spees_perm_grant_error1.png" width="525" height="95" > <strong>Figure 4:</strong> <em>Grant Permission Error</em></p> <p>Oops, something did go wrong, as it turns out that if you try to grant permissions on extended stored procedures, which <em>SPEES</em> is, you need to do it from the <code>master</code> database. Cool, let us switch to master and do it there. Well, if you try to do that - then you get another error: the user does not exist in <code>master</code>, sigh!</p> <p>At this stage you have a couple of options:</p> <ul> <li><del>Add the login for the user to the <code>sysadmin</code> role, or the user to the <code>db_owner</code> role in the actual database.</del> No do not do that, I am only kidding! Do.Not.Do.That!</li> <li>Create the user in <code>master</code> and grant the permission. That would work.</li> <li>Grant the permission to <code>public</code>.</li> </ul> <p>Both options above (I do not count <code>sysadmin</code>, <code>db_owner</code>) have drawbacks:</p> <ul> <li>Create the user in <code>master</code>: you now have a user in master, and the question is what "shenanigans" the user can do.</li> <li>Grant permission to <code>public</code>: anyone can potentially execute <em>SPEES</em>, not ideal.</li> </ul> <p>For reasons that become clear later I go with granting permission to <code>public</code>:</p> <p><figure class='code-highlight-figure'><figcaption class='code-highlight-caption'><span class='code-highlight-caption-title'>Public Permission</span></figcaption><div class='code-highlight'><pre class='code-highlight-pre'><div data-line='1' class='code-highlight-row numbered'><div class='code-highlight-line'><span class="n">USE</span> <span class="n">master</span>
</div></div><div data-line='2' class='code-highlight-row numbered'><div class='code-highlight-line'><span class="k">GRANT</span> <span class="k">EXECUTE</span> <span class="k">ON</span> <span class="n">sp_execute_external_script</span> <span class="k">to</span> <span class="k">public</span><span class="p">;</span></div></div></pre></div></figure></p> <p><strong>Code Snippet 4:</strong> <em>Granting Permission to Public</em></p> <p>After admin/sa runs the code in <em>Code Snippet 4</em>, <code>user1</code> can now execute the code in <em>Code Snippet 2</em> and we should see <em>The Answer ...</em>:</p> <p><img class="center" src="/images/posts/sql_ml_spees_sa_exec_error2.png" width="495" height="70" > <strong>Figure 5:</strong> <em>SPEES Execution Error</em></p> <p><a href="https://en.oxforddictionaries.com/definition/eish">Eish</a>, what goes on here? We did grant the permission in <em>Code Snippet 4</em>, so what now? Hmm, if we compare the errors, we see that they are slightly different. The error before granting the permission is something like: "The EXECUTE permission was denied ...", whereas the error after granting the permission is like: "The user does not have permission ...". It seems that the code in <em>Code Snippet 4</em> did something, but we still miss a piece (or multiple) of the puzzle, and it is permissions related. What permission(s) is the question?</p> <p>So I decided to try a "brute force attack"; find all built in permissions in SQL Server, browse through them and see if I see something promising. For this, I used a SQL Server function: <code>sys.fn_builtin_permissions</code>, which - when executed - returns a description of the built-in permissions hierarchy of the server:</p> <p><figure class='code-highlight-figure'><figcaption class='code-highlight-caption'><span class='code-highlight-caption-title'>Functions</span></figcaption><div class='code-highlight'><pre class='code-highlight-pre'><div data-line='1' class='code-highlight-row numbered'><div class='code-highlight-line'><span class="k">SELECT</span> <span class="o">*</span> <span class="k">FROM</span> <span class="n">fn_builtin_permissions</span><span class="p">(</span><span class="s1">'database'</span><span class="p">)</span></div></div></pre></div></figure></p> <p><strong>Code Snippet 5:</strong> <em>Retrieve All Functions</em></p> <p>The parameter (<code>database</code>) in <em>Code Snippet 5</em> indicates what permissions I want back. In this case, I want all permissions on a database level. When I ran the code in <em>Code Snippet 5</em> the function call returned 78 rows, and towards the end of the result I saw something promising:</p> <p><img class="center" src="/images/posts/sql_ml_spees_permissions.png" width="500" height="155" > <strong>Figure 6:</strong> <em>SPEES Execution Error</em></p> <p>The highligthed part in <em>Figure 6</em> looks very interesting. I wonder what happens if I do something like this as admin/sa in the database the user is in:</p> <p><figure class='code-highlight-figure'><figcaption class='code-highlight-caption'><span class='code-highlight-caption-title'>Functions</span></figcaption><div class='code-highlight'><pre class='code-highlight-pre'><div data-line='1' class='code-highlight-row numbered'><div class='code-highlight-line'><span class="k">GRANT</span> <span class="k">EXECUTE</span> <span class="k">ANY</span> <span class="k">EXTERNAL</span> <span class="n">SCRIPT</span> <span class="k">TO</span> <span class="n">user1</span></div></div></pre></div></figure></p> <p><strong>Code Snippet 5:</strong> <em>Grant External Script</em></p> <p>The code in <em>Code Snippet 5</em> ran without any issues, and <code>user1</code> can then try following code:</p> <p><figure class='code-highlight-figure'><figcaption class='code-highlight-caption'><span class='code-highlight-caption-title'>Another Try</span></figcaption><div class='code-highlight'><pre class='code-highlight-pre'><div data-line='1' class='code-highlight-row numbered'><div class='code-highlight-line'><span class="k">SELECT</span> <span class="n">SUSER_NAME</span><span class="p">()</span>
</div></div><div data-line='2' class='code-highlight-row numbered'><div class='code-highlight-line'><span class="k">EXECUTE</span> <span class="n">sp_execute_external_script</span>
</div></div><div data-line='3' class='code-highlight-row numbered'><div class='code-highlight-line'>             <span class="o">@</span><span class="k">language</span> <span class="o">=</span> <span class="n">N</span><span class="s1">'R'</span>
</div></div><div data-line='4' class='code-highlight-row numbered'><div class='code-highlight-line'>           <span class="p">,</span> <span class="o">@</span><span class="n">script</span> <span class="o">=</span> <span class="n">N</span><span class="s1">'
</div></div><div data-line='5' class='code-highlight-row numbered'><div class='code-highlight-line'>               d&lt;-42
</div></div><div data-line='6' class='code-highlight-row numbered'><div class='code-highlight-line'>               OutputDataSet &lt;- as.data.frame(d)'</span></div></div></pre></div></figure></p> <p><strong>Code Snippet 6:</strong> <em>Another Try by user1</em></p> <p>The <code>SELECT SUSER_NAME()</code> in <em>Code Snippet 6</em> is there to verify that it is the correct user executing. The result when <code>user1</code> executes looks like so:</p> <p><img class="center" src="/images/posts/sql_ml_spees_user1_exec.png" width="145" height="130" > <strong>Figure 6:</strong> <em>Successful Execution</em></p> <p>So that was the missing link: <code>GRANT EXECUTE ANY EXTERNAL SCRIPT TO ...</code>, and to tell the truth; afterwards, I have seen a few posts on the net mentioning <code>EXECUTE ANY EXTERNAL SCRIPT</code>.</p> <p>One more thing: above I mentioned that I favour granting the <code>EXECUTE</code> on <em>SPEES</em> to <code>public</code> instead of adding the user to <code>master</code>. The reason for this is what we just have seen: yes you do a "blanket" <code>GRANT</code> by granting <code>public</code>, but a user still needs to be granted <code>EXECUTE ANY EXTERNAL SCRIPT</code> before he can "go wild". That gives admins/dba's some control over who can execute <em>SPEES</em>.</p> <h2>Summary</h2> <p>To allow a non-admin database user to execute <code>sp_execute_external_script</code> you need to:</p> <ul> <li>Grant <code>public</code> execute permissions on <code>sp_execute_external_script</code>, and you do it in <code>master</code>. Obviously, you only need to do it once.</li> <li>Grant <code>EXECUTE ANY EXTERNAL SCRIPT</code> to the user in the different databases he needs to execute <em>SPEES</em> in.</li> </ul> <p>That is it!</p> <p>One final thing: if you want to read more about <code>sp_execute_external_script</code>, <a href="/series/sql_server_2k16_r_services">SQL Server R Services</a> series has some posts.</p> <h2>~ Finally</h2> <p>If you have comments, questions etc., please comment on this post or <a href="mailto:niels.it.berglund@gmail.com">ping</a> me.</p> <p> <h2>Share this Post:</h2> <a href="https://twitter.com/intent/tweet?url=http://nielsberglund.com/2018/06/24/sp-execute-external-script-and-permissions/&text=sp_execute_external_script and Permissions&via=nielsberglund" target="_blank">Twitter</a> <a href="https://plus.google.com/share?url=http://www.nielsberglund.com//2018/06/24/sp-execute-external-script-and-permissions/" onclick="javascript:window.open(this.href,'', 'menubar=no,toolbar=no,resizable=yes,scrollbars=yes,height=600,width=600');return false;"> | Google+</a> <a href="https://www.linkedin.com/shareArticle? mini=true &url=http://www.nielsberglund.com/2018/06/24/sp-execute-external-script-and-permissions/ &title=sp_execute_external_script and Permissions &summary=Blog post: We look at what permissions a non-admin user needs to execute sp_execute_external_script &source=http://www.nielsberglund.com/2018/06/24/sp-execute-external-script-and-permissions/"> | LinkedIn</a> </p> <!--<script async src="//platform.twitter.com/widgets.js" charset="utf-8"></script> http://www.linkedin.com/shareArticle?mini=true&url=<URL>&title=<TITILE>&summary=<DESCRIPTION>&sourc https://www.linkedin.com/shareArticle?mini=true&url=http://nielsberglund.com/2018/06/24/sp-execute-external-script-and-permissions/ --> <p> <h2>Blog Feed:</h2> To automatically receive more posts like this, please <a href="http://feeds.feedburner.com/manageddata/" target="_blank"> subscribe to my RSS/Atom feed</a> in your feed reader!</p> <br/> <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script> <!-- Ad2 --> <ins class="adsbygoogle" style="display:block" data-ad-client="ca-pub-3005153158271538" data-ad-slot="1158080725" data-ad-format="auto"></ins> <script> (adsbygoogle = window.adsbygoogle || []).push({}); </script> <br/> </div> <div class="related"> <h2>Related Posts</h2> <div class="related-posts"> <h3><a href="/2018/07/29/interesting-stuff-week-30/"> Interesting Stuff - Week 30 <small> (29 Jul 2018)</small> </a></h3> </div> <div class="related-posts"> <h3><a href="/2018/07/22/interesting-stuff-week-29/"> Interesting Stuff - Week 29 <small> (22 Jul 2018)</small> </a></h3> </div> <div class="related-posts"> <h3><a href="/2018/07/15/interesting-stuff-week-28/"> Interesting Stuff - Week 28 <small> (15 Jul 2018)</small> </a></h3> </div> </div> <div id="disqus_thread"></div> <script> var disqus_developer = 1; (function() { /*DON'T EDIT BELOW THIS LINE*/ var d = document, s = d.createElement('script'); s.src = '//manageddata.disqus.com/embed.js'; s.setAttribute('data-timestamp', +new Date()); (d.head || d.body).appendChild(s); })(); </script> <noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript" rel="nofollow">comments powered by Disqus.</a></noscript> </div> <script> (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){ (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o), m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m) })(window,document,'script','//www.google-analytics.com/analytics.js','ga'); ga('create', 'UA-18914734-2', 'auto'); ga('send', 'pageview'); </script> </body> </html>
