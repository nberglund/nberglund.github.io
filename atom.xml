<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">

 <title>Niels Berglund</title>
 <link href="http://nielsberglund.com/atom.xml" rel="self"/>
 <link href="http://nielsberglund.com/"/>
 <updated>2018-06-24T14:55:17+02:00</updated>
 <id>http://nielsberglund.com</id>
 <author>
   <name>Niels Berglund</name>
   <email></email>
 </author>

 
 <entry>
   <title>sp_execute_external_script and Permissions</title>
   <link href="http://nielsberglund.com/2018/06/24/sp-execute-external-script-and-permissions/"/>
   <updated>2018-06-24T14:36:36+02:00</updated>
   <id>http://nielsberglund.com/2018/06/24/sp-execute-external-script-and-permissions</id>
   <content type="html">&lt;p&gt;This post will (hopefully) be short and sweet. It came about as I was testing out &quot;stuff&quot; for the &lt;a href=&quot;/series/sql_server_ml_services_install_packages&quot;&gt;Install R Packages in SQL Server ML Services&lt;/a&gt; series of posts and I could not get it to work as I had expected.&lt;/p&gt;

&lt;!--more--&gt;


&lt;h2&gt;Background&lt;/h2&gt;

&lt;p&gt;Usually, when I work with &lt;strong&gt;SQL Server Machine Learning Services&lt;/strong&gt;, I execute code in the context of admin (yeah I know, do not do that :)). In the &lt;a href=&quot;/series/sql_server_ml_services_install_packages&quot;&gt;Install R Packages in SQL Server ML Services&lt;/a&gt; series I used non-admin accounts, and all of a sudden nothing worked.&lt;/p&gt;

&lt;p&gt;I tried to research (read Google) the issue, but I could not find a definitive answer, just tidbits here and there. So when I finally realised what the issues were, I decided to write a blog post about it.&lt;/p&gt;

&lt;h2&gt;Housekeeping&lt;/h2&gt;

&lt;p&gt;As in quite a few of my other blog posts, here follows some code to set things up if you want to follow along.&lt;/p&gt;

&lt;h4&gt;Code&lt;/h4&gt;

&lt;p&gt;This is the code to &quot;set the scene&quot;:&lt;/p&gt;

&lt;p&gt;&lt;figure class='code-highlight-figure'&gt;&lt;figcaption class='code-highlight-caption'&gt;&lt;span class='code-highlight-caption-title'&gt;Database&lt;/span&gt;&lt;/figcaption&gt;&lt;div class='code-highlight'&gt;&lt;pre class='code-highlight-pre'&gt;&lt;div data-line='1' class='code-highlight-row numbered'&gt;&lt;div class='code-highlight-line'&gt;&lt;span class=&quot;n&quot;&gt;IF&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;NOT&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;EXISTS&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;SELECT&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;1&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;FROM&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;sys&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;server_principals&lt;/span&gt;
&lt;/div&gt;&lt;/div&gt;&lt;div data-line='2' class='code-highlight-row numbered'&gt;&lt;div class='code-highlight-line'&gt;              &lt;span class=&quot;k&quot;&gt;WHERE&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;name&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;'user1'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
&lt;/div&gt;&lt;/div&gt;&lt;div data-line='3' class='code-highlight-row numbered'&gt;&lt;div class='code-highlight-line'&gt;&lt;span class=&quot;k&quot;&gt;BEGIN&lt;/span&gt;
&lt;/div&gt;&lt;/div&gt;&lt;div data-line='4' class='code-highlight-row numbered'&gt;&lt;div class='code-highlight-line'&gt;  &lt;span class=&quot;k&quot;&gt;CREATE&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;LOGIN&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;user1&lt;/span&gt;
&lt;/div&gt;&lt;/div&gt;&lt;div data-line='5' class='code-highlight-row numbered'&gt;&lt;div class='code-highlight-line'&gt;  &lt;span class=&quot;k&quot;&gt;WITH&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;PASSWORD&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;'password1234$'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
&lt;/div&gt;&lt;/div&gt;&lt;div data-line='6' class='code-highlight-row numbered'&gt;&lt;div class='code-highlight-line'&gt;&lt;span class=&quot;k&quot;&gt;END&lt;/span&gt;
&lt;/div&gt;&lt;/div&gt;&lt;div data-line='7' class='code-highlight-row numbered'&gt;&lt;div class='code-highlight-line'&gt; &lt;/div&gt;&lt;/div&gt;&lt;div data-line='8' class='code-highlight-row numbered'&gt;&lt;div class='code-highlight-line'&gt;&lt;span class=&quot;k&quot;&gt;DROP&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;DATABASE&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;IF&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;EXISTS&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;PermissionDB&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
&lt;/div&gt;&lt;/div&gt;&lt;div data-line='9' class='code-highlight-row numbered'&gt;&lt;div class='code-highlight-line'&gt;&lt;span class=&quot;k&quot;&gt;GO&lt;/span&gt;
&lt;/div&gt;&lt;/div&gt;&lt;div data-line='10' class='code-highlight-row numbered'&gt;&lt;div class='code-highlight-line'&gt; &lt;/div&gt;&lt;/div&gt;&lt;div data-line='11' class='code-highlight-row numbered'&gt;&lt;div class='code-highlight-line'&gt;&lt;span class=&quot;k&quot;&gt;CREATE&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;DATABASE&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;PermissionDB&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
&lt;/div&gt;&lt;/div&gt;&lt;div data-line='12' class='code-highlight-row numbered'&gt;&lt;div class='code-highlight-line'&gt;&lt;span class=&quot;k&quot;&gt;GO&lt;/span&gt;
&lt;/div&gt;&lt;/div&gt;&lt;div data-line='13' class='code-highlight-row numbered'&gt;&lt;div class='code-highlight-line'&gt; &lt;/div&gt;&lt;/div&gt;&lt;div data-line='14' class='code-highlight-row numbered'&gt;&lt;div class='code-highlight-line'&gt;&lt;span class=&quot;n&quot;&gt;USE&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;PermissionDB&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
&lt;/div&gt;&lt;/div&gt;&lt;div data-line='15' class='code-highlight-row numbered'&gt;&lt;div class='code-highlight-line'&gt;&lt;span class=&quot;k&quot;&gt;GO&lt;/span&gt;
&lt;/div&gt;&lt;/div&gt;&lt;div data-line='16' class='code-highlight-row numbered'&gt;&lt;div class='code-highlight-line'&gt; &lt;/div&gt;&lt;/div&gt;&lt;div data-line='17' class='code-highlight-row numbered'&gt;&lt;div class='code-highlight-line'&gt;&lt;span class=&quot;k&quot;&gt;CREATE&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;USER&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;user1&lt;/span&gt;
&lt;/div&gt;&lt;/div&gt;&lt;div data-line='18' class='code-highlight-row numbered'&gt;&lt;div class='code-highlight-line'&gt;&lt;span class=&quot;k&quot;&gt;FROM&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;LOGIN&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;user1&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
&lt;/div&gt;&lt;/div&gt;&lt;div data-line='19' class='code-highlight-row numbered'&gt;&lt;div class='code-highlight-line'&gt;&lt;span class=&quot;k&quot;&gt;GO&lt;/span&gt;&lt;/div&gt;&lt;/div&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/figure&gt;&lt;/p&gt;

&lt;p&gt;&lt;strong&gt;Code Snippet 1:&lt;/strong&gt; &lt;em&gt;Create Login, Database and User&lt;/em&gt;&lt;/p&gt;

&lt;p&gt;In &lt;em&gt;Code Snippet 1&lt;/em&gt; we create a login, a database, and then we create a user for the login in the database.&lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;&lt;strong&gt;NOTE:&lt;/strong&gt; Below you see in quite a few places the abbreviation SPEES. That is short for &lt;code&gt;sp_excute_external_script&lt;/code&gt;.&lt;/p&gt;&lt;/blockquote&gt;

&lt;h2&gt;Permissions&lt;/h2&gt;

&lt;p&gt;What we see in &lt;em&gt;Code Snippet 1&lt;/em&gt; is that we have not assigned &lt;code&gt;user1&lt;/code&gt; to any particular roles on either the server or the database, so &lt;code&gt;user1&lt;/code&gt; has whatever default permissions he gets during creation. Let us look in &lt;em&gt;SSMS&lt;/em&gt; UI and see what server level roles &lt;code&gt;user1&lt;/code&gt; belongs to:&lt;/p&gt;

&lt;p&gt;&lt;img class=&quot;center&quot; src=&quot;/images/posts/sql_ml_speess_permissions1.png&quot; width=&quot;485&quot; height=&quot;235&quot;  &gt;
&lt;strong&gt;Figure 1:&lt;/strong&gt; &lt;em&gt;Roles User1&lt;/em&gt;&lt;/p&gt;

&lt;p&gt;In &lt;em&gt;Figure 1&lt;/em&gt; we see how &lt;code&gt;user1&lt;/code&gt; belongs to the server role &lt;code&gt;public&lt;/code&gt;, and that is the only role he belongs to. So what if we have code like so:&lt;/p&gt;

&lt;p&gt;&lt;figure class='code-highlight-figure'&gt;&lt;figcaption class='code-highlight-caption'&gt;&lt;span class='code-highlight-caption-title'&gt;SPEES&lt;/span&gt;&lt;/figcaption&gt;&lt;div class='code-highlight'&gt;&lt;pre class='code-highlight-pre'&gt;&lt;div data-line='1' class='code-highlight-row numbered'&gt;&lt;div class='code-highlight-line'&gt;&lt;span class=&quot;c1&quot;&gt;--uncomment the following and execute&lt;/span&gt;
&lt;/div&gt;&lt;/div&gt;&lt;div data-line='2' class='code-highlight-row numbered'&gt;&lt;div class='code-highlight-line'&gt;&lt;span class=&quot;c1&quot;&gt;--to execute as user1&lt;/span&gt;
&lt;/div&gt;&lt;/div&gt;&lt;div data-line='3' class='code-highlight-row numbered'&gt;&lt;div class='code-highlight-line'&gt;&lt;span class=&quot;c1&quot;&gt;--EXECUTE AS USER = 'user1';&lt;/span&gt;
&lt;/div&gt;&lt;/div&gt;&lt;div data-line='4' class='code-highlight-row numbered'&gt;&lt;div class='code-highlight-line'&gt;&lt;span class=&quot;c1&quot;&gt;--GO&lt;/span&gt;
&lt;/div&gt;&lt;/div&gt;&lt;div data-line='5' class='code-highlight-row numbered'&gt;&lt;div class='code-highlight-line'&gt; &lt;/div&gt;&lt;/div&gt;&lt;div data-line='6' class='code-highlight-row numbered'&gt;&lt;div class='code-highlight-line'&gt;&lt;span class=&quot;k&quot;&gt;EXECUTE&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;sp_execute_external_script&lt;/span&gt;
&lt;/div&gt;&lt;/div&gt;&lt;div data-line='7' class='code-highlight-row numbered'&gt;&lt;div class='code-highlight-line'&gt;             &lt;span class=&quot;o&quot;&gt;@&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;language&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;N&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;'R'&lt;/span&gt;
&lt;/div&gt;&lt;/div&gt;&lt;div data-line='8' class='code-highlight-row numbered'&gt;&lt;div class='code-highlight-line'&gt;           &lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;@&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;script&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;N&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;'
&lt;/div&gt;&lt;/div&gt;&lt;div data-line='9' class='code-highlight-row numbered'&gt;&lt;div class='code-highlight-line'&gt;               d&amp;lt;-42
&lt;/div&gt;&lt;/div&gt;&lt;div data-line='10' class='code-highlight-row numbered'&gt;&lt;div class='code-highlight-line'&gt;               OutputDataSet &amp;lt;- as.data.frame(d)'&lt;/span&gt;
&lt;/div&gt;&lt;/div&gt;&lt;div data-line='11' class='code-highlight-row numbered'&gt;&lt;div class='code-highlight-line'&gt; &lt;/div&gt;&lt;/div&gt;&lt;div data-line='12' class='code-highlight-row numbered'&gt;&lt;div class='code-highlight-line'&gt;&lt;span class=&quot;c1&quot;&gt;--to switch back from user1 uncomment and execute&lt;/span&gt;
&lt;/div&gt;&lt;/div&gt;&lt;div data-line='13' class='code-highlight-row numbered'&gt;&lt;div class='code-highlight-line'&gt;&lt;span class=&quot;c1&quot;&gt;--the following&lt;/span&gt;
&lt;/div&gt;&lt;/div&gt;&lt;div data-line='14' class='code-highlight-row numbered'&gt;&lt;div class='code-highlight-line'&gt;&lt;span class=&quot;c1&quot;&gt;--REVERT&lt;/span&gt;&lt;/div&gt;&lt;/div&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/figure&gt;&lt;/p&gt;

&lt;p&gt;&lt;strong&gt;Code Snippet 2:&lt;/strong&gt; &lt;em&gt;Simple Test Code&lt;/em&gt;&lt;/p&gt;

&lt;p&gt;The code in &lt;em&gt;Code Snippet 2&lt;/em&gt; allows you to switch between admin/sa and &lt;code&gt;user1&lt;/code&gt; without having to log in as &lt;code&gt;user1&lt;/code&gt;.&lt;/p&gt;

&lt;p&gt;If someone with sufficient permissions ran the code in &lt;em&gt;Code Snippet 2&lt;/em&gt;, the result looks like so:&lt;/p&gt;

&lt;p&gt;&lt;img class=&quot;center&quot; src=&quot;/images/posts/sql_ml_spees_sa_exec.png&quot; width=&quot;160&quot; height=&quot;70&quot;  &gt;
&lt;strong&gt;Figure 2:&lt;/strong&gt; &lt;em&gt;sa Executes SPEES&lt;/em&gt;&lt;/p&gt;

&lt;p&gt;As we see in &lt;em&gt;Figure 2&lt;/em&gt; we get back &lt;a href=&quot;https://www.independent.co.uk/life-style/history/42-the-answer-to-life-the-universe-and-everything-2205734.html&quot;&gt;&lt;em&gt;The Answer to the Ultimate Question of Life, the Universe and Everything.&lt;/em&gt;&lt;/a&gt;, but if &lt;code&gt;user1&lt;/code&gt; runs the same code, the result is:&lt;/p&gt;

&lt;p&gt;&lt;img class=&quot;center&quot; src=&quot;/images/posts/sql_ml_spees_sa_exec_error1.png&quot; width=&quot;555&quot; height=&quot;95&quot;  &gt;
&lt;strong&gt;Figure 3:&lt;/strong&gt; &lt;em&gt;SPEES Execution Error&lt;/em&gt;&lt;/p&gt;

&lt;p&gt;Oh, dear me, &lt;code&gt;user1&lt;/code&gt; receives a permission denied exception! Well, from what we know about SQL Server and permissions it probably was not that unexpected. No problem, we know about SQL Server permissions, so we realise we probably have to &lt;code&gt;GRANT EXECUTE&lt;/code&gt; permissions on &lt;em&gt;SPEES&lt;/em&gt; to &lt;code&gt;user1&lt;/code&gt; (or &lt;code&gt;public&lt;/code&gt;):&lt;/p&gt;

&lt;p&gt;&lt;figure class='code-highlight-figure'&gt;&lt;figcaption class='code-highlight-caption'&gt;&lt;span class='code-highlight-caption-title'&gt;Grant Permission&lt;/span&gt;&lt;/figcaption&gt;&lt;div class='code-highlight'&gt;&lt;pre class='code-highlight-pre'&gt;&lt;div data-line='1' class='code-highlight-row numbered'&gt;&lt;div class='code-highlight-line'&gt;&lt;span class=&quot;k&quot;&gt;GRANT&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;EXECUTE&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;ON&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;sp_execute_external_script&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;to&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;user1&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;&lt;/div&gt;&lt;/div&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/figure&gt;&lt;/p&gt;

&lt;p&gt;&lt;strong&gt;Code Snippet 3:&lt;/strong&gt; &lt;em&gt;Grant Execute Permission&lt;/em&gt;&lt;/p&gt;

&lt;p&gt;Being in the database where &lt;code&gt;user1&lt;/code&gt; exists and executing the code in &lt;em&gt;Code Snippet 3&lt;/em&gt; as admin/sa - what could possibly go wrong:&lt;/p&gt;

&lt;p&gt;&lt;img class=&quot;center&quot; src=&quot;/images/posts/sql_ml_spees_perm_grant_error1.png&quot; width=&quot;525&quot; height=&quot;95&quot;  &gt;
&lt;strong&gt;Figure 4:&lt;/strong&gt; &lt;em&gt;Grant Permission Error&lt;/em&gt;&lt;/p&gt;

&lt;p&gt;Oops, something did go wrong, as it turns out that if you try to grant permissions on extended stored procedures, which &lt;em&gt;SPEES&lt;/em&gt; is, you need to do it from the &lt;code&gt;master&lt;/code&gt; database. Cool, let us switch to master and do it there. Well, if you try to do that - then you get another error: the user does not exist in &lt;code&gt;master&lt;/code&gt;, sigh!&lt;/p&gt;

&lt;p&gt;At this stage you have a couple of options:&lt;/p&gt;

&lt;ul&gt;
&lt;li&gt;&lt;del&gt;Add the login for the user to the &lt;code&gt;sysadmin&lt;/code&gt; role, or the user to the &lt;code&gt;db_owner&lt;/code&gt; role in the actual database.&lt;/del&gt; No do not do that, I am only kidding! Do.Not.Do.That!&lt;/li&gt;
&lt;li&gt;Create the user in &lt;code&gt;master&lt;/code&gt; and grant the permission. That would work.&lt;/li&gt;
&lt;li&gt;Grant the permission to &lt;code&gt;public&lt;/code&gt;.&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;Both options above (I do not count &lt;code&gt;sysadmin&lt;/code&gt;, &lt;code&gt;db_owner&lt;/code&gt;) have drawbacks:&lt;/p&gt;

&lt;ul&gt;
&lt;li&gt;Create the user in &lt;code&gt;master&lt;/code&gt;: you now have a user in master, and the question is what &quot;shenanigans&quot; the user can do.&lt;/li&gt;
&lt;li&gt;Grant permission to &lt;code&gt;public&lt;/code&gt;: anyone can potentially execute &lt;em&gt;SPEES&lt;/em&gt;, not ideal.&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;For reasons that become clear later I go with granting permission to &lt;code&gt;public&lt;/code&gt;:&lt;/p&gt;

&lt;p&gt;&lt;figure class='code-highlight-figure'&gt;&lt;figcaption class='code-highlight-caption'&gt;&lt;span class='code-highlight-caption-title'&gt;Public Permission&lt;/span&gt;&lt;/figcaption&gt;&lt;div class='code-highlight'&gt;&lt;pre class='code-highlight-pre'&gt;&lt;div data-line='1' class='code-highlight-row numbered'&gt;&lt;div class='code-highlight-line'&gt;&lt;span class=&quot;n&quot;&gt;USE&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;master&lt;/span&gt;
&lt;/div&gt;&lt;/div&gt;&lt;div data-line='2' class='code-highlight-row numbered'&gt;&lt;div class='code-highlight-line'&gt;&lt;span class=&quot;k&quot;&gt;GRANT&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;EXECUTE&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;ON&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;sp_execute_external_script&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;to&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;public&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;&lt;/div&gt;&lt;/div&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/figure&gt;&lt;/p&gt;

&lt;p&gt;&lt;strong&gt;Code Snippet 4:&lt;/strong&gt; &lt;em&gt;Granting Permission to Public&lt;/em&gt;&lt;/p&gt;

&lt;p&gt;After admin/sa runs the code in &lt;em&gt;Code Snippet 4&lt;/em&gt;, &lt;code&gt;user1&lt;/code&gt; can now execute the code in &lt;em&gt;Code Snippet 2&lt;/em&gt; and we should see &lt;em&gt;The Answer ...&lt;/em&gt;:&lt;/p&gt;

&lt;p&gt;&lt;img class=&quot;center&quot; src=&quot;/images/posts/sql_ml_spees_sa_exec_error2.png&quot; width=&quot;495&quot; height=&quot;70&quot;  &gt;
&lt;strong&gt;Figure 5:&lt;/strong&gt; &lt;em&gt;SPEES Execution Error&lt;/em&gt;&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://en.oxforddictionaries.com/definition/eish&quot;&gt;Eish&lt;/a&gt;, what goes on here? We did grant the permission in &lt;em&gt;Code Snippet 4&lt;/em&gt;, so what now? Hmm, if we compare the errors, we see that they are slightly different. The error before granting the permission is something like: &quot;The EXECUTE permission was denied ...&quot;, whereas the error after granting the permission is like: &quot;The user does not have permission ...&quot;. It seems that the code in &lt;em&gt;Code Snippet 4&lt;/em&gt; did something, but we still miss a piece (or multiple) of the puzzle, and it is permissions related. What permission(s) is the question?&lt;/p&gt;

&lt;p&gt;So I decided to try a &quot;brute force attack&quot;; find all built in permissions in SQL Server, browse through them and see if I see something promising. For this, I used a SQL Server function: &lt;code&gt;sys.fn_builtin_permissions&lt;/code&gt;, which - when executed - returns a description of the built-in permissions hierarchy of the server:&lt;/p&gt;

&lt;p&gt;&lt;figure class='code-highlight-figure'&gt;&lt;figcaption class='code-highlight-caption'&gt;&lt;span class='code-highlight-caption-title'&gt;Functions&lt;/span&gt;&lt;/figcaption&gt;&lt;div class='code-highlight'&gt;&lt;pre class='code-highlight-pre'&gt;&lt;div data-line='1' class='code-highlight-row numbered'&gt;&lt;div class='code-highlight-line'&gt;&lt;span class=&quot;k&quot;&gt;SELECT&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;FROM&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;fn_builtin_permissions&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;'database'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;/div&gt;&lt;/div&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/figure&gt;&lt;/p&gt;

&lt;p&gt;&lt;strong&gt;Code Snippet 5:&lt;/strong&gt; &lt;em&gt;Retrieve All Functions&lt;/em&gt;&lt;/p&gt;

&lt;p&gt;The parameter (&lt;code&gt;database&lt;/code&gt;) in &lt;em&gt;Code Snippet 5&lt;/em&gt; indicates what permissions I want back. In this case, I want all permissions on a database level. When I ran the code in &lt;em&gt;Code Snippet 5&lt;/em&gt; the function call returned 78 rows, and towards the end of the result I saw something promising:&lt;/p&gt;

&lt;p&gt;&lt;img class=&quot;center&quot; src=&quot;/images/posts/sql_ml_spees_permissions.png&quot; width=&quot;500&quot; height=&quot;155&quot;  &gt;
&lt;strong&gt;Figure 6:&lt;/strong&gt; &lt;em&gt;SPEES Execution Error&lt;/em&gt;&lt;/p&gt;

&lt;p&gt;The highligthed part in &lt;em&gt;Figure 6&lt;/em&gt; looks very interesting. I wonder what happens if I do something like this as admin/sa in the database the user is in:&lt;/p&gt;

&lt;p&gt;&lt;figure class='code-highlight-figure'&gt;&lt;figcaption class='code-highlight-caption'&gt;&lt;span class='code-highlight-caption-title'&gt;Functions&lt;/span&gt;&lt;/figcaption&gt;&lt;div class='code-highlight'&gt;&lt;pre class='code-highlight-pre'&gt;&lt;div data-line='1' class='code-highlight-row numbered'&gt;&lt;div class='code-highlight-line'&gt;&lt;span class=&quot;k&quot;&gt;GRANT&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;EXECUTE&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;ANY&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;EXTERNAL&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;SCRIPT&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;TO&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;user1&lt;/span&gt;&lt;/div&gt;&lt;/div&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/figure&gt;&lt;/p&gt;

&lt;p&gt;&lt;strong&gt;Code Snippet 5:&lt;/strong&gt; &lt;em&gt;Grant External Script&lt;/em&gt;&lt;/p&gt;

&lt;p&gt;The code in &lt;em&gt;Code Snippet 5&lt;/em&gt; ran without any issues, and &lt;code&gt;user1&lt;/code&gt; can then try following code:&lt;/p&gt;

&lt;p&gt;&lt;figure class='code-highlight-figure'&gt;&lt;figcaption class='code-highlight-caption'&gt;&lt;span class='code-highlight-caption-title'&gt;Another Try&lt;/span&gt;&lt;/figcaption&gt;&lt;div class='code-highlight'&gt;&lt;pre class='code-highlight-pre'&gt;&lt;div data-line='1' class='code-highlight-row numbered'&gt;&lt;div class='code-highlight-line'&gt;&lt;span class=&quot;k&quot;&gt;SELECT&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;SUSER_NAME&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;()&lt;/span&gt;
&lt;/div&gt;&lt;/div&gt;&lt;div data-line='2' class='code-highlight-row numbered'&gt;&lt;div class='code-highlight-line'&gt;&lt;span class=&quot;k&quot;&gt;EXECUTE&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;sp_execute_external_script&lt;/span&gt;
&lt;/div&gt;&lt;/div&gt;&lt;div data-line='3' class='code-highlight-row numbered'&gt;&lt;div class='code-highlight-line'&gt;             &lt;span class=&quot;o&quot;&gt;@&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;language&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;N&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;'R'&lt;/span&gt;
&lt;/div&gt;&lt;/div&gt;&lt;div data-line='4' class='code-highlight-row numbered'&gt;&lt;div class='code-highlight-line'&gt;           &lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;@&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;script&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;N&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;'
&lt;/div&gt;&lt;/div&gt;&lt;div data-line='5' class='code-highlight-row numbered'&gt;&lt;div class='code-highlight-line'&gt;               d&amp;lt;-42
&lt;/div&gt;&lt;/div&gt;&lt;div data-line='6' class='code-highlight-row numbered'&gt;&lt;div class='code-highlight-line'&gt;               OutputDataSet &amp;lt;- as.data.frame(d)'&lt;/span&gt;&lt;/div&gt;&lt;/div&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/figure&gt;&lt;/p&gt;

&lt;p&gt;&lt;strong&gt;Code Snippet 6:&lt;/strong&gt; &lt;em&gt;Another Try by user1&lt;/em&gt;&lt;/p&gt;

&lt;p&gt;The &lt;code&gt;SELECT SUSER_NAME()&lt;/code&gt; in &lt;em&gt;Code Snippet 6&lt;/em&gt; is there to verify that it is the correct user executing. The result when &lt;code&gt;user1&lt;/code&gt; executes looks like so:&lt;/p&gt;

&lt;p&gt;&lt;img class=&quot;center&quot; src=&quot;/images/posts/sql_ml_spees_user1_exec.png&quot; width=&quot;145&quot; height=&quot;130&quot;  &gt;
&lt;strong&gt;Figure 6:&lt;/strong&gt; &lt;em&gt;Successful Execution&lt;/em&gt;&lt;/p&gt;

&lt;p&gt;So that was the missing link: &lt;code&gt;GRANT EXECUTE ANY EXTERNAL SCRIPT TO ...&lt;/code&gt;, and to tell the truth; afterwards, I have seen a few posts on the net mentioning &lt;code&gt;EXECUTE ANY EXTERNAL SCRIPT&lt;/code&gt;.&lt;/p&gt;

&lt;p&gt;One more thing: above I mentioned that I favour granting the &lt;code&gt;EXECUTE&lt;/code&gt; on &lt;em&gt;SPEES&lt;/em&gt; to &lt;code&gt;public&lt;/code&gt; instead of adding the user to &lt;code&gt;master&lt;/code&gt;. The reason for this is what we just have seen: yes you do a &quot;blanket&quot; &lt;code&gt;GRANT&lt;/code&gt; by granting &lt;code&gt;public&lt;/code&gt;, but a user still needs to be granted &lt;code&gt;EXECUTE ANY EXTERNAL SCRIPT&lt;/code&gt; before he can &quot;go wild&quot;. That gives admins/dba's some control over who can execute &lt;em&gt;SPEES&lt;/em&gt;.&lt;/p&gt;

&lt;h2&gt;Summary&lt;/h2&gt;

&lt;p&gt;To allow a non-admin database user to execute &lt;code&gt;sp_execute_external_script&lt;/code&gt; you need to:&lt;/p&gt;

&lt;ul&gt;
&lt;li&gt;Grant &lt;code&gt;public&lt;/code&gt; execute permissions on &lt;code&gt;sp_execute_external_script&lt;/code&gt;, and you do it in &lt;code&gt;master&lt;/code&gt;. Obviously, you only need to do it once.&lt;/li&gt;
&lt;li&gt;Grant &lt;code&gt;EXECUTE ANY EXTERNAL SCRIPT&lt;/code&gt; to the user in the different databases he needs to execute &lt;em&gt;SPEES&lt;/em&gt; in.&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;That is it!&lt;/p&gt;

&lt;p&gt;One final thing: if you want to read more about &lt;code&gt;sp_execute_external_script&lt;/code&gt;, &lt;a href=&quot;/series/sql_server_2k16_r_services&quot;&gt;SQL Server R Services&lt;/a&gt; series has some posts.&lt;/p&gt;

&lt;h2&gt;~ Finally&lt;/h2&gt;

&lt;p&gt;If you have comments, questions etc., please comment on this post or &lt;a href=&quot;mailto:niels.it.berglund@gmail.com&quot;&gt;ping&lt;/a&gt; me.&lt;/p&gt;
</content>
 </entry>
 
 <entry>
   <title>Installing R Packages in SQL Server Machine Learning Services - I</title>
   <link href="http://nielsberglund.com/2018/06/23/installing-r-packages-in-sql-server-machine-learning-services-i/"/>
   <updated>2018-06-23T13:13:58+02:00</updated>
   <id>http://nielsberglund.com/2018/06/23/installing-r-packages-in-sql-server-machine-learning-services---i</id>
   <content type="html">&lt;p&gt;This post was supposed to be a single post about how to install R packages in SQL Server Machine Learning Services, but once again I completely misjudged the scope of the topic. So this one post turned into a series of posts about how to install R packages in &lt;strong&gt;SQL Server Machine Learning Services&lt;/strong&gt; and this is the first post in the series.&lt;/p&gt;

&lt;p&gt;To see other posts in the series go to &lt;a href=&quot;/series/sql_server_ml_services_install_packages&quot;&gt;&lt;strong&gt;Install R Packages in SQL Server ML Services Series&lt;/strong&gt;&lt;/a&gt;.&lt;/p&gt;

&lt;p&gt;As you may know, I am in the process of writing the follow-up post to &lt;a href=&quot;/2018/05/20/sp-execute-external-script-and-sql-compute-context/&quot;&gt;sp_execute_external_script and SQL Compute Context - I&lt;/a&gt;. However, I have a hard time getting into the flow of things, so I use any excuse I can, to not have to write. So when &lt;a href=&quot;https://www.linkedin.com/in/dane-bax/&quot;&gt;Dane Bax&lt;/a&gt;, a colleague of mine, contacted me a couple of days ago with a &lt;strong&gt;SQL Server Machine Learning Services&lt;/strong&gt; problem, I jumped at the chance to help him, and also write a post about it.&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://www.linkedin.com/in/dane-bax/&quot;&gt;Dane&lt;/a&gt; works for a sister company of &lt;a href=&quot;/Derivco&quot;&gt;Derivco&lt;/a&gt; as a data scientist and at both &lt;a href=&quot;/Derivco&quot;&gt;Derivco&lt;/a&gt; and the sister company - &lt;a href=&quot;https://www.microgaming.co.uk/&quot;&gt;Microgaming&lt;/a&gt; we are now looking at using SQL Server Machine Learning Services.&lt;/p&gt;

&lt;p&gt;His problem was that he wanted to use a CRAN package - &lt;code&gt;bsts&lt;/code&gt; - which is not part of a standard SQL Server R installation. He tried a couple of things to get it installed but got errors, so he decided to get in touch with me.&lt;/p&gt;

&lt;!--more--&gt;


&lt;blockquote&gt;&lt;p&gt;&lt;strong&gt;NOTE:&lt;/strong&gt; The package name &lt;code&gt;bsts&lt;/code&gt; stands for &lt;em&gt;Bayesian Structural Time Series&lt;/em&gt; and it performs time series regression using dynamic linear models fit using MCMC.&lt;/p&gt;&lt;/blockquote&gt;

&lt;h2&gt;Background&lt;/h2&gt;

&lt;p&gt;First of all; why would we need to install R packages if I already have R, either on my local machine or via SQL Server ML Services? Well, the answer to that is that there are a multitude of packages &quot;in the wild&quot; who do not necessarily come with your R engine of choice, and &lt;code&gt;bsts&lt;/code&gt; is an excellent example of this.&lt;/p&gt;

&lt;p&gt;If you are an R developer you are probably accustomed to installing packages on your R development environment at will, and - more or less - at whatever location you choose. When using SQL Server ML Services however, it does not work like that as SQL Server cannot load packages from external libraries, even if that library is on the same computer. So when using SQL Server ML Services, you can only install packages to a default library associated with the instance.&lt;/p&gt;

&lt;p&gt;The installation of packages can be done in different ways which is what this post is about - but before that, let us look at something somewhat different: &lt;strong&gt;Rtools&lt;/strong&gt;.&lt;/p&gt;

&lt;h2&gt;Rtools&lt;/h2&gt;

&lt;p&gt;The cool thing with R is that it is open source and you can run it on multiple platforms (Windows, Mac, Linux). So in essence, whatever package you want to use you can run on your platform of choice. If you install a package on Mac or Windows, R downloads and installs a pre-compiled (for your OS) packet. On Linux, R downloads the source of the package and builds it on your machine. For the build, R requires some external tools: &lt;code&gt;make&lt;/code&gt;, &lt;code&gt;tar&lt;/code&gt;, &lt;code&gt;gzip&lt;/code&gt;, C/C++ compiler and so forth.&lt;/p&gt;

&lt;p&gt;Why I mention this here is that certain packages do not have a binary built for Windows, and if you want to install such a package, you need to build the package from source on your environment. The problem with this is that most of the tools needed to build the package may not exist in the Windows environment.&lt;/p&gt;

&lt;p&gt;To be able to compile from source on Windows, the people behind R have made available an installer which installs the required tools for compilation of packages: &lt;strong&gt;Rtools&lt;/strong&gt;. So if you think that you ever need to compile an R package from source, then ensure that you have &lt;em&gt;Rtools&lt;/em&gt; installed. Why I bring this up is that the &lt;code&gt;bsts&lt;/code&gt; package has a dependency on a package that needs to be compiled.&lt;/p&gt;

&lt;h4&gt;Rtools Installation&lt;/h4&gt;

&lt;p&gt;While you can install R packages to a remote machine, keep in mind that &lt;em&gt;Rtools&lt;/em&gt; is not an R package as such, and it is not installed into the engine - but onto the machine where R is. So, for us here, we need to be on the machine that hosts SQL Server ML Services and run the installation on that machine.&lt;/p&gt;

&lt;p&gt;We need first to download the installer for &lt;em&gt;Rtools&lt;/em&gt;, and when you browse to the &lt;a href=&quot;https://cran.r-project.org/bin/windows/Rtools/index.html&quot;&gt;download page&lt;/a&gt;, you see there are multiple versions dependent on what version of R you have. To find the R version of your SQL Server ML Services installation you can run following code:&lt;/p&gt;

&lt;p&gt;&lt;figure class='code-highlight-figure'&gt;&lt;figcaption class='code-highlight-caption'&gt;&lt;span class='code-highlight-caption-title'&gt;Version&lt;/span&gt;&lt;/figcaption&gt;&lt;div class='code-highlight'&gt;&lt;pre class='code-highlight-pre'&gt;&lt;div data-line='1' class='code-highlight-row numbered'&gt;&lt;div class='code-highlight-line'&gt;&lt;span class=&quot;k&quot;&gt;EXEC&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;sp_execute_external_script&lt;/span&gt;
&lt;/div&gt;&lt;/div&gt;&lt;div data-line='2' class='code-highlight-row numbered'&gt;&lt;div class='code-highlight-line'&gt;                  &lt;span class=&quot;o&quot;&gt;@&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;language&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;N&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;'R'&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;
&lt;/div&gt;&lt;/div&gt;&lt;div data-line='3' class='code-highlight-row numbered'&gt;&lt;div class='code-highlight-line'&gt;                  &lt;span class=&quot;o&quot;&gt;@&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;script&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;N&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;'print(R.Version()$version)'&lt;/span&gt;&lt;/div&gt;&lt;/div&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/figure&gt;&lt;/p&gt;

&lt;p&gt;&lt;strong&gt;Code Snippet 1:&lt;/strong&gt; &lt;em&gt;Retrieve R Version&lt;/em&gt;&lt;/p&gt;

&lt;p&gt;When I run the code in &lt;em&gt;Code Snippet 1&lt;/em&gt; on my SQL Server ML Services instance, I see that the R version is &lt;code&gt;3.3.3&lt;/code&gt;, so I download &lt;code&gt;Rtools35.exe&lt;/code&gt; to my SQL Server machine and run the installer. By default &lt;em&gt;Rtools&lt;/em&gt; installs to &lt;code&gt;C:\RTools&lt;/code&gt; and R looks for compilers in the default installation path. If you install anywhere else, you have to point R to the path of &lt;code&gt;gcc&lt;/code&gt;, &lt;code&gt;g++&lt;/code&gt; and &lt;code&gt;ld&lt;/code&gt;, by setting a variable called BINPREF. &lt;em&gt;Rtools&lt;/em&gt; installation instructions discuss this in detail. During the install ensure you check the checkbox for &quot;Add rtools to system PATH&quot;:&lt;/p&gt;

&lt;p&gt;&lt;img class=&quot;center&quot; src=&quot;/images/posts/sql_ml_install_r_pckgs_rtools_path.png&quot; width=&quot;500&quot; height=&quot;180&quot;  &gt;
&lt;strong&gt;Figure 1:&lt;/strong&gt; &lt;em&gt;Adding Rtools to PATH&lt;/em&gt;&lt;/p&gt;

&lt;p&gt;After having checked the box for editing the PATH as in &lt;em&gt;Figure 1&lt;/em&gt;, click through and let the install finish. After installation, it is a good practice to check that the PATH is set. You can do this by running &lt;code&gt;RTerm.exe&lt;/code&gt; (on the SQL Server box) and execute &lt;code&gt;Sys.getenv('PATH')&lt;/code&gt; from RTerm's command prompt. You find &lt;code&gt;RTerm.exe&lt;/code&gt; at the &lt;code&gt;R_SERVICES\bin\x64&lt;/code&gt; directory under the path to the SQL Server instance. For example: &lt;code&gt;C:\Program Files\Microsoft SQL Server\MSSQL14.MSSQLSERVER\R_SERVICES\bin\x64&lt;/code&gt;.&lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;&lt;strong&gt;NOTE:&lt;/strong&gt; Just a word of caution here. When I installed &lt;code&gt;Rtools35.exe&lt;/code&gt; I had to manually add to PATH the path to the compilers: &lt;code&gt;C:\Rtools\mingw_64\bin&lt;/code&gt;. So look out for that .&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;You should also check that you can call the C++ compiler: &lt;code&gt;system('g++ -v')&lt;/code&gt; (this is how I realised the path was not correct). That should result in something like:&lt;/p&gt;

&lt;p&gt;&lt;img class=&quot;center&quot; src=&quot;/images/posts/sql_ml_install_r_pckgs_rtools_g++.png&quot; width=&quot;515&quot; height=&quot;420&quot;  &gt;
&lt;strong&gt;Figure 2:&lt;/strong&gt; &lt;em&gt;Checking for C++ Compiler&lt;/em&gt;&lt;/p&gt;

&lt;p&gt;If everything looks OK, &lt;em&gt;Rtools&lt;/em&gt; have now been installed, and the various instances of R (from SQL Server ML instances) can share the &lt;em&gt;Rtools&lt;/em&gt; toolchain.&lt;/p&gt;

&lt;h2&gt;R Packages Installation&lt;/h2&gt;

&lt;p&gt;When we install R packages for SQL Server ML Services we install them on a per SQL Server instance, and we can install these packages different in ways:&lt;/p&gt;

&lt;ul&gt;
&lt;li&gt;R packet managers.&lt;/li&gt;
&lt;li&gt;T-SQL.&lt;/li&gt;
&lt;li&gt;RevoScaleR.&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;Regardless how we install the packages, they can only be installed to the default packet library for that instance. The file system folder for this library has restricted access and to write to this folder you need admin rights. Well, that is not entirely correct - with some configuration changes even non-admin can install packages via T-SQL and RevoScaleR. However, as we see later, the installation is against the current database.&lt;/p&gt;

&lt;h4&gt;R Code for Installation&lt;/h4&gt;

&lt;p&gt;Before we look at the ways we can install and the tools for installation; what does the code we use to do the installation look like?&lt;/p&gt;

&lt;p&gt;As you probably know, the way to install R packages is through the &lt;code&gt;install.packages&lt;/code&gt; command. The command has quite a few parameters as you can see &lt;a href=&quot;https://www.rdocumentation.org/packages/utils/versions/3.5.0/topics/install.packages&quot;&gt;here&lt;/a&gt;, but when I install packages I use only a few of the parameters, regardless of the way I install the package:&lt;/p&gt;

&lt;p&gt;&lt;figure class='code-highlight-figure'&gt;&lt;figcaption class='code-highlight-caption'&gt;&lt;span class='code-highlight-caption-title'&gt;Install&lt;/span&gt;&lt;/figcaption&gt;&lt;div class='code-highlight'&gt;&lt;pre class='code-highlight-pre'&gt;&lt;div data-line='1' class='code-highlight-row numbered'&gt;&lt;div class='code-highlight-line'&gt;&lt;span class=&quot;c1&quot;&gt;# get the library path&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;&lt;/span&gt;
&lt;/div&gt;&lt;/div&gt;&lt;div data-line='2' class='code-highlight-row numbered'&gt;&lt;div class='code-highlight-line'&gt;&lt;span class=&quot;n&quot;&gt;libPath&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;lt;-&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;.libPaths&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;()[&lt;/span&gt;&lt;span class=&quot;m&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;&lt;/span&gt;
&lt;/div&gt;&lt;/div&gt;&lt;div data-line='3' class='code-highlight-row numbered'&gt;&lt;div class='code-highlight-line'&gt;&lt;span class=&quot;n&quot;&gt;install.packages&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;pkg_name&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;lib&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;libPath&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
&lt;/div&gt;&lt;/div&gt;&lt;div data-line='4' class='code-highlight-row numbered'&gt;&lt;div class='code-highlight-line'&gt;                  &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;repos&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;url_for_the_repo&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
&lt;/div&gt;&lt;/div&gt;&lt;div data-line='5' class='code-highlight-row numbered'&gt;&lt;div class='code-highlight-line'&gt;                  &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;dependencies&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;kc&quot;&gt;TRUE&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;&lt;/span&gt;&lt;/div&gt;&lt;/div&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/figure&gt;&lt;/p&gt;

&lt;p&gt;&lt;strong&gt;Code Snippet 2:&lt;/strong&gt; &lt;em&gt;Install Packages Command&lt;/em&gt;&lt;/p&gt;

&lt;p&gt;In &lt;em&gt;Code Snippet 2&lt;/em&gt; we see how I first retrieve the library path. This is where I install the package to, and once again - I can only install to the default instance directory. Then in the &lt;code&gt;install.packages&lt;/code&gt; call I use these parameters:&lt;/p&gt;

&lt;ul&gt;
&lt;li&gt;First parameter is always the name of the package(s) to install.&lt;/li&gt;
&lt;li&gt;&lt;code&gt;lib&lt;/code&gt;: is for the library folder to install to.&lt;/li&gt;
&lt;li&gt;&lt;code&gt;repos&lt;/code&gt;: the base URL(s) of the repositories to use. If left out, the repo used is the Microsoft MRAN repo, which may not be what you want.&lt;/li&gt;
&lt;li&gt;&lt;code&gt;dependencies&lt;/code&gt;: indicating whether to also install missing packages which these packages depend on/link to/import/suggest (and so on recursively).&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;So that is the code for installation of packages. What if you want to see what packages are installed on a particular instance of SQL Server ML Services? For that you can execute something like so from &lt;strong&gt;SQL Server Management Studio&lt;/strong&gt; (SSMS):&lt;/p&gt;

&lt;p&gt;&lt;figure class='code-highlight-figure'&gt;&lt;figcaption class='code-highlight-caption'&gt;&lt;span class='code-highlight-caption-title'&gt;Installed Packages&lt;/span&gt;&lt;/figcaption&gt;&lt;div class='code-highlight'&gt;&lt;pre class='code-highlight-pre'&gt;&lt;div data-line='1' class='code-highlight-row numbered'&gt;&lt;div class='code-highlight-line'&gt;&lt;span class=&quot;k&quot;&gt;EXEC&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;sp_execute_external_script&lt;/span&gt;
&lt;/div&gt;&lt;/div&gt;&lt;div data-line='2' class='code-highlight-row numbered'&gt;&lt;div class='code-highlight-line'&gt;                    &lt;span class=&quot;o&quot;&gt;@&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;language&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;N&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;'R'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;
&lt;/div&gt;&lt;/div&gt;&lt;div data-line='3' class='code-highlight-row numbered'&gt;&lt;div class='code-highlight-line'&gt;                    &lt;span class=&quot;o&quot;&gt;@&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;script&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;N&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;'
&lt;/div&gt;&lt;/div&gt;&lt;div data-line='4' class='code-highlight-row numbered'&gt;&lt;div class='code-highlight-line'&gt;                    OutputDataSet &amp;lt;- data.frame(
&lt;/div&gt;&lt;/div&gt;&lt;div data-line='5' class='code-highlight-row numbered'&gt;&lt;div class='code-highlight-line'&gt;                    installed.packages()[,c(&quot;Package&quot;, &quot;Version&quot;,
&lt;/div&gt;&lt;/div&gt;&lt;div data-line='6' class='code-highlight-row numbered'&gt;&lt;div class='code-highlight-line'&gt;                                        &quot;Depends&quot;, &quot;License&quot;,
&lt;/div&gt;&lt;/div&gt;&lt;div data-line='7' class='code-highlight-row numbered'&gt;&lt;div class='code-highlight-line'&gt;                                        &quot;Built&quot;, &quot;LibPath&quot;)]);'&lt;/span&gt;
&lt;/div&gt;&lt;/div&gt;&lt;div data-line='8' class='code-highlight-row numbered'&gt;&lt;div class='code-highlight-line'&gt;&lt;span class=&quot;k&quot;&gt;WITH&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;RESULT&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;SETS&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;((&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;Package&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;nvarchar&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;255&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;),&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;Version&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;nvarchar&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;100&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;),&lt;/span&gt;
&lt;/div&gt;&lt;/div&gt;&lt;div data-line='9' class='code-highlight-row numbered'&gt;&lt;div class='code-highlight-line'&gt;                   &lt;span class=&quot;n&quot;&gt;Depends&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;nvarchar&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;4000&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;),&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;License&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;nvarchar&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;1000&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;),&lt;/span&gt;
&lt;/div&gt;&lt;/div&gt;&lt;div data-line='10' class='code-highlight-row numbered'&gt;&lt;div class='code-highlight-line'&gt;                   &lt;span class=&quot;n&quot;&gt;Built&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;nvarchar&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;100&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;),&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;LibPath&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;nvarchar&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;2000&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)));&lt;/span&gt;&lt;/div&gt;&lt;/div&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/figure&gt;&lt;/p&gt;

&lt;p&gt;&lt;strong&gt;Code Snippet 3:&lt;/strong&gt; &lt;em&gt;Retrieve Installed R Packages&lt;/em&gt;&lt;/p&gt;

&lt;p&gt;So now when we have seen some code how to install packages (and also see what packages already exists), in this post let us look at using R packet managers for the installation.&lt;/p&gt;

&lt;h2&gt;R Packet Managers&lt;/h2&gt;

&lt;p&gt;What is an R packet manager? It is an R command line tool or GUI installed on the SQL Server Machine Learning Services machine that can run with elevated permissions and target the R engine for the instance on which you want to install the package. The easiest is to use either of the R tools that come as part as part of SQL Server's R service:&lt;/p&gt;

&lt;ul&gt;
&lt;li&gt;The command line tool: &lt;code&gt;Rterm.exe&lt;/code&gt;.&lt;/li&gt;
&lt;li&gt;The GUI: &lt;code&gt;Rgui.exe&lt;/code&gt;.&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;Once again you need to be able to run them with elevated access, so you need admin rights on the machine, and they can only run locally.&lt;/p&gt;

&lt;p&gt;So let us say that &lt;a href=&quot;https://www.linkedin.com/in/dane-bax/&quot;&gt;Dane&lt;/a&gt; (from above) wants to install the &lt;code&gt;bsts&lt;/code&gt; package mentioned above and he has admin rights on the machine SQL Server is installed on. The choice he has is to use &lt;code&gt;Rterm.exe&lt;/code&gt; or &lt;code&gt;Rgui.exe&lt;/code&gt;. Dane is not really into command line, so he uses &lt;code&gt;Rgui.exe&lt;/code&gt;:&lt;/p&gt;

&lt;ul&gt;
&lt;li&gt;He logs onto the SQL Server machine either directly or via &lt;em&gt;Terminal Services&lt;/em&gt;.&lt;/li&gt;
&lt;li&gt;He navigates to where &lt;code&gt;Rgui.exe&lt;/code&gt; is (the same path as above for &lt;code&gt;Rterm.exe&lt;/code&gt;).&lt;/li&gt;
&lt;li&gt;He right clicks on &lt;code&gt;Rgui.exe&lt;/code&gt;:&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;&lt;img class=&quot;center&quot; src=&quot;/images/posts/sql_ml_install_r_pckgs_rgui.png&quot; width=&quot;550&quot; height=&quot;365&quot;  &gt;
&lt;strong&gt;Figure 3:&lt;/strong&gt; &lt;em&gt;Run Rgui as Admin&lt;/em&gt;&lt;/p&gt;

&lt;p&gt;When he clicks on &quot;Run as administrator&quot; the Rgui application starts up in the context of the R engine of the instance of SQL Server ML Services:&lt;/p&gt;

&lt;p&gt;&lt;img class=&quot;center&quot; src=&quot;/images/posts/sql_ml_install_r_pckgs_rgui2.png&quot; width=&quot;465&quot; height=&quot;340&quot;  &gt;
&lt;strong&gt;Figure 4:&lt;/strong&gt; &lt;em&gt;Rgui&lt;/em&gt;&lt;/p&gt;

&lt;p&gt;In the R Console in Rgui Dane now enters this code:&lt;/p&gt;

&lt;p&gt;&lt;figure class='code-highlight-figure'&gt;&lt;figcaption class='code-highlight-caption'&gt;&lt;span class='code-highlight-caption-title'&gt;bsts&lt;/span&gt;&lt;/figcaption&gt;&lt;div class='code-highlight'&gt;&lt;pre class='code-highlight-pre'&gt;&lt;div data-line='1' class='code-highlight-row numbered'&gt;&lt;div class='code-highlight-line'&gt;&lt;span class=&quot;o&quot;&gt;&amp;gt;&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;libPath&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;lt;-&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;.libPaths&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;()[&lt;/span&gt;&lt;span class=&quot;m&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;&lt;/span&gt;
&lt;/div&gt;&lt;/div&gt;&lt;div data-line='2' class='code-highlight-row numbered'&gt;&lt;div class='code-highlight-line'&gt;&lt;span class=&quot;o&quot;&gt;&amp;gt;&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;install.packages&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;bsts&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;repos&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;https://cloud.r-project.org/&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;
&lt;/div&gt;&lt;/div&gt;&lt;div data-line='3' class='code-highlight-row numbered'&gt;&lt;div class='code-highlight-line'&gt;&lt;span class=&quot;o&quot;&gt;+&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;                  &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;dependencies&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;kc&quot;&gt;TRUE&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;lib&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;libPath&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;&lt;/span&gt;&lt;/div&gt;&lt;/div&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/figure&gt;&lt;/p&gt;

&lt;p&gt;&lt;strong&gt;Code Snippet 4:&lt;/strong&gt; &lt;em&gt;Install bsts&lt;/em&gt;&lt;/p&gt;

&lt;p&gt;In &lt;em&gt;Code Snippet 4&lt;/em&gt; we see that Dane uses the open source &lt;em&gt;CRAN&lt;/em&gt; repo which hosts &lt;code&gt;bsts&lt;/code&gt;. When he executes the code, it looks like so:&lt;/p&gt;

&lt;p&gt;&lt;img class=&quot;center&quot; src=&quot;/images/posts/sql_ml_install_r_pckgs.png&quot; width=&quot;600&quot; height=&quot;245&quot;  &gt;
&lt;strong&gt;Figure 4:&lt;/strong&gt; &lt;em&gt;Execute install.packages&lt;/em&gt;&lt;/p&gt;

&lt;p&gt;At the highlighted question in &lt;em&gt;Figure 4&lt;/em&gt; (at the bottom) it is best to answer no. Even though Dane said no to compilations, quite a lot of compilations happens for the &lt;code&gt;Boom&lt;/code&gt; package:&lt;/p&gt;

&lt;p&gt;&lt;img class=&quot;center&quot; src=&quot;/images/posts/sql_ml_install_r_pckgs_compile.png&quot; width=&quot;550&quot; height=&quot;245&quot;  &gt;
&lt;strong&gt;Figure 5:&lt;/strong&gt; &lt;em&gt;C++ Compilation&lt;/em&gt;&lt;/p&gt;

&lt;p&gt;The installation process runs for quite a while, due to the compilation of the &lt;code&gt;Boom&lt;/code&gt; package, but eventually, it finishes:&lt;/p&gt;

&lt;p&gt;&lt;img class=&quot;center&quot; src=&quot;/images/posts/sql_ml_install_r_pckgs_success.png&quot; width=&quot;450&quot; height=&quot;285&quot;  &gt;
&lt;strong&gt;Figure 6:&lt;/strong&gt; &lt;em&gt;Install Success&lt;/em&gt;&lt;/p&gt;

&lt;p&gt;Dane can now check and see if the &lt;code&gt;bsts&lt;/code&gt; package has installed and he executes the code in &lt;em&gt;Code Snippet 3&lt;/em&gt; to verify that &lt;code&gt;bsts&lt;/code&gt; is indeed installed together with the dependent packages. To further confirm that the package exists and functions he can try to load it from &lt;em&gt;SSMS&lt;/em&gt;:&lt;/p&gt;

&lt;p&gt;&lt;figure class='code-highlight-figure'&gt;&lt;figcaption class='code-highlight-caption'&gt;&lt;span class='code-highlight-caption-title'&gt;Load bsts&lt;/span&gt;&lt;/figcaption&gt;&lt;div class='code-highlight'&gt;&lt;pre class='code-highlight-pre'&gt;&lt;div data-line='1' class='code-highlight-row numbered'&gt;&lt;div class='code-highlight-line'&gt;&lt;span class=&quot;k&quot;&gt;EXEC&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;sp_execute_external_script&lt;/span&gt;
&lt;/div&gt;&lt;/div&gt;&lt;div data-line='2' class='code-highlight-row numbered'&gt;&lt;div class='code-highlight-line'&gt;                  &lt;span class=&quot;o&quot;&gt;@&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;language&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;N&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;'R'&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;
&lt;/div&gt;&lt;/div&gt;&lt;div data-line='3' class='code-highlight-row numbered'&gt;&lt;div class='code-highlight-line'&gt;                  &lt;span class=&quot;o&quot;&gt;@&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;script&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;N&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;'library(&quot;bsts&quot;)'&lt;/span&gt;&lt;/div&gt;&lt;/div&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/figure&gt;&lt;/p&gt;

&lt;p&gt;&lt;strong&gt;Code Snippet 8:&lt;/strong&gt; &lt;em&gt;Loading the bsts Library&lt;/em&gt;&lt;/p&gt;

&lt;p&gt;Executing the code in &lt;em&gt;Code Snippet 8&lt;/em&gt; results in:&lt;/p&gt;

&lt;p&gt;&lt;img class=&quot;center&quot; src=&quot;/images/posts/sql_ml_install_r_pckgs_loading_bsts.png&quot; width=&quot;400&quot; height=&quot;325&quot;  &gt;
&lt;strong&gt;Figure 7:&lt;/strong&gt; &lt;em&gt;Loading bsts&lt;/em&gt;&lt;/p&gt;

&lt;p&gt;From &lt;em&gt;Figure 7&lt;/em&gt; it seems that everything has worked, sweet!&lt;/p&gt;

&lt;p&gt;That is cool, no?! Well, there is one drawback with this: Dane has to have admin rights on the SQL Server box and, no offense Dane, but who in their right minds would give Dane those rights on a production SQL Server box!&lt;/p&gt;

&lt;p&gt;Jokes aside, using an R packet manager may be too inconvenient, e.g. anytime a developer want to install packages, someone with admin rights on the box needs to install said packages. In coming posts we look at other options for installing packages.&lt;/p&gt;

&lt;h2&gt;Summary&lt;/h2&gt;

&lt;p&gt;In this post we covered:&lt;/p&gt;

&lt;ul&gt;
&lt;li&gt;When you install packages sometimes they require compilation. For that, &lt;strong&gt;Rtools&lt;/strong&gt; should be on the box where SQL Server ML Services lives.&lt;/li&gt;
&lt;li&gt;There are multiple ways we can install packages:

&lt;ul&gt;
&lt;li&gt;R packet managers.&lt;/li&gt;
&lt;li&gt;T-SQL.&lt;/li&gt;
&lt;li&gt;RevoScaleR.&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;An R packet manager is an R command line tool or GUI installed on the SQL Server Machine Learning Services machine that can run with elevated permissions and target the R engine for the instance on which you want to install the package.&lt;/li&gt;
&lt;li&gt;SQL Server ML Services ships with two R packet manager: &lt;code&gt;Rterm.exe&lt;/code&gt; and &lt;code&gt;Rgui.exe&lt;/code&gt;.&lt;/li&gt;
&lt;li&gt;These two packet managers lives in &lt;code&gt;\\&amp;lt;path_to_SQL_Server_instance&amp;gt;\R_SERVICES\bin\x64&lt;/code&gt;.&lt;/li&gt;
&lt;li&gt;When using a packet manager to install a package, you run the packet manager from an elevated command prompt.&lt;/li&gt;
&lt;li&gt;You can use the R command &lt;code&gt;install.packages&lt;/code&gt; to install a package from the package manager.&lt;/li&gt;
&lt;/ul&gt;


&lt;h2&gt;~ Finally&lt;/h2&gt;

&lt;p&gt;If you have comments, questions etc., please comment on this post or &lt;a href=&quot;mailto:niels.it.berglund@gmail.com&quot;&gt;ping&lt;/a&gt; me.&lt;/p&gt;
</content>
 </entry>
 
 <entry>
   <title>Interesting Stuff - Week 24</title>
   <link href="http://nielsberglund.com/2018/06/17/interesting-stuff-week-24/"/>
   <updated>2018-06-17T19:29:19+02:00</updated>
   <id>http://nielsberglund.com/2018/06/17/interesting-stuff---week-24</id>
   <content type="html">&lt;p&gt;Throughout the week, I read a lot of blog-posts, articles, and so forth, that has to do with things that interest me:&lt;/p&gt;

&lt;ul&gt;
&lt;li&gt;data science&lt;/li&gt;
&lt;li&gt;data in general&lt;/li&gt;
&lt;li&gt;distributed computing&lt;/li&gt;
&lt;li&gt;SQL Server&lt;/li&gt;
&lt;li&gt;transactions (both db as well as non db)&lt;/li&gt;
&lt;li&gt;and other &quot;stuff&quot;&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;This blog-post is the &quot;roundup&quot; of the things that have been most interesting to me, for the week just ending.&lt;/p&gt;

&lt;!--more--&gt;


&lt;h2&gt;.NET&lt;/h2&gt;

&lt;ul&gt;
&lt;li&gt;&lt;a href=&quot;https://blogs.msdn.microsoft.com/dotnet/2018/06/13/using-net-and-docker-together-dockercon-2018-update/&quot;&gt;Using .NET and Docker Together – DockerCon 2018 Update&lt;/a&gt;. What the title says; how to use .NET and Docker together.&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;http://mattwarren.org/2018/06/15/Tools-for-Exploring-.NET-Internals/&quot;&gt;Tools for Exploring .NET Internals&lt;/a&gt;. An excellent write up by &lt;a href=&quot;https://twitter.com/matthewwarren&quot;&gt;Matthew&lt;/a&gt; about tools you can use to better understand what goes on in the CLR.&lt;/li&gt;
&lt;/ul&gt;


&lt;h2&gt;Big Data / Cloud&lt;/h2&gt;

&lt;ul&gt;
&lt;li&gt;&lt;a href=&quot;https://azure.microsoft.com/en-us/blog/control-azure-data-lake-costs-using-log-analytics-to-create-service-alerts/&quot;&gt;Control Azure Data Lake costs using Log Analytics to create service alerts&lt;/a&gt;. This blog post talks about Azure Data Lake Store (ADLS) and &lt;a href=&quot;https://azure.microsoft.com/en-us/services/log-analytics/&quot;&gt;Azure Log Analytics&lt;/a&gt; (ALA) and how you can use ALA to control ADLS costs. Very informative!&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;https://medium.com/netflix-techblog/metacat-making-big-data-discoverable-and-meaningful-at-netflix-56fb36a53520&quot;&gt;Metacat: Making Big Data Discoverable and Meaningful at Netflix&lt;/a&gt;. This post is about Netflix Metacat system. A system that acts as a federated metadata access layer for all data stores Netflix has.&lt;/li&gt;
&lt;/ul&gt;


&lt;h2&gt;Distributed Computing&lt;/h2&gt;

&lt;ul&gt;
&lt;li&gt;&lt;a href=&quot;https://blog.acolyer.org/2018/06/13/medea-scheduling-of-long-running-applications-in-shared-production-clusters/&quot;&gt;Medea: scheduling of long running applications in shared production clusters&lt;/a&gt;. &lt;a href=&quot;https://twitter.com/adriancolyer&quot;&gt;Adrian&lt;/a&gt; dissects a white paper about Medea. Medea is designed to support the use case of mixed long running applications and shorter duration tasks within the same cluster.&lt;/li&gt;
&lt;/ul&gt;


&lt;h2&gt;Streaming&lt;/h2&gt;

&lt;ul&gt;
&lt;li&gt;&lt;a href=&quot;https://notetoself.tech/2018/06/03/acessing-event-hubs-with-confluent-kafka-library/&quot;&gt;Acessing Event Hubs with Confluent Kafka Library&lt;/a&gt;. Last month - some time - Microsoft announced EventHubs support for the Kafka protocol. What Kafka protocol support means is that you can use the Kafka client libraries to ingest data into an EventHub, sweet! This blog post shows an example of how to do that.&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;http://strimzi.io/&quot;&gt;Deploying Kafka on Kubernetes with Local Persistent Volumes using Strimzi&lt;/a&gt;. So &lt;a href=&quot;http://strimzi.io/&quot;&gt;Strimzi&lt;/a&gt; is a system which provides the ability to run Kafka clusters on OpenShift and Kubernetes. The blog post discusses various Kafka storage options when running Kafka this way.&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;https://www.infoq.com/articles/democratizing-stream-processing-apache-kafka-ksql&quot;&gt;Democratizing Stream Processing with Apache Kafka and KSQL&lt;/a&gt;. An article which discusses stream processing with KSQL, the streaming SQL engine for Apache Kafka, and how KSQL helps to bridge the world of streams and databases through streams and tables.&lt;/li&gt;
&lt;/ul&gt;


&lt;h2&gt;Data Science&lt;/h2&gt;

&lt;ul&gt;
&lt;li&gt;&lt;a href=&quot;https://eng.uber.com/advanced-technologies-detecting-preventing-fraud-uber/&quot;&gt;Advanced Technologies for Detecting and Preventing Fraud at Uber&lt;/a&gt;. A blog post discussing how Uber leverages cutting-edge systems to tackle fraud on their platform.&lt;/li&gt;
&lt;/ul&gt;


&lt;h2&gt;SQL Server Machine Learning Services&lt;/h2&gt;

&lt;p&gt;At the moment I have two posts about &lt;strong&gt;SQL Server Machine Learning Services&lt;/strong&gt; &quot;on the go&quot;. The first is the never-ending follow-up post to my &lt;a href=&quot;/2018/05/20/sp-execute-external-script-and-sql-compute-context/&quot;&gt;sp_execute_external_script and SQL Compute Context - I&lt;/a&gt; post from four weeks ago. I can not seem to get that one done.&lt;/p&gt;

&lt;p&gt;The second is a post about the options you have if you want to install R packages into &lt;strong&gt;SQL Server Machine Learning Services&lt;/strong&gt;. For that one I have good hopes to be able to publish this coming week sometime.&lt;/p&gt;

&lt;h2&gt;~ Finally&lt;/h2&gt;

&lt;p&gt;That's all for this week. I hope you enjoy what I did put together. If you have ideas for what to cover, please comment on this post or &lt;a href=&quot;mailto:niels.it.berglund@gmail.com&quot;&gt;ping&lt;/a&gt; me.&lt;/p&gt;
</content>
 </entry>
 
 <entry>
   <title>Interesting Stuff - Week 23</title>
   <link href="http://nielsberglund.com/2018/06/10/interesting-stuff-week-23/"/>
   <updated>2018-06-10T10:10:24+02:00</updated>
   <id>http://nielsberglund.com/2018/06/10/interesting-stuff---week-23</id>
   <content type="html">&lt;p&gt;Throughout the week, I read a lot of blog-posts, articles, and so forth, that has to do with things that interest me:&lt;/p&gt;

&lt;ul&gt;
&lt;li&gt;data science&lt;/li&gt;
&lt;li&gt;data in general&lt;/li&gt;
&lt;li&gt;distributed computing&lt;/li&gt;
&lt;li&gt;SQL Server&lt;/li&gt;
&lt;li&gt;transactions (both db as well as non db)&lt;/li&gt;
&lt;li&gt;and other &quot;stuff&quot;&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;This blog-post is the &quot;roundup&quot; of the things that have been most interesting to me, for the week just ending.&lt;/p&gt;

&lt;!--more--&gt;


&lt;h2&gt;Distributed Computing&lt;/h2&gt;

&lt;ul&gt;
&lt;li&gt;&lt;a href=&quot;https://blog.acolyer.org/2018/06/05/servicefabric-a-distributed-platform-for-building-microservices-in-the-cloud/&quot;&gt;ServiceFabric: a distributed platform for building microservices in the cloud&lt;/a&gt;. &lt;strong&gt;Service Fabric&lt;/strong&gt; (SF) is Microsoft's platform to support microservices applications both in the cloud as well as on-prem. In this blog post &lt;a href=&quot;https://twitter.com/adriancolyer&quot;&gt;Adrian&lt;/a&gt; dissects a white paper about the internal workings of Service Fabric. As we in &lt;a href=&quot;/Derivco&quot;&gt;Derivco&lt;/a&gt; are using SF I have made this white paper recommended reading for my developers.&lt;/li&gt;
&lt;/ul&gt;


&lt;h2&gt;Streaming&lt;/h2&gt;

&lt;ul&gt;
&lt;li&gt;&lt;a href=&quot;https://www.youtube.com/channel/UCmZz-Gj3caLLzEWBtbYUXaA&quot;&gt;Confluent Kafka Videos&lt;/a&gt;. This link is to a YouTube video library of Kafka videos. If you are interested in Kafka, then I recommend you watch these videos.&lt;/li&gt;
&lt;/ul&gt;


&lt;h2&gt;Big Data / Cloud&lt;/h2&gt;

&lt;ul&gt;
&lt;li&gt;&lt;a href=&quot;https://azure.microsoft.com/en-us/blog/process-more-files-than-ever-and-use-parquet-with-azure-data-lake-analytics/&quot;&gt;Process more files than ever and use Parquet with Azure Data Lake Analytics&lt;/a&gt;. A blog post about how Azure Data Analytics now has capabilities for processing files of any formats including Parquet at tremendous scale.&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;https://www.microsoft.com/en-us/research/blog/microsoft-unveils-faster-key-value-store-large-state-management/&quot;&gt;Microsoft Unveils FASTER – a key-value store for large state management&lt;/a&gt;. &lt;strong&gt;FASTER&lt;/strong&gt; is a new embedded key-value store invented by Microsoft Research, and this blog post discusses how FASTER works.&lt;/li&gt;
&lt;/ul&gt;


&lt;h2&gt;Data Science&lt;/h2&gt;

&lt;ul&gt;
&lt;li&gt;&lt;a href=&quot;https://www.infoq.com/presentations/ml-dl-visualization&quot;&gt;Understanding ML/DL Models using Interactive Visualization Techniques&lt;/a&gt;. A presentation via &lt;a href=&quot;https://www.infoq.com/&quot;&gt;InfoQ&lt;/a&gt; about how to use visualisation techniques to better understand machine learning and deep learning models. When I shared this with the data scientists at &lt;a href=&quot;/Derivco&quot;&gt;Derivco&lt;/a&gt;, they were keen on testing it out themselves.&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;https://blogs.msdn.microsoft.com/dotnet/2018/06/05/announcing-ml-net-0-2/&quot;&gt;Announcing ML.NET 0.2&lt;/a&gt;. A blog post announcing version 0.2 of &lt;strong&gt;ML.NET&lt;/strong&gt;, the .NET based cross-platform, open source machine learning framework. This release adds new ML tasks like clustering, making it easier to validate models, and also a brand-new repo for &lt;a href=&quot;https://github.com/dotnet/machinelearning/tree/master/test/Microsoft.ML.Tests&quot;&gt;ML.NET samples&lt;/a&gt;. Check it out!&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;https://databricks.com/blog/2018/06/05/introducing-mlflow-an-open-source-machine-learning-platform.html&quot;&gt;Introducing MLflow: an Open Source Machine Learning Platform&lt;/a&gt;. A blog post about &lt;strong&gt;MLFlow&lt;/strong&gt;: an open source platform designed to manage the entire machine learning lifecycle and work with any machine learning library. It looks quite interesting, and at some stage, I may have a go at it.&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;https://www.infoq.com/presentations/booking-dl-models&quot;&gt;Tools to Put Deep Learning Models in Production&lt;/a&gt;. A presentation about how Booking.com supports data scientists by making it easy to put their models in production, and how they optimise their model prediction infrastructure for latency or throughput.&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;https://blogs.technet.microsoft.com/machinelearning/2018/06/04/free-e-book-a-developers-guide-to-building-ai-applications/&quot;&gt;Free E-Book: A Developer’s Guide to Building AI Applications&lt;/a&gt;. A free e-book (requires registration though) which walks you through the process of building intelligent cloud-based bots.&lt;/li&gt;
&lt;/ul&gt;


&lt;h2&gt;SQL Server Machine Learning Services&lt;/h2&gt;

&lt;p&gt;I am still busy writing the follow-up post to my &lt;a href=&quot;/2018/05/20/sp-execute-external-script-and-sql-compute-context/&quot;&gt;sp_execute_external_script and SQL Compute Context - I&lt;/a&gt; post from three weeks ago. The post is supposed to be about why executing code in the &lt;strong&gt;SQL Server Compute Context&lt;/strong&gt; gives so much better performance than when executing in the local context. Initially, I thought it was straightforward; boy was I wrong.&lt;/p&gt;

&lt;h2&gt;~ Finally&lt;/h2&gt;

&lt;p&gt;That's all for this week. I hope you enjoy what I did put together. If you have ideas for what to cover, please comment on this post or &lt;a href=&quot;mailto:niels.it.berglund@gmail.com&quot;&gt;ping&lt;/a&gt; me.&lt;/p&gt;
</content>
 </entry>
 
 <entry>
   <title>Interesting Stuff - Week 22</title>
   <link href="http://nielsberglund.com/2018/06/03/interesting-stuff-week-22/"/>
   <updated>2018-06-03T09:41:05+02:00</updated>
   <id>http://nielsberglund.com/2018/06/03/interesting-stuff---week-22</id>
   <content type="html">&lt;p&gt;Throughout the week, I read a lot of blog-posts, articles, and so forth, that has to do with things that interest me:&lt;/p&gt;

&lt;ul&gt;
&lt;li&gt;data science&lt;/li&gt;
&lt;li&gt;data in general&lt;/li&gt;
&lt;li&gt;distributed computing&lt;/li&gt;
&lt;li&gt;SQL Server&lt;/li&gt;
&lt;li&gt;transactions (both db as well as non db)&lt;/li&gt;
&lt;li&gt;and other &quot;stuff&quot;&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;This blog-post is the &quot;roundup&quot; of the things that have been most interesting to me, for the week just ending.&lt;/p&gt;

&lt;!--more--&gt;


&lt;h2&gt;Distributed Computing&lt;/h2&gt;

&lt;ul&gt;
&lt;li&gt;&lt;a href=&quot;https://www.infoq.com/presentations/crdt-distributed-consistency&quot;&gt;CRDTs and the Quest for Distributed Consistency&lt;/a&gt;. An &lt;a href=&quot;https://www.infoq.com/&quot;&gt;InfoQ&lt;/a&gt; presentation by &lt;a href=&quot;https://twitter.com/martinkl&quot;&gt;Martin Kleppmann&lt;/a&gt; where he talks about how to ensure data consistency in distributed systems, especially in systems that don't have an authoritative leader. Very interesting! Oh, and if you have not read Martin's book &lt;a href=&quot;http://dataintensive.net/&quot;&gt;Designing Data Intensive Applications&lt;/a&gt;, shame on you - it is a &lt;strong&gt;MUST&lt;/strong&gt; read for anyone wanting to build scalable applications!&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;https://www.infoq.com/presentations/async-event-arch&quot;&gt;Actors or Not: Async Event Architectures&lt;/a&gt;. A presentation, discussing two approaches to an asynchronous event-based architecture. The first is a &quot;classic&quot; style, protocol. The second is an actor-based approach.&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;https://www.infoq.com/presentations/lambda-streams-delta&quot;&gt;Lambda Architectures: a Snapshot, a Stream, &amp;amp; a Bunch of Deltas&lt;/a&gt;. This link points to yet another &lt;a href=&quot;https://www.infoq.com/&quot;&gt;InfoQ&lt;/a&gt; presentation. The presentation is about how event-sourced architectures can allow core services to reliably be able to share their information with other services asynchronously.&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;https://mdavey.wordpress.com/2018/05/28/book-building-evolutionary-architectures/&quot;&gt;Book: Building Evolutionary Architectures&lt;/a&gt;. Some notes by [Matt Davey] about the book &lt;a href=&quot;https://www.thoughtworks.com/books/building-evolutionary-architectures&quot;&gt;Building Evolutionary Architectures&lt;/a&gt;. Need to get this book! Also, you really should follow &lt;a href=&quot;https://mdavey.wordpress.com/&quot;&gt;Matt's blog&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;


&lt;h2&gt;.NET&lt;/h2&gt;

&lt;ul&gt;
&lt;li&gt;&lt;a href=&quot;https://blogs.msdn.microsoft.com/dotnet/2018/05/30/announcing-net-core-2-1/&quot;&gt;Announcing .NET Core 2.1&lt;/a&gt;. I guess the title of the blog post says it all, the release of .NET Core 2.1!&lt;/li&gt;
&lt;/ul&gt;


&lt;h2&gt;Streaming&lt;/h2&gt;

&lt;ul&gt;
&lt;li&gt;&lt;a href=&quot;https://engineering.skybettingandgaming.com/2018/05/26/jmx-metrics-kafka-connect/&quot;&gt;JMX Metrics in Kafka Connect&lt;/a&gt;. It cannot be a weekly roundup without at least one link to something Kafka related. This post is about how to use &lt;a href=&quot;https://docs.oracle.com/cd/E28280_01/web.1111/e13729/understanding.htm#JMXPG114&quot;&gt;JMX&lt;/a&gt; to monitor Kafka Connect.&lt;/li&gt;
&lt;/ul&gt;


&lt;h2&gt;Data Science&lt;/h2&gt;

&lt;ul&gt;
&lt;li&gt;&lt;a href=&quot;https://tomaztsql.wordpress.com/2018/05/28/native-scoring-in-sql-server-2017-using-r/&quot;&gt;Native scoring in SQL Server 2017 using R&lt;/a&gt;. One of the things I wanted to write about related to &lt;strong&gt;SQL Server Machine Learning Services&lt;/strong&gt; is how you do predictions. &lt;a href=&quot;https://twitter.com/tomaz_tsql&quot;&gt;Tomaz&lt;/a&gt; beat me to it with this interesting post.&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;https://blogs.msdn.microsoft.com/mlserver/2018/05/25/how-to-operationalize-keras-models-in-microsoft-machine-learning-server/&quot;&gt;How to operationalize Keras models in Microsoft Machine Learning Server&lt;/a&gt;. This post talks about how to operationalize Keras models as web services in R and Python in &lt;strong&gt;Microsoft Machine Learning Server&lt;/strong&gt;.&lt;/li&gt;
&lt;/ul&gt;


&lt;h2&gt;SQL Server Machine Learning Services&lt;/h2&gt;

&lt;ul&gt;
&lt;li&gt;&lt;a href=&quot;/2018/06/01/sql-server-machine-learning-services-and-sql-server-2017-cu-7/&quot;&gt;SQL Server Machine Learning Services and SQL Server 2017 CU7&lt;/a&gt;. I was busy writing the follow-up post to my &lt;a href=&quot;/2018/05/20/sp-execute-external-script-and-sql-compute-context/&quot;&gt;sp_execute_external_script and SQL Compute Context - I&lt;/a&gt; post from two weeks ago when, all of a sudden, I could not execute R code. I had applied &lt;strong&gt;SQL Server 2017 CU7&lt;/strong&gt; a couple of days before and it seems it &quot;messed&quot; with some permissions. So this post details how I fixed it.&lt;/li&gt;
&lt;/ul&gt;


&lt;h2&gt;~ Finally&lt;/h2&gt;

&lt;p&gt;That's all for this week. I hope you enjoy what I did put together. If you have ideas for what to cover, please comment on this post or &lt;a href=&quot;mailto:niels.it.berglund@gmail.com&quot;&gt;ping&lt;/a&gt; me.&lt;/p&gt;
</content>
 </entry>
 
 <entry>
   <title>SQL Server Machine Learning Services and SQL Server 2017 CU7</title>
   <link href="http://nielsberglund.com/2018/06/01/sql-server-machine-learning-services-and-sql-server-2017-cu-7/"/>
   <updated>2018-06-01T19:43:01+02:00</updated>
   <id>http://nielsberglund.com/2018/06/01/sql-server-machine-learning-services-and-sql-server-2017-cu-7</id>
   <content type="html">&lt;p&gt;This post is as much for you as it is for me to come back to when I wonder what to do when SQL Serer Machine Learning Services all of a sudden stops working after a SQL Server upgrade.&lt;/p&gt;

&lt;h2&gt;Background&lt;/h2&gt;

&lt;p&gt;Last week I did a complete reformat of my development box at home and installed the latest version of Windows 10: the 1803 build, also called the April 2018 update.&lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;&lt;strong&gt;NOTE:&lt;/strong&gt; I usually try to reformat my box at least twice a year, to ensure it is not too &quot;bogged&quot; down by old &quot;cruft&quot;, and that it has the latest and greatest.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;After the reformat I installed all my necessary applications, among them SQL Server 2017 with the in-database analytics components (R and Python). After installation I tested that it all worked and made sure I could execute my usual test scripts for &lt;code&gt;sp_execute_external_script&lt;/code&gt;:&lt;/p&gt;

&lt;p&gt;&lt;figure class='code-highlight-figure'&gt;&lt;figcaption class='code-highlight-caption'&gt;&lt;span class='code-highlight-caption-title'&gt;R Test&lt;/span&gt;&lt;/figcaption&gt;&lt;div class='code-highlight'&gt;&lt;pre class='code-highlight-pre'&gt;&lt;div data-line='1' class='code-highlight-row numbered'&gt;&lt;div class='code-highlight-line'&gt;&lt;span class=&quot;k&quot;&gt;EXEC&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;sp_execute_external_script&lt;/span&gt;   &lt;span class=&quot;o&quot;&gt;@&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;language&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;N&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;'R'&lt;/span&gt;
&lt;/div&gt;&lt;/div&gt;&lt;div data-line='2' class='code-highlight-row numbered'&gt;&lt;div class='code-highlight-line'&gt;                                &lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;@&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;script&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;N&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;'d &amp;lt;- 42'&lt;/span&gt;&lt;/div&gt;&lt;/div&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/figure&gt;&lt;/p&gt;

&lt;p&gt;&lt;strong&gt;Code Snippet 1:&lt;/strong&gt; &lt;em&gt;Test Script for R&lt;/em&gt;&lt;/p&gt;

&lt;p&gt;The &quot;moral&quot; equivalent to &lt;em&gt;Code Snippet 1&lt;/em&gt; in Python also worked without an issue:&lt;/p&gt;

&lt;p&gt;&lt;figure class='code-highlight-figure'&gt;&lt;figcaption class='code-highlight-caption'&gt;&lt;span class='code-highlight-caption-title'&gt;Python Test&lt;/span&gt;&lt;/figcaption&gt;&lt;div class='code-highlight'&gt;&lt;pre class='code-highlight-pre'&gt;&lt;div data-line='1' class='code-highlight-row numbered'&gt;&lt;div class='code-highlight-line'&gt;&lt;span class=&quot;n&quot;&gt;EXEC&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;sp_execute_external_script&lt;/span&gt;   &lt;span class=&quot;nd&quot;&gt;@language&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;N&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;'Python'&lt;/span&gt;
&lt;/div&gt;&lt;/div&gt;&lt;div data-line='2' class='code-highlight-row numbered'&gt;&lt;div class='code-highlight-line'&gt;                                &lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;nd&quot;&gt;@script&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;N&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;'d = 42'&lt;/span&gt;&lt;/div&gt;&lt;/div&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/figure&gt;&lt;/p&gt;

&lt;p&gt;&lt;strong&gt;Code Snippet 2:&lt;/strong&gt; &lt;em&gt;Test Script for Python&lt;/em&gt;&lt;/p&gt;

&lt;p&gt;Cool, all is &quot;A-OK&quot;! A couple of days go by, and I see that there is a Cumulative Update (CU) for SQL Server 2017 - CU7. I install it and does not think much about it. I mean: &quot;what can go wrong, how hard can it be?&quot;. A couple of days later and I am busy writing the follow-up post to &lt;a href=&quot;/2018/05/20/sp-execute-external-script-and-sql-compute-context/&quot;&gt;sp_execute_external_script and SQL Compute Context - I&lt;/a&gt; when I try to execute &lt;code&gt;sp_execute_external_script&lt;/code&gt;, and it falls over!&lt;/p&gt;

&lt;!--more--&gt;


&lt;blockquote&gt;&lt;p&gt;&lt;strong&gt;NOTE:&lt;/strong&gt; If you do not know what CU's are, you can read more about them &lt;a href=&quot;https://blogs.msdn.microsoft.com/sqlreleaseservices/announcing-the-modern-servicing-model-for-sql-server/&quot;&gt;here&lt;/a&gt;.&lt;/p&gt;&lt;/blockquote&gt;

&lt;h2&gt;Exception&lt;/h2&gt;

&lt;p&gt;The exception I received when I tried to execute &lt;code&gt;sp_execute_external_script&lt;/code&gt; looked like so:&lt;/p&gt;

&lt;p&gt;&lt;img class=&quot;center&quot; src=&quot;/images/posts/sql_ml_sql_cu7_error1.png&quot; width=&quot;405&quot; height=&quot;105&quot;  &gt;
&lt;strong&gt;Figure 1:&lt;/strong&gt; &lt;em&gt;Exception when Executing&lt;/em&gt;&lt;/p&gt;

&lt;p&gt;As we see in &lt;em&gt;Figure 1&lt;/em&gt; the exception has something to do with not being able to create a directory, which points to permission issues. This, kind of, resonated with me as I had in the back of my mind that something similar happened in the early days of SQL Server 2016 R Services when R stopped working after service packs were applied. Regardless I did some investigation around the issue (read I Googled) and found &lt;a href=&quot;http://jonculp.com/2017/01/resolve-sql-server-fatal-error-cannot-create-r_tempdir/&quot;&gt;this&lt;/a&gt; post by Jon Culp and also a post by my old friend &lt;a href=&quot;https://blog.greglow.com/2018/05/16/machine-learning-testing-your-installation-of-r-and-python-in-sql-server-2017/&quot;&gt;Greg Low&lt;/a&gt;. Both posts mention the 8.3 file naming convention as the primary culprit for the error. However, seeing that this worked fine before I applied CU7, I did not believe that the 8.3 file names were the case.  Having said that, I did (to be sure) enable the 8.3 notation as per &lt;a href=&quot;http://jonculp.com/2017/01/resolve-sql-server-fatal-error-cannot-create-r_tempdir/&quot;&gt;Jon Culp's&lt;/a&gt; post: &lt;code&gt;fsutil.exe behaviour set disable8dot3 0&lt;/code&gt;. Unfortunately, that did not change anything because when I executed the code in &lt;em&gt;Code Snippet 1&lt;/em&gt; it still errored out with the error in &lt;em&gt;Figure 1&lt;/em&gt;.&lt;/p&gt;

&lt;p&gt;All this pointed me back to the error being due to permission issues.&lt;/p&gt;

&lt;h2&gt;Permissions&lt;/h2&gt;

&lt;p&gt;Ok, so above we said permission issues, but permissions on what?&lt;/p&gt;

&lt;p&gt;If you read my series about &lt;a href=&quot;/series/sql_server_2k16_r_services&quot;&gt;SQL Server 2016 R Services&lt;/a&gt; you may remember that in &lt;a href=&quot;/2017/05/16/microsoft-sql-server-r-services-internals-vi/&quot;&gt;Internals - VI&lt;/a&gt; and &lt;a href=&quot;/2017/07/11/microsoft-sql-server-r-services-internals-vii/&quot;&gt;Internals - VII&lt;/a&gt; we discussed how the Launchpad service and the RTerm processes create files and directories in the &lt;code&gt;ExtensibilityData&lt;/code&gt; directory and its sub directories. This directory is where the permissions are supposed to be or, as in this case, are not.&lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;&lt;strong&gt;NOTE:&lt;/strong&gt; In a default installation of SQL Server on a Windows box, the &lt;code&gt;ExtensibilityData&lt;/code&gt; directory is located at &lt;code&gt;C:\&amp;lt;sql_instance_path&amp;gt;\MSSQL\ExtensibilityData&lt;/code&gt;.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;When you navigate the &lt;code&gt;ExtensibilityData&lt;/code&gt; directory in &lt;em&gt;File Explorer&lt;/em&gt; and look at the &lt;em&gt;Advanced Security Settings for ExtensibilityData&lt;/em&gt; dialog you see something like so in an installation where everything works:&lt;/p&gt;

&lt;p&gt;&lt;img class=&quot;center&quot; src=&quot;/images/posts/sql_ml_sql_cu7_permissions1.png&quot; width=&quot;755&quot; height=&quot;515&quot;  &gt;
&lt;strong&gt;Figure 2:&lt;/strong&gt; &lt;em&gt;Permissions on ExtensibilityData&lt;/em&gt;&lt;/p&gt;

&lt;p&gt;In &lt;em&gt;Figure 2&lt;/em&gt; we see the various users, groups and roles that have access to the &lt;code&gt;ExtensibilityData&lt;/code&gt; directory and the highlighted part is the group that is of interest for this discussion. What is interesting is that when you look at this dialog before CU7 (when everything works) and after you deploy CU7, it looks the same. So, something is going on behind the scenes.&lt;/p&gt;

&lt;p&gt;To further confirm that what I saw was a permission issue I used &lt;em&gt;Process Monitor&lt;/em&gt; to see what file operations happened when I tried to execute the code in &lt;em&gt;Code Snippet 1&lt;/em&gt;. After gradually filtering out events I ended up with was is shown in the figure below.&lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;&lt;strong&gt;NOTE:&lt;/strong&gt; If you are interested in how you can use &lt;em&gt;Process Monitor&lt;/em&gt; I covered that in &lt;a href=&quot;/2017/07/11/microsoft-sql-server-r-services-internals-vii/&quot;&gt;Internals - VII&lt;/a&gt;.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;&lt;img class=&quot;center&quot; src=&quot;/images/posts/sql_ml_sql_cu7_procmon1.png&quot; width=&quot;782&quot; height=&quot;192&quot;  &gt;
&lt;strong&gt;Figure 3:&lt;/strong&gt; &lt;em&gt;Process Monitor Output&lt;/em&gt;&lt;/p&gt;

&lt;p&gt;Remember how we in the &lt;strong&gt;Internals&lt;/strong&gt; posts &lt;a href=&quot;/2017/04/23/microsoft-sql-server-r-services-internals-iv/&quot;&gt;IV&lt;/a&gt; and &lt;a href=&quot;/2017/07/11/microsoft-sql-server-r-services-internals-vii/&quot;&gt;VII&lt;/a&gt; in the &lt;a href=&quot;/series/sql_server_2k16_r_services&quot;&gt;SQL Server R Services&lt;/a&gt; series discussed how the Launchpad service creates RTerm processes. We also discussed how the RTerm processes create directories and files under the &lt;code&gt;ExtensibilityData&lt;/code&gt; directory and its sub-directories. So what we see in &lt;em&gt;Figure 3&lt;/em&gt; is how the RTerm processes cannot write to the root of the &lt;code&gt;ExtensibilityData&lt;/code&gt; directory and this is what ultimately causes the error in &lt;em&gt;Figure 1&lt;/em&gt;.&lt;/p&gt;

&lt;p&gt;What I saw when I filtered out events was that even though the RTerm processes could not write to the root of the &lt;code&gt;ExtensibilityData&lt;/code&gt; directory, they could write to subdirectories:&lt;/p&gt;

&lt;p&gt;&lt;img class=&quot;center&quot; src=&quot;/images/posts/sql_ml_sql_cu7_procmon2.png&quot; width=&quot;801&quot; height=&quot;161&quot;  &gt;
&lt;strong&gt;Figure 4:&lt;/strong&gt; &lt;em&gt;Successful Writes&lt;/em&gt;&lt;/p&gt;

&lt;p&gt;So based on what we see in &lt;em&gt;Figure 3&lt;/em&gt; and &lt;em&gt;Figure 4&lt;/em&gt; it seems like something has gone awry with permissions for the root of the &lt;code&gt;ExtensibilityData&lt;/code&gt; directory. How to fix this?&lt;/p&gt;

&lt;h2&gt;Fix&lt;/h2&gt;

&lt;p&gt;I must confess that I initially added &lt;em&gt;Everyone&lt;/em&gt; with &lt;em&gt;Full control&lt;/em&gt; to the security settings for the &lt;code&gt;ExtensibilityData&lt;/code&gt; directory and it all worked:&lt;/p&gt;

&lt;p&gt;&lt;img class=&quot;center&quot; src=&quot;/images/posts/sql_ml_sql_cu7_permissions2.png&quot; width=&quot;755&quot; height=&quot;515&quot;  &gt;
&lt;strong&gt;Figure 5:&lt;/strong&gt; &lt;em&gt;Everyone Full Control&lt;/em&gt;&lt;/p&gt;

&lt;p&gt;However that did not seem like the correct way to do it, so I started playing around with the &quot;Advanced&quot; security properties on the &lt;code&gt;ExtensibilityData&lt;/code&gt; directory:&lt;/p&gt;

&lt;p&gt;&lt;img class=&quot;center&quot; src=&quot;/images/posts/sql_ml_sql_cu7_sec_properties.png&quot; width=&quot;360&quot; height=&quot;485&quot;  &gt;
&lt;strong&gt;Figure 6:&lt;/strong&gt; &lt;em&gt;Security Properties&lt;/em&gt;&lt;/p&gt;

&lt;p&gt;In &lt;em&gt;Figure 6&lt;/em&gt; we see how I have right clicked on the &lt;code&gt;ExtensibilityData&lt;/code&gt; directory in &lt;em&gt;File Explorer&lt;/em&gt; and chosen properties and then clicked on the &lt;em&gt;Security&lt;/em&gt; (highlighted in the figure). The group that we work with is the &lt;code&gt;MSSQLLaunchpad&lt;/code&gt;, outlined in red.&lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;&lt;strong&gt;NOTE:&lt;/strong&gt; If you work on a SQL instance other than the default the group name is &lt;code&gt;MSSQLLaunchpad$instance_name&lt;/code&gt;.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;When I click on the &quot;Advanced&quot; button (also outlined in red in &lt;em&gt;Figure 6&lt;/em&gt;) I see something like so:&lt;/p&gt;

&lt;p&gt;&lt;img class=&quot;center&quot; src=&quot;/images/posts/sql_ml_sql_cu7_enable_inh.png&quot; width=&quot;765&quot; height=&quot;515&quot;  &gt;
&lt;strong&gt;Figure 7:&lt;/strong&gt; &lt;em&gt;Advanced Security Settings&lt;/em&gt;&lt;/p&gt;

&lt;p&gt;In the &quot;Advanced Security Settings&quot; dialog in &lt;em&gt;Figure 7&lt;/em&gt; I clicked on &quot;Enable inheritance&quot; (outlined in red) followed by &quot;Apply&quot;, which showed an error dialog:&lt;/p&gt;

&lt;p&gt;&lt;img class=&quot;center&quot; src=&quot;/images/posts/sql_ml_sql_cu7_enable_inh_1.png&quot; width=&quot;395&quot; height=&quot;220&quot;  &gt;
&lt;strong&gt;Figure 8:&lt;/strong&gt; &lt;em&gt;Error Dialog&lt;/em&gt;&lt;/p&gt;

&lt;p&gt;I clicked on &quot;Continue&quot; and the error repeated for each subdirectory in the &lt;code&gt;ExtensibilityData&lt;/code&gt; directory. After last error I was back in the &quot;Advanced Security Settings&quot; dialog where I saw something strange:&lt;/p&gt;

&lt;p&gt;&lt;img class=&quot;center&quot; src=&quot;/images/posts/sql_ml_sql_cu7_enable_inh_2.png&quot; width=&quot;800&quot; height=&quot;580&quot;  &gt;
&lt;strong&gt;Figure 9:&lt;/strong&gt; &lt;em&gt;Additional Security Principals&lt;/em&gt;&lt;/p&gt;

&lt;p&gt;What I saw was quite a few new security principals added to the security settings for the directory, and we see them outlined in red in &lt;em&gt;Figure 9&lt;/em&gt;. I clicked OK until I exited all dialogs. Now, when I tried to execute the R code, it succeeded. However, I was not happy with the added principals, so I went back into the &quot;Advanced Security Settings&quot; dialog:&lt;/p&gt;

&lt;p&gt;&lt;img class=&quot;center&quot; src=&quot;/images/posts/sql_ml_sql_cu7_disable_inh_1.png&quot; width=&quot;750&quot; height=&quot;515&quot;  &gt;
&lt;strong&gt;Figure 10:&lt;/strong&gt; &lt;em&gt;Disable Inheritance&lt;/em&gt;&lt;/p&gt;

&lt;p&gt;In the dialog as we see in &lt;em&gt;Figure 10&lt;/em&gt; I clicked on the &quot;Disable inheritance&quot; button. When I clicked &quot;Apply&quot; the &quot;Block Inheritance&quot; dialog &quot;popped up&quot;:&lt;/p&gt;

&lt;p&gt;&lt;img class=&quot;center&quot; src=&quot;/images/posts/sql_ml_sql_cu7_convert_inh_1.png&quot; width=&quot;510&quot; height=&quot;275&quot;  &gt;
&lt;strong&gt;Figure 10:&lt;/strong&gt; &lt;em&gt;Block Inheritance&lt;/em&gt;&lt;/p&gt;

&lt;p&gt;In the &quot;Block Inheritance&quot; dialog I clicked on the outlined part in &lt;em&gt;Figure 10&lt;/em&gt;: &quot;Convert inherited permissions ...&quot;, and the same error dialog as we see in &lt;em&gt;Figure 8&lt;/em&gt; came up. As I did above, I clicked through the errors through the &quot;Continue&quot; button, and when I was back in the &quot;Advanced Security Settings&quot; dialog I saw that the added security principals were no longer there. That is not true, one principal from the added ones was still there, and that was &lt;code&gt;MSSQLSERVER&lt;/code&gt;. I removed it and clicked OK out of the remaining dialogs. When I executed the code, it all worked, Yay!&lt;/p&gt;

&lt;h2&gt;Summary&lt;/h2&gt;

&lt;p&gt;Above we see how I managed to fix the issue how R did not work in SQL Server 2017 after I had applied CU7. The steps I took:&lt;/p&gt;

&lt;ol&gt;
&lt;li&gt;Right-click on the &lt;code&gt;ExtensibilityData&lt;/code&gt; directory and choose properties.&lt;/li&gt;
&lt;li&gt;In properties click on the &quot;Security&quot; tab and then the &quot;Advanced&quot; button.&lt;/li&gt;
&lt;li&gt;In the &quot;Advanced Security Settings&quot; dialog click &quot;Enable inheritance&quot; followed by &quot;Apply&quot;.&lt;/li&gt;
&lt;li&gt;In the error dialogs that appear click continue until you are back in the &quot;Advanced Security Settings&quot; dialog, and there you click OK out of all dialogs.&lt;/li&gt;
&lt;li&gt;At this stage, you can execute the R code without any exceptions.&lt;/li&gt;
&lt;li&gt;Go back into the &quot;Advanced Security Settings&quot; dialog and click &quot;Disable inheritance&quot; and &quot;Apply&quot;.&lt;/li&gt;
&lt;li&gt;In the &quot;Block Inheritance&quot; dialog chose &quot;Convert inherited permissions ...&quot;.&lt;/li&gt;
&lt;li&gt;&quot;Continue&quot; through the error dialogs until you are back in the &quot;Advanced Security Settings&quot; dialog.&lt;/li&gt;
&lt;li&gt;In the &quot;Advanced Security Settings&quot; dialog &quot;Remove&quot; the &lt;code&gt;MSSQLSERVER&lt;/code&gt; principal.&lt;/li&gt;
&lt;/ol&gt;


&lt;p&gt;Oh, and I can warmly recommend the blogs I mention above by &lt;a href=&quot;http://jonculp.com/&quot;&gt;Jon Culp&lt;/a&gt; and &lt;a href=&quot;https://blog.greglow.com/&quot;&gt;Greg Low&lt;/a&gt;.&lt;/p&gt;

&lt;h2&gt;~ Finally&lt;/h2&gt;

&lt;p&gt;If you have comments, questions etc., please comment on this post or &lt;a href=&quot;mailto:niels.it.berglund@gmail.com&quot;&gt;ping&lt;/a&gt; me.&lt;/p&gt;
</content>
 </entry>
 
 <entry>
   <title>Interesting Stuff - Week 21</title>
   <link href="http://nielsberglund.com/2018/05/27/interesting-stuff-week-21/"/>
   <updated>2018-05-27T11:06:31+02:00</updated>
   <id>http://nielsberglund.com/2018/05/27/interesting-stuff---week-21</id>
   <content type="html">&lt;p&gt;Throughout the week, I read a lot of blog-posts, articles, and so forth, that has to do with things that interest me:&lt;/p&gt;

&lt;ul&gt;
&lt;li&gt;data science&lt;/li&gt;
&lt;li&gt;data in general&lt;/li&gt;
&lt;li&gt;distributed computing&lt;/li&gt;
&lt;li&gt;SQL Server&lt;/li&gt;
&lt;li&gt;transactions (both db as well as non db)&lt;/li&gt;
&lt;li&gt;and other &quot;stuff&quot;&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;This blog-post is the &quot;roundup&quot; of the things that have been most interesting to me, for the week just ending.&lt;/p&gt;

&lt;!--more--&gt;


&lt;h2&gt;SQL Server &amp;amp; Other Database Systems&lt;/h2&gt;

&lt;ul&gt;
&lt;li&gt;&lt;a href=&quot;https://blogs.msdn.microsoft.com/bobsql/2018/05/20/sql-server-on-linux-quick-performance-monitoring/&quot;&gt;SQL Server on Linux: Quick Performance Monitoring&lt;/a&gt;. A blog post by &lt;a href=&quot;https://blogs.msdn.microsoft.com/bobsql/&quot;&gt;Bob Dorr&lt;/a&gt; where he talks about how we can get a Performance Monitor like view on Linux for SQL Server.&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;https://www.infoq.com/news/2018/05/mysql8&quot;&gt;MySQL Version 8 Adds Document Store, Performance and Security Improvements&lt;/a&gt;. An &lt;a href=&quot;https://www.infoq.com/&quot;&gt;InfoQ&lt;/a&gt; article about new functionality in the latest version of MySQL. What caught my eye was the support for document store. I guess, depending on how it is done, having a combination of Document Store and a relational database can be very powerful.&lt;/li&gt;
&lt;/ul&gt;


&lt;h2&gt;Streaming&lt;/h2&gt;

&lt;ul&gt;
&lt;li&gt;&lt;a href=&quot;https://data-artisans.com/blog/apache-flink-1-5-0-release-announcement&quot;&gt;Apache Flink 1.5.0 Release Announcement&lt;/a&gt;. This post announces the release of Flink version 1.5.0. There are quite a few new exciting features, among them: broadcast state, task-local state recovery and support for windowed outer equi-joins in the SQL and Table API's. I have just set up a new CentOS 7 virtual machine so I can check this out.&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;https://www.confluent.io/blog/confluent-cloud-pro-gcp/&quot;&gt;New Confluent Cloud Professional, and Ecosystem Expansion to Google Cloud Platform&lt;/a&gt;. I do not know if you knew this - but there is a rule saying that if there is an announcement from Flink, there also has to be an announcement from Kafka (and visa versa). So, the Kafka announcement is that the Confluent Cloud is now also available on the Google Cloud (in addition to AWS). I really hope to see Azure being in the mix in a not too distant future.&lt;/li&gt;
&lt;/ul&gt;


&lt;h2&gt;.NET&lt;/h2&gt;

&lt;ul&gt;
&lt;li&gt;&lt;a href=&quot;https://www.infoq.com/articles/future-of-net-core&quot;&gt;Discussions on the Future of .NET Core&lt;/a&gt;. An [InfoQ] article where five industry veterans discuss the .NET Core platform. Some takeaways:

&lt;ul&gt;
&lt;li&gt;The .NET Core platform provides significant performance benefits as compared to the traditional .NET Framework.&lt;/li&gt;
&lt;li&gt;.NET Core benefits from a server-centric design that is not Windows-focused.&lt;/li&gt;
&lt;li&gt;.NET Core is now a stable platform suitable for new application development.&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;


&lt;h2&gt;Distributed Computing&lt;/h2&gt;

&lt;ul&gt;
&lt;li&gt;&lt;a href=&quot;https://medium.com/netflix-techblog/open-sourcing-zuul-2-82ea476cb2b3&quot;&gt;Open Sourcing Zuul 2&lt;/a&gt;. An announcement from Netflix, how they are now open-sourcing their cloud gateway: &lt;strong&gt;Zuul 2&lt;/strong&gt;. A very interesting point in the post was where it discussed anomaly detection and contextual alerting.&lt;/li&gt;
&lt;/ul&gt;


&lt;h2&gt;Data Science&lt;/h2&gt;

&lt;ul&gt;
&lt;li&gt;&lt;a href=&quot;https://www.infoq.com/presentations/paypal-data-service-fraud&quot;&gt;Data Pipelines for Real-time Fraud Prevention at Scale&lt;/a&gt;. An &lt;a href=&quot;https://www.infoq.com/&quot;&gt;InfoQ&lt;/a&gt; presentation about the architecture of PayPal’s data service which combines a Big Data approach with providing data in real time for decision making in fraud detection.&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;https://blog.acolyer.org/2018/05/23/pixie-a-system-for-recommending-3-billion-items-to-200-million-users-in-real-time/&quot;&gt;Pixie: a system for recommending 3+ billion items to 200+ million users in real-time&lt;/a&gt;. A white paper dissected by &lt;a href=&quot;https://twitter.com/adriancolyer&quot;&gt;Adrian&lt;/a&gt; describing how Pinterest has built a system for recommending 3+ billion items to 200+ million users in real-time!&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;https://blogs.technet.microsoft.com/machinelearning/2018/05/21/enterprise-deployment-tips-for-azure-data-science-virtual-machine-dsvm&quot;&gt;Enterprise Deployment Tips for Azure Data Science Virtual Machine (DSVM)&lt;/a&gt;. I came across this post thanks to &lt;a href=&quot;https://twitter.com/luis_de_sousa&quot;&gt;Luis&lt;/a&gt; and his weekly &lt;a href=&quot;https://www.getrevue.co/profile/datascienceweekly/&quot;&gt;newsletter&lt;/a&gt;. The post he pointed to is about the Azure Data Science Virtual Machine (DSVM) and how to use and deploy in an enterprise environment. This topic is especially interesting right now as we at &lt;a href=&quot;/derivco&quot;&gt;Derivco&lt;/a&gt; is looking at the DSVM. Thanks &lt;a href=&quot;https://twitter.com/luis_de_sousa&quot;&gt;Luis&lt;/a&gt;!&lt;/li&gt;
&lt;/ul&gt;


&lt;h2&gt;SQL Server Machine Learning Services&lt;/h2&gt;

&lt;p&gt;In lasts week &lt;a href=&quot;/2018/05/20/interesting-stuff-week-20/&quot;&gt;roundup&lt;/a&gt; I mentioned how I probably have to write some follow up posts to the &lt;a href=&quot;/2018/05/20/sp-execute-external-script-and-sql-compute-context/&quot;&gt;sp_execute_external_script and SQL Compute Context - I&lt;/a&gt; post I published a week ago. I have now started with the first follow up post, and I hope I can publish it in a week or two.&lt;/p&gt;

&lt;h2&gt;~ Finally&lt;/h2&gt;

&lt;p&gt;That's all for this week. I hope you enjoy what I did put together. If you have ideas for what to cover, please comment on this post or &lt;a href=&quot;mailto:niels.it.berglund@gmail.com&quot;&gt;ping&lt;/a&gt; me.&lt;/p&gt;
</content>
 </entry>
 
 <entry>
   <title>Interesting Stuff - Week 20</title>
   <link href="http://nielsberglund.com/2018/05/20/interesting-stuff-week-20/"/>
   <updated>2018-05-20T18:33:35+02:00</updated>
   <id>http://nielsberglund.com/2018/05/20/interesting-stuff---week-20</id>
   <content type="html">&lt;p&gt;Throughout the week, I read a lot of blog-posts, articles, and so forth, that has to do with things that interest me:&lt;/p&gt;

&lt;ul&gt;
&lt;li&gt;data science&lt;/li&gt;
&lt;li&gt;data in general&lt;/li&gt;
&lt;li&gt;distributed computing&lt;/li&gt;
&lt;li&gt;SQL Server&lt;/li&gt;
&lt;li&gt;transactions (both db as well as non db)&lt;/li&gt;
&lt;li&gt;and other &quot;stuff&quot;&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;This blog-post is the &quot;roundup&quot; of the things that have been most interesting to me, for the week just ending.&lt;/p&gt;

&lt;!--more--&gt;


&lt;h2&gt;Streaming&lt;/h2&gt;

&lt;ul&gt;
&lt;li&gt;&lt;a href=&quot;https://www.confluent.io/blog/visualizations-on-apache-kafka-made-easy-with-ksql/&quot;&gt;Visualizations on Apache Kafka Made Easy with KSQL&lt;/a&gt;. Not a week without one or more Kafka related posts. This blog-post is about how to get started with processing streaming data with Confluent KSQL and visualizing it using the &lt;a href=&quot;https://www.arcadiadata.com/&quot;&gt;Arcadia Data&lt;/a&gt; platform. The post contains quite a few links to interesting demos.&lt;/li&gt;
&lt;/ul&gt;


&lt;h2&gt;Cloud / Big Data&lt;/h2&gt;

&lt;ul&gt;
&lt;li&gt;&lt;a href=&quot;https://azure.microsoft.com/en-us/blog/enhance-productivity-using-azure-data-factory-visual-tools/&quot;&gt;Enhance productivity using Azure Data Factory Visual Tools&lt;/a&gt;. A blog-post about ADF Visual Tools where the primary goal of the ADF visual tools is to allow you to be productive with ADF by getting pipelines up and running quickly without requiring to write a single line of code. It looks quite impressive, and this is another thing I really need to have a look at.&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;https://www.infoq.com/news/2018/05/azure-signalr-preview&quot;&gt;Microsoft Announces Preview of Azure SignalR Service&lt;/a&gt;. An &lt;a href=&quot;https://www.infoq.com/&quot;&gt;InfoQ&lt;/a&gt; article about how Microsoft recently announced a public preview of the Azure SignalR Service. SignalR has been available for download as a separate ASP.NET library, but this is the first time it has been available as a fully-managed service. Exciting stuff!&lt;/li&gt;
&lt;/ul&gt;


&lt;h2&gt;Data Science&lt;/h2&gt;

&lt;ul&gt;
&lt;li&gt;&lt;a href=&quot;https://www.infoq.com/presentations/data-ml-pipelines-stitchfix&quot;&gt;Developing Data and ML Pipelines at Stitch Fix&lt;/a&gt;. An &lt;a href=&quot;https://www.infoq.com/presentations/data-ml-pipelines-stitchfix&quot;&gt;InfoQ&lt;/a&gt; presentation about how Stitch Fix develops, schedules, and maintains their data and ML pipelines. Very interesting, it sure gave me some ideas!&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;https://www.infoq.com/news/2018/05/PyTorch-AI&quot;&gt;PyTorch 1.0 Announced for Research and Production AI Projects&lt;/a&gt;. This links to another &lt;a href=&quot;https://www.infoq.com/&quot;&gt;InfoQ&lt;/a&gt; article. This article is about the introduction of PyTorch 1.0 and its new capabilities.&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;https://blogs.msdn.microsoft.com/mlserver/2018/05/18/getting-started-with-machine-learning-services-in-sql-server/&quot;&gt;Getting Started with Machine Learning Services in SQL Server&lt;/a&gt;. A blog-post which serves as an introduction to SQL Server Machine Learning Services. It looks somewhat like my &lt;a href=&quot;/series/sql_server_2k16_r_services&quot;&gt;SQL Server R Services&lt;/a&gt;, but this post has links to videos. Awesome!&lt;/li&gt;
&lt;/ul&gt;


&lt;h2&gt;SQL Server Machine Learning Services&lt;/h2&gt;

&lt;ul&gt;
&lt;li&gt;&lt;a href=&quot;/2018/05/20/sp-execute-external-script-and-sql-compute-context/&quot;&gt;sp_execute_external_script and SQL Compute Context - I&lt;/a&gt;. I finally managed to finish the post about &lt;code&gt;sp_execute_external_script&lt;/code&gt; and &lt;strong&gt;SQL Server Compute Context&lt;/strong&gt; (SQLCC). That is the good news; the bad news is that I realised that there are quite a few things I do not understand about SQLCC, so I need to investigate more and also write more posts about SQLCC. Sigh - that is life!&lt;/li&gt;
&lt;/ul&gt;


&lt;h2&gt;~ Finally&lt;/h2&gt;

&lt;p&gt;That's all for this week. I hope you enjoy what I did put together. If you have ideas for what to cover, please comment on this post or &lt;a href=&quot;mailto:niels.it.berglund@gmail.com&quot;&gt;ping&lt;/a&gt; me.&lt;/p&gt;
</content>
 </entry>
 
 <entry>
   <title>sp_execute_external_script and SQL Compute Context - I</title>
   <link href="http://nielsberglund.com/2018/05/20/sp-execute-external-script-and-sql-compute-context/"/>
   <updated>2018-05-20T10:46:52+02:00</updated>
   <id>http://nielsberglund.com/2018/05/20/sp-execute-external-script-and-sql-compute-context</id>
   <content type="html">&lt;p&gt;The last &lt;a href=&quot;/2018/03/21/microsoft-sql-server-r-services-sp-execute-external-script-iii/&quot;&gt;blog post&lt;/a&gt; in the &lt;a href=&quot;/series/sql_server_2k16_r_services&quot;&gt;Microsoft SQL Server R Services&lt;/a&gt; series covered some performance related parameters of &lt;code&gt;sp_execute_external_script&lt;/code&gt;, (&lt;code&gt;@parallel&lt;/code&gt; and &lt;code&gt;@r_rowsPerRead&lt;/code&gt;), and it touched a little bit on &lt;strong&gt;SQL Server Compute Context&lt;/strong&gt;.&lt;/p&gt;

&lt;p&gt;After I published the post, I received an email from &lt;a href=&quot;https://www.linkedin.com/in/umachandarjayachandran/&quot;&gt;Umachandar Jayachandran&lt;/a&gt; who is a Principal Program Manager in the SQL Server team and is working on integration of R, Python and other runtimes into SQL Server (basically, he knows this &quot;stuff&quot;). In the mail, he said that I was somewhat incorrect in what I said about how the &lt;strong&gt;SQL Server Compute Context&lt;/strong&gt; (SQLCC) works.&lt;/p&gt;

&lt;p&gt;So I decided to write a post to correct my mistakes, and this is it. While I wrote this post I realized that there are more to the SQL compute context that meets ones eye, so I will - in all likelihood - write more posts about SQLCC.&lt;/p&gt;

&lt;p&gt;Before I begin I want to say a very big &lt;strong&gt;THANK YOU&lt;/strong&gt; to &lt;a href=&quot;https://www.linkedin.com/in/umachandarjayachandran/&quot;&gt;Umachandar&lt;/a&gt; as well as &lt;a href=&quot;https://twitter.com/nelliegson&quot;&gt;Nellie Gustafsson&lt;/a&gt; who also is a SQL Server Program Manager at Microsoft. Without them making me see the &quot;errors of my way&quot; I would not have been able to write this post.&lt;/p&gt;

&lt;!--more--&gt;


&lt;p&gt;A little bit of background first.&lt;/p&gt;

&lt;h2&gt;Background&lt;/h2&gt;

&lt;p&gt;We all know how SQL Server supports parallelism, whereby it decides whether to execute a statement in parallel or not, and the &lt;code&gt;MAXDOP&lt;/code&gt; setting defines the number of processors executing the statement. Parallel execution is also supported when executing &lt;code&gt;sp_execute_external_script&lt;/code&gt; by setting the &lt;code&gt;@parallel&lt;/code&gt; parameter to &lt;code&gt;1&lt;/code&gt;.&lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;&lt;strong&gt;NOTE:&lt;/strong&gt; You are not guaranteed to execute in parallel even if you set the parameter. SQL Server decides whether the statement you want to execute should be executed in parallel or not.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;So, if SQL decides that it can execute in parallel, what happens is that multiple SqlSatellite instances and connections are created. Multiple &lt;code&gt;BxlServer.exe&lt;/code&gt; processes host the SqlSatellites, and SQL Server acts as a coordinator and sends data to the various SqlSatellites:&lt;/p&gt;

&lt;p&gt;&lt;img class=&quot;center&quot; src=&quot;/images/posts/sql_r_services_ext_scriptIII_multi_process.png&quot; width=&quot;800&quot; height=&quot;522&quot;  &gt;
&lt;strong&gt;Figure 1:&lt;/strong&gt; &lt;em&gt;Parallel Execution&lt;/em&gt;&lt;/p&gt;

&lt;p&gt;&lt;em&gt;Figure 1&lt;/em&gt; tries to illustrate executing external script in parallel with a &lt;code&gt;MAXDOP&lt;/code&gt; setting of 6 (6 processes used). The numbers in the figure are:&lt;/p&gt;

&lt;ol&gt;
&lt;li&gt;We call &lt;code&gt;sp_execute_external_script&lt;/code&gt; and SQL Server calls into the launchpad service.&lt;/li&gt;
&lt;li&gt;The launchpad service creates RTerm processes which in turn creates BxlServer processes. Based on &lt;code&gt;MAXDOP&lt;/code&gt;, multiple executing processes &quot;spin up&quot;.&lt;/li&gt;
&lt;li&gt;TCP connections from the SqlSatellite in the executing processes get established.&lt;/li&gt;
&lt;li&gt;SQL server sends input data to the SqlSatellites.&lt;/li&gt;
&lt;li&gt;The &lt;code&gt;BxlServer.exe&lt;/code&gt; processes the data.&lt;/li&gt;
&lt;li&gt;SQL Server receives data back from the individual SqlSatellite.&lt;/li&gt;
&lt;/ol&gt;


&lt;p&gt;In &lt;em&gt;Figure 1&lt;/em&gt; you see how the execution is in parallel and how SQL Server acts as a coordinator. What I mean with that is that the SqlSatellites make connections to SQL Server, SQL Server sends batches of data to the SqlSatellites, the BxlServer processes handle the data, and finally, SQL receives results back from the SqlSatellites. The good thing about how this works is that it does not matter whether you use &lt;strong&gt;RevoScaleR&lt;/strong&gt; or &lt;strong&gt;CRANR&lt;/strong&gt; functions, they execute in parallel regardless.&lt;/p&gt;

&lt;p&gt;The downside with this type of parallel execution (&lt;code&gt;@parallel = 1&lt;/code&gt;) is that the processes are independent of each other:&lt;/p&gt;

&lt;ul&gt;
&lt;li&gt;SqlSatellite makes independent connections to SQL Server.&lt;/li&gt;
&lt;li&gt;SQL Server sends individual batches of data to the SqlSatellite.&lt;/li&gt;
&lt;li&gt;The BxlServer processes hosting the SqlSatellites processes the data.&lt;/li&gt;
&lt;li&gt;SQL Server receives results back from the SqlSatellites.&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;Why this is a downside is that, as the data is processed independently, if your data has dependencies between different rows (like creating models), there is a high risk that different processes process the dependent rows. We saw that in &lt;a href=&quot;/2018/03/21/microsoft-sql-server-r-services-sp-execute-external-script-iii/&quot;&gt;sp_execute_external_script - III&lt;/a&gt; where we had code like so:&lt;/p&gt;

&lt;p&gt;&lt;figure class='code-highlight-figure'&gt;&lt;figcaption class='code-highlight-caption'&gt;&lt;span class='code-highlight-caption-title'&gt;Model in Parallel&lt;/span&gt;&lt;/figcaption&gt;&lt;div class='code-highlight'&gt;&lt;pre class='code-highlight-pre'&gt;&lt;div data-line='1' class='code-highlight-row numbered'&gt;&lt;div class='code-highlight-line'&gt;&lt;span class=&quot;k&quot;&gt;EXEC&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;sp_execute_external_script&lt;/span&gt;
&lt;/div&gt;&lt;/div&gt;&lt;div data-line='2' class='code-highlight-row numbered'&gt;&lt;div class='code-highlight-line'&gt;      &lt;span class=&quot;o&quot;&gt;@&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;language&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;N&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;'R'&lt;/span&gt;
&lt;/div&gt;&lt;/div&gt;&lt;div data-line='3' class='code-highlight-row numbered'&gt;&lt;div class='code-highlight-line'&gt;    &lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;@&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;script&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;N&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;'
&lt;/div&gt;&lt;/div&gt;&lt;div data-line='4' class='code-highlight-row numbered'&gt;&lt;div class='code-highlight-line'&gt;        pid &amp;lt;- Sys.getpid()
&lt;/div&gt;&lt;/div&gt;&lt;div data-line='5' class='code-highlight-row numbered'&gt;&lt;div class='code-highlight-line'&gt;        myModel &amp;lt;- rxLinMod(y ~ rand1 + rand2 + rand3 + rand4 + rand5,
&lt;/div&gt;&lt;/div&gt;&lt;div data-line='6' class='code-highlight-row numbered'&gt;&lt;div class='code-highlight-line'&gt;                      data=InputDataSet)
&lt;/div&gt;&lt;/div&gt;&lt;div data-line='7' class='code-highlight-row numbered'&gt;&lt;div class='code-highlight-line'&gt;        model &amp;lt;- serialize(myModel, NULL);
&lt;/div&gt;&lt;/div&gt;&lt;div data-line='8' class='code-highlight-row numbered'&gt;&lt;div class='code-highlight-line'&gt;        modelbinstr = paste(model, collapse = &quot;&quot;)
&lt;/div&gt;&lt;/div&gt;&lt;div data-line='9' class='code-highlight-row numbered'&gt;&lt;div class='code-highlight-line'&gt;        OutputDataSet &amp;lt;- data.frame(ProcessId = pid,
&lt;/div&gt;&lt;/div&gt;&lt;div data-line='10' class='code-highlight-row numbered'&gt;&lt;div class='code-highlight-line'&gt;                                    nRows=myModel$nValidObs,
&lt;/div&gt;&lt;/div&gt;&lt;div data-line='11' class='code-highlight-row numbered'&gt;&lt;div class='code-highlight-line'&gt;                                    theModel = modelbinstr)'&lt;/span&gt;
&lt;/div&gt;&lt;/div&gt;&lt;div data-line='12' class='code-highlight-row numbered'&gt;&lt;div class='code-highlight-line'&gt;   &lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;@&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;input_data_1&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;N&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;'SELECT TOP(2400000) y, rand1, rand2, rand3,
&lt;/div&gt;&lt;/div&gt;&lt;div data-line='13' class='code-highlight-row numbered'&gt;&lt;div class='code-highlight-line'&gt;                                           rand4, rand5
&lt;/div&gt;&lt;/div&gt;&lt;div data-line='14' class='code-highlight-row numbered'&gt;&lt;div class='code-highlight-line'&gt;                       FROM dbo.tb_Rand_3M
&lt;/div&gt;&lt;/div&gt;&lt;div data-line='15' class='code-highlight-row numbered'&gt;&lt;div class='code-highlight-line'&gt;                       WHERE  rand5 &amp;gt;= 10         &lt;br/&gt;
&lt;/div&gt;&lt;/div&gt;&lt;div data-line='16' class='code-highlight-row numbered'&gt;&lt;div class='code-highlight-line'&gt;                       OPTION(querytraceon 8649, MAXDOP 4)'&lt;/span&gt;
&lt;/div&gt;&lt;/div&gt;&lt;div data-line='17' class='code-highlight-row numbered'&gt;&lt;div class='code-highlight-line'&gt;   &lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;@&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;parallel&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;1&lt;/span&gt;
&lt;/div&gt;&lt;/div&gt;&lt;div data-line='18' class='code-highlight-row numbered'&gt;&lt;div class='code-highlight-line'&gt;&lt;span class=&quot;k&quot;&gt;WITH&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;RESULT&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;SETS&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;((&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;ProcessId&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;int&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;Rows&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;int&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;NOT&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;NULL&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;
&lt;/div&gt;&lt;/div&gt;&lt;div data-line='19' class='code-highlight-row numbered'&gt;&lt;div class='code-highlight-line'&gt;                   &lt;span class=&quot;n&quot;&gt;ModelAsVarchar&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;nvarchar&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;max&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;NULL&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;));&lt;/span&gt;&lt;/div&gt;&lt;/div&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/figure&gt;&lt;/p&gt;

&lt;p&gt;&lt;strong&gt;Code Snippet 1:&lt;/strong&gt; &lt;em&gt;Model Creation in Parallel&lt;/em&gt;&lt;/p&gt;

&lt;p&gt;The code in &lt;em&gt;Code Snippet1&lt;/em&gt; is supposed to create a model from some random data and then it outputs the serialized model as a string. However when we execute the code in &lt;em&gt;Code Snippet 1&lt;/em&gt; we get a result looking like so:&lt;/p&gt;

&lt;p&gt;&lt;img class=&quot;center&quot; src=&quot;/images/posts/sql_r_services_ext_scriptIII_ssms4.png&quot; width=&quot;796&quot; height=&quot;130&quot;  &gt;
&lt;strong&gt;Figure 2:&lt;/strong&gt; &lt;em&gt;Parallel Model Creation&lt;/em&gt;&lt;/p&gt;

&lt;p&gt;Oh, that was probably not what we wanted - four different models from four different process id's. We see that the models are different based on the outlined, in red, part of &lt;em&gt;Figure 2&lt;/em&gt;. So what we have seen right now should tell us that executing in parallel is not always a good thing.&lt;/p&gt;

&lt;p&gt;At this stage, you may wonder if everything you have read about &lt;strong&gt;RevoScaleR&lt;/strong&gt; being optimised for Big Data and parallel processing if that is just a marketing ploy? No, it is not, it is correct that the  &lt;strong&gt;RevoScaleR&lt;/strong&gt; functions are optimised, and have parallel capabilities. However, for parallel processing, they need the help of the &lt;strong&gt;SQL Server Compute Context&lt;/strong&gt;.&lt;/p&gt;

&lt;h2&gt;Housekeeping&lt;/h2&gt;

&lt;p&gt;Before we &quot;dive&quot; into today's topics let us look at the code and the tools we use today. This section is here for those who want to follow along in what we are doing in the post.&lt;/p&gt;

&lt;h4&gt;Helper Tools&lt;/h4&gt;

&lt;p&gt;To help us figure out the things we want, we use &lt;em&gt;Process Explorer&lt;/em&gt;:&lt;/p&gt;

&lt;ul&gt;
&lt;li&gt;&lt;em&gt;Process Explorer&lt;/em&gt; is used to look at running processes.&lt;/li&gt;
&lt;/ul&gt;


&lt;h4&gt;Code&lt;/h4&gt;

&lt;p&gt;This is the database objects we use in this post:&lt;/p&gt;

&lt;p&gt;&lt;figure class='code-highlight-figure'&gt;&lt;figcaption class='code-highlight-caption'&gt;&lt;span class='code-highlight-caption-title'&gt;Setup&lt;/span&gt;&lt;/figcaption&gt;&lt;div class='code-highlight'&gt;&lt;pre class='code-highlight-pre'&gt;&lt;div data-line='1' class='code-highlight-row numbered'&gt;&lt;div class='code-highlight-line'&gt;&lt;span class=&quot;n&quot;&gt;USE&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;master&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
&lt;/div&gt;&lt;/div&gt;&lt;div data-line='2' class='code-highlight-row numbered'&gt;&lt;div class='code-highlight-line'&gt;&lt;span class=&quot;k&quot;&gt;GO&lt;/span&gt;
&lt;/div&gt;&lt;/div&gt;&lt;div data-line='3' class='code-highlight-row numbered'&gt;&lt;div class='code-highlight-line'&gt; &lt;/div&gt;&lt;/div&gt;&lt;div data-line='4' class='code-highlight-row numbered'&gt;&lt;div class='code-highlight-line'&gt;&lt;span class=&quot;k&quot;&gt;SET&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;NOCOUNT&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;ON&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
&lt;/div&gt;&lt;/div&gt;&lt;div data-line='5' class='code-highlight-row numbered'&gt;&lt;div class='code-highlight-line'&gt;&lt;span class=&quot;k&quot;&gt;GO&lt;/span&gt;
&lt;/div&gt;&lt;/div&gt;&lt;div data-line='6' class='code-highlight-row numbered'&gt;&lt;div class='code-highlight-line'&gt; &lt;/div&gt;&lt;/div&gt;&lt;div data-line='7' class='code-highlight-row numbered'&gt;&lt;div class='code-highlight-line'&gt;&lt;span class=&quot;k&quot;&gt;DROP&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;DATABASE&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;IF&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;EXISTS&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;TestParallel&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
&lt;/div&gt;&lt;/div&gt;&lt;div data-line='8' class='code-highlight-row numbered'&gt;&lt;div class='code-highlight-line'&gt;&lt;span class=&quot;k&quot;&gt;GO&lt;/span&gt;
&lt;/div&gt;&lt;/div&gt;&lt;div data-line='9' class='code-highlight-row numbered'&gt;&lt;div class='code-highlight-line'&gt; &lt;/div&gt;&lt;/div&gt;&lt;div data-line='10' class='code-highlight-row numbered'&gt;&lt;div class='code-highlight-line'&gt;&lt;span class=&quot;k&quot;&gt;CREATE&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;DATABASE&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;TestParallel&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
&lt;/div&gt;&lt;/div&gt;&lt;div data-line='11' class='code-highlight-row numbered'&gt;&lt;div class='code-highlight-line'&gt;&lt;span class=&quot;k&quot;&gt;GO&lt;/span&gt;
&lt;/div&gt;&lt;/div&gt;&lt;div data-line='12' class='code-highlight-row numbered'&gt;&lt;div class='code-highlight-line'&gt; &lt;/div&gt;&lt;/div&gt;&lt;div data-line='13' class='code-highlight-row numbered'&gt;&lt;div class='code-highlight-line'&gt;&lt;span class=&quot;n&quot;&gt;USE&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;TestParallel&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
&lt;/div&gt;&lt;/div&gt;&lt;div data-line='14' class='code-highlight-row numbered'&gt;&lt;div class='code-highlight-line'&gt;&lt;span class=&quot;k&quot;&gt;GO&lt;/span&gt;
&lt;/div&gt;&lt;/div&gt;&lt;div data-line='15' class='code-highlight-row numbered'&gt;&lt;div class='code-highlight-line'&gt; &lt;/div&gt;&lt;/div&gt;&lt;div data-line='16' class='code-highlight-row numbered'&gt;&lt;div class='code-highlight-line'&gt;&lt;span class=&quot;k&quot;&gt;DROP&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;TABLE&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;IF&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;EXISTS&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;dbo&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;tb_Rand_50M&lt;/span&gt;
&lt;/div&gt;&lt;/div&gt;&lt;div data-line='17' class='code-highlight-row numbered'&gt;&lt;div class='code-highlight-line'&gt;&lt;span class=&quot;k&quot;&gt;GO&lt;/span&gt;
&lt;/div&gt;&lt;/div&gt;&lt;div data-line='18' class='code-highlight-row numbered'&gt;&lt;div class='code-highlight-line'&gt;&lt;span class=&quot;k&quot;&gt;CREATE&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;TABLE&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;dbo&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;tb_Rand_50M&lt;/span&gt;
&lt;/div&gt;&lt;/div&gt;&lt;div data-line='19' class='code-highlight-row numbered'&gt;&lt;div class='code-highlight-line'&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;
&lt;/div&gt;&lt;/div&gt;&lt;div data-line='20' class='code-highlight-row numbered'&gt;&lt;div class='code-highlight-line'&gt;  &lt;span class=&quot;n&quot;&gt;RowID&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;bigint&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;identity&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;PRIMARY&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;KEY&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;
&lt;/div&gt;&lt;/div&gt;&lt;div data-line='21' class='code-highlight-row numbered'&gt;&lt;div class='code-highlight-line'&gt;  &lt;span class=&quot;n&quot;&gt;y&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;int&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;NOT&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;NULL&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;rand1&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;int&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;NOT&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;NULL&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;
&lt;/div&gt;&lt;/div&gt;&lt;div data-line='22' class='code-highlight-row numbered'&gt;&lt;div class='code-highlight-line'&gt;  &lt;span class=&quot;n&quot;&gt;rand2&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;int&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;NOT&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;NULL&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;rand3&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;int&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;NOT&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;NULL&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;
&lt;/div&gt;&lt;/div&gt;&lt;div data-line='23' class='code-highlight-row numbered'&gt;&lt;div class='code-highlight-line'&gt;  &lt;span class=&quot;n&quot;&gt;rand4&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;int&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;NOT&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;NULL&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;rand5&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;int&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;NOT&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;NULL&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;
&lt;/div&gt;&lt;/div&gt;&lt;div data-line='24' class='code-highlight-row numbered'&gt;&lt;div class='code-highlight-line'&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
&lt;/div&gt;&lt;/div&gt;&lt;div data-line='25' class='code-highlight-row numbered'&gt;&lt;div class='code-highlight-line'&gt;&lt;span class=&quot;k&quot;&gt;GO&lt;/span&gt;
&lt;/div&gt;&lt;/div&gt;&lt;div data-line='26' class='code-highlight-row numbered'&gt;&lt;div class='code-highlight-line'&gt; &lt;/div&gt;&lt;/div&gt;&lt;div data-line='27' class='code-highlight-row numbered'&gt;&lt;div class='code-highlight-line'&gt;&lt;span class=&quot;k&quot;&gt;INSERT&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;INTO&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;dbo&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;tb_Rand_50M&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;y&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;rand1&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;rand2&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;rand3&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;rand4&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;rand5&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
&lt;/div&gt;&lt;/div&gt;&lt;div data-line='28' class='code-highlight-row numbered'&gt;&lt;div class='code-highlight-line'&gt;&lt;span class=&quot;k&quot;&gt;SELECT&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;TOP&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;50000000&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;CAST&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;ABS&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;CHECKSUM&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;NEWID&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;()))&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;%&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;14&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;AS&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;INT&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
&lt;/div&gt;&lt;/div&gt;&lt;div data-line='29' class='code-highlight-row numbered'&gt;&lt;div class='code-highlight-line'&gt;  &lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;CAST&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;ABS&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;CHECKSUM&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;NEWID&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;()))&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;%&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;20&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;AS&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;INT&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
&lt;/div&gt;&lt;/div&gt;&lt;div data-line='30' class='code-highlight-row numbered'&gt;&lt;div class='code-highlight-line'&gt;  &lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;CAST&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;ABS&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;CHECKSUM&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;NEWID&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;()))&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;%&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;25&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;AS&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;INT&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
&lt;/div&gt;&lt;/div&gt;&lt;div data-line='31' class='code-highlight-row numbered'&gt;&lt;div class='code-highlight-line'&gt;  &lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;CAST&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;ABS&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;CHECKSUM&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;NEWID&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;()))&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;%&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;14&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;AS&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;INT&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
&lt;/div&gt;&lt;/div&gt;&lt;div data-line='32' class='code-highlight-row numbered'&gt;&lt;div class='code-highlight-line'&gt;  &lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;CAST&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;ABS&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;CHECKSUM&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;NEWID&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;()))&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;%&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;50&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;AS&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;INT&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
&lt;/div&gt;&lt;/div&gt;&lt;div data-line='33' class='code-highlight-row numbered'&gt;&lt;div class='code-highlight-line'&gt;  &lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;CAST&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;ABS&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;CHECKSUM&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;NEWID&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;()))&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;%&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;100&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;AS&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;INT&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
&lt;/div&gt;&lt;/div&gt;&lt;div data-line='34' class='code-highlight-row numbered'&gt;&lt;div class='code-highlight-line'&gt;&lt;span class=&quot;k&quot;&gt;FROM&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;sys&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;objects&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;o1&lt;/span&gt;
&lt;/div&gt;&lt;/div&gt;&lt;div data-line='35' class='code-highlight-row numbered'&gt;&lt;div class='code-highlight-line'&gt;&lt;span class=&quot;k&quot;&gt;CROSS&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;JOIN&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;sys&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;objects&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;o2&lt;/span&gt;
&lt;/div&gt;&lt;/div&gt;&lt;div data-line='36' class='code-highlight-row numbered'&gt;&lt;div class='code-highlight-line'&gt;&lt;span class=&quot;k&quot;&gt;CROSS&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;JOIN&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;sys&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;objects&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;o3&lt;/span&gt;
&lt;/div&gt;&lt;/div&gt;&lt;div data-line='37' class='code-highlight-row numbered'&gt;&lt;div class='code-highlight-line'&gt;&lt;span class=&quot;k&quot;&gt;CROSS&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;JOIN&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;sys&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;objects&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;o4&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
&lt;/div&gt;&lt;/div&gt;&lt;div data-line='38' class='code-highlight-row numbered'&gt;&lt;div class='code-highlight-line'&gt;&lt;span class=&quot;k&quot;&gt;GO&lt;/span&gt;
&lt;/div&gt;&lt;/div&gt;&lt;div data-line='39' class='code-highlight-row numbered'&gt;&lt;div class='code-highlight-line'&gt; &lt;/div&gt;&lt;/div&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/figure&gt;&lt;/p&gt;

&lt;p&gt;&lt;strong&gt;Code Snippet 2:&lt;/strong&gt; &lt;em&gt;Setup of Database, Table and Data&lt;/em&gt;&lt;/p&gt;

&lt;p&gt;The code above, (&lt;em&gt;Code Snippet 2&lt;/em&gt;), creates a database - &lt;code&gt;TestParallel&lt;/code&gt; and one table:&lt;/p&gt;

&lt;ul&gt;
&lt;li&gt;&lt;code&gt;dbo.tb_Rand_50M&lt;/code&gt; - This table contains the data we want to analyse. Yes, I know - the data is completely useless, but it is a lot of it, and it helps to illustrate what we want to do.&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;In &lt;em&gt;Code Snippet 2&lt;/em&gt; we also see how we load 50 million records into the &lt;code&gt;dbo.tb_Rand_50M&lt;/code&gt;. Be aware that when you run the code in &lt;em&gt;Code Snippet 2&lt;/em&gt; it may take some time to finish due to the loading of the data.&lt;/p&gt;

&lt;h2&gt;SQL Server Compute Context&lt;/h2&gt;

&lt;p&gt;In &lt;a href=&quot;/2018/03/21/microsoft-sql-server-r-services-sp-execute-external-script-iii/&quot;&gt;sp_execute_external_script - III&lt;/a&gt; we spoke about as part of the functionality in RevoScaleR is the ability to define where a workload executes. By default, it executes on your local machine, but you can also set it to execute in context of somewhere else: Hadoop, Spark and also SQL Server. For this post it is the the SQLCC that interests us.&lt;/p&gt;

&lt;p&gt;The SQLCC is not only available from within SQL Server, but also from desktop applications, like Visual Studio, RStudio and so forth. To demonstrate the ability to execute in a separate context we use Visual Studio and some R code:&lt;/p&gt;

&lt;ol&gt;
&lt;li&gt;Open &lt;em&gt;Visual Studio&lt;/em&gt;&lt;/li&gt;
&lt;li&gt;Create a new R project.&lt;/li&gt;
&lt;/ol&gt;


&lt;p&gt;In the editor you now have an empty &lt;code&gt;.R&lt;/code&gt; file.&lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;&lt;strong&gt;NOTE:&lt;/strong&gt; You do not have to use R, you can if you want to use Python as well.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;In the &lt;code&gt;.R&lt;/code&gt; file enter following code:&lt;/p&gt;

&lt;p&gt;&lt;figure class='code-highlight-figure'&gt;&lt;figcaption class='code-highlight-caption'&gt;&lt;span class='code-highlight-caption-title'&gt;R Code&lt;/span&gt;&lt;/figcaption&gt;&lt;div class='code-highlight'&gt;&lt;pre class='code-highlight-pre'&gt;&lt;div data-line='1' class='code-highlight-row numbered'&gt;&lt;div class='code-highlight-line'&gt;&lt;span class=&quot;c1&quot;&gt;# set up the connection string&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;&lt;/span&gt;
&lt;/div&gt;&lt;/div&gt;&lt;div data-line='2' class='code-highlight-row numbered'&gt;&lt;div class='code-highlight-line'&gt;&lt;span class=&quot;n&quot;&gt;sqlServerConnString&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;lt;-&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;Driver=SQL Server;server=.\\inst2k17;
&lt;/div&gt;&lt;/div&gt;&lt;div data-line='3' class='code-highlight-row numbered'&gt;&lt;div class='code-highlight-line'&gt;                        database=testParallel;
&lt;/div&gt;&lt;/div&gt;&lt;div data-line='4' class='code-highlight-row numbered'&gt;&lt;div class='code-highlight-line'&gt;                        uid=&amp;lt;the user id&amp;gt;;pwd=&amp;lt;the password&amp;gt;&quot;&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
&lt;/div&gt;&lt;/div&gt;&lt;div data-line='5' class='code-highlight-row numbered'&gt;&lt;div class='code-highlight-line'&gt;&lt;/span&gt;
&lt;/div&gt;&lt;/div&gt;&lt;div data-line='6' class='code-highlight-row numbered'&gt;&lt;div class='code-highlight-line'&gt;&lt;span class=&quot;n&quot;&gt;mydata&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;lt;-&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;RxSqlServerData&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;sqlQuery&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;SELECT y, rand1, rand2,
&lt;/div&gt;&lt;/div&gt;&lt;div data-line='7' class='code-highlight-row numbered'&gt;&lt;div class='code-highlight-line'&gt;                                      rand3, rand4, rand5
&lt;/div&gt;&lt;/div&gt;&lt;div data-line='8' class='code-highlight-row numbered'&gt;&lt;div class='code-highlight-line'&gt;                                      FROM dbo.tb_Rand_50M&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
&lt;/div&gt;&lt;/div&gt;&lt;div data-line='9' class='code-highlight-row numbered'&gt;&lt;div class='code-highlight-line'&gt;                          &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;connectionString&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;sqlServerConnString&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
&lt;/div&gt;&lt;/div&gt;&lt;div data-line='10' class='code-highlight-row numbered'&gt;&lt;div class='code-highlight-line'&gt;&lt;/span&gt;
&lt;/div&gt;&lt;/div&gt;&lt;div data-line='11' class='code-highlight-row numbered'&gt;&lt;div class='code-highlight-line'&gt;&lt;span class=&quot;n&quot;&gt;system.time&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;print&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;&lt;/span&gt;
&lt;/div&gt;&lt;/div&gt;&lt;div data-line='12' class='code-highlight-row numbered'&gt;&lt;div class='code-highlight-line'&gt;&lt;span class=&quot;n&quot;&gt;myModel&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;lt;-&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;rxLinMod&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;y&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;~&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;rand1&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;+&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;rand2&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;+&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;rand3&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;+&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;rand4&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;+&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;rand5&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
&lt;/div&gt;&lt;/div&gt;&lt;div data-line='13' class='code-highlight-row numbered'&gt;&lt;div class='code-highlight-line'&gt;                    &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;data&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;mydata&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)));&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;&lt;/span&gt;&lt;/div&gt;&lt;/div&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/figure&gt;&lt;/p&gt;

&lt;p&gt;&lt;strong&gt;Code Snippet 3:&lt;/strong&gt; &lt;em&gt;R Code - Local Compute Context&lt;/em&gt;&lt;/p&gt;

&lt;p&gt;As we see in &lt;em&gt;Code Snippet 3&lt;/em&gt;, we create a linear regression model over the 50 million rows in the &lt;code&gt;dbo.tb_Rand_50M&lt;/code&gt; table and we measure the time it takes (&lt;code&gt;system.time()&lt;/code&gt;). As no compute context is defined the code runs under the local context in one thread.&lt;/p&gt;

&lt;p&gt;Before we execute the code we should start up &lt;em&gt;Process Explorer&lt;/em&gt; to see what processes are involved when running the code:&lt;/p&gt;

&lt;ul&gt;
&lt;li&gt;Run &lt;em&gt;Process Explorer&lt;/em&gt; as admin.&lt;/li&gt;
&lt;li&gt;Navigate to the &lt;code&gt;devenv.exe&lt;/code&gt; process in &lt;em&gt;Process Explorer&lt;/em&gt;.&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;Notice how, under the &lt;code&gt;devenv.exe&lt;/code&gt; process, there is a node for &lt;code&gt;Microsoft.R.Host.Broker.exe&lt;/code&gt;. Under that node are two &lt;code&gt;Microsoft.R.Host.exe&lt;/code&gt; nodes which in turn hosts &lt;code&gt;BxlServer.exe&lt;/code&gt;. This is in line with what we discussed in &lt;a href=&quot;/2017/07/22/microsoft-sql-server-r-services-internals-viii/&quot;&gt;Internals - VIII&lt;/a&gt; about hosting of R processes.&lt;/p&gt;

&lt;p&gt;When you execute the code in &lt;em&gt;Code Snippet 3&lt;/em&gt; the output in &lt;em&gt;Process Explorer&lt;/em&gt; looks something like so:&lt;/p&gt;

&lt;p&gt;&lt;img class=&quot;center&quot; src=&quot;/images/posts/sql_ml_services_comp_ctx1.png&quot; width=&quot;435&quot; height=&quot;309&quot;  &gt;
&lt;strong&gt;Figure 3:&lt;/strong&gt; &lt;em&gt;Local Context Execution&lt;/em&gt;&lt;/p&gt;

&lt;p&gt;In &lt;em&gt;Figure 3&lt;/em&gt; we see the &lt;code&gt;devenv.exe&lt;/code&gt; process outlined in red and the two &lt;code&gt;Microsoft.R.Host.exe&lt;/code&gt; processes outlined in blue. The second &lt;code&gt;Microsoft.R.Host.exe&lt;/code&gt; process shows how the local &lt;code&gt;BxlServer.exe&lt;/code&gt; process (highlighted in red) handles the execution of the code. We see this as the &lt;code&gt;CPU&lt;/code&gt; value is greater than 0.01. As the process is local, it also means that the process retrieves all data it needs from wherever the data resides. So this is what executing in the local context looks like, oh and before we go any further, please make a note of the output from the &lt;code&gt;system.time()&lt;/code&gt; call. On my machine, it is ~40 seconds.&lt;/p&gt;

&lt;p&gt;Let us now see what it looks like when we execute in the SQL Server compute context. To enable the SQL Server compute context we only need to add a couple of lines of code from what we saw in &lt;em&gt;Code Snippet 3&lt;/em&gt;:&lt;/p&gt;

&lt;p&gt;&lt;figure class='code-highlight-figure'&gt;&lt;figcaption class='code-highlight-caption'&gt;&lt;span class='code-highlight-caption-title'&gt;R SQL Compute Context Code&lt;/span&gt;&lt;/figcaption&gt;&lt;div class='code-highlight'&gt;&lt;pre class='code-highlight-pre'&gt;&lt;div data-line='1' class='code-highlight-row numbered'&gt;&lt;div class='code-highlight-line'&gt;&lt;span class=&quot;c1&quot;&gt;# set up the connection string&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;&lt;/span&gt;
&lt;/div&gt;&lt;/div&gt;&lt;div data-line='2' class='code-highlight-row numbered'&gt;&lt;div class='code-highlight-line'&gt;&lt;span class=&quot;n&quot;&gt;sqlServerConnString&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;lt;-&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;Driver=SQL Server;server=.\\inst2k17;
&lt;/div&gt;&lt;/div&gt;&lt;div data-line='3' class='code-highlight-row numbered'&gt;&lt;div class='code-highlight-line'&gt;                        database=testParallel;
&lt;/div&gt;&lt;/div&gt;&lt;div data-line='4' class='code-highlight-row numbered'&gt;&lt;div class='code-highlight-line'&gt;                        uid=&amp;lt;the user id&amp;gt;;pwd=&amp;lt;the password&amp;gt;&quot;&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
&lt;/div&gt;&lt;/div&gt;&lt;div data-line='5' class='code-highlight-row numbered'&gt;&lt;div class='code-highlight-line'&gt;&lt;/span&gt;
&lt;/div&gt;&lt;/div&gt;&lt;div data-line='6' class='code-highlight-row numbered'&gt;&lt;div class='code-highlight-line'&gt;&lt;span class=&quot;c1&quot;&gt;# set up a compute context&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;&lt;/span&gt;
&lt;/div&gt;&lt;/div&gt;&lt;div data-line='7' class='code-highlight-row numbered'&gt;&lt;div class='code-highlight-line'&gt;&lt;span class=&quot;n&quot;&gt;sqlCtx&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;lt;-&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;RxInSqlServer&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;connectionString&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;sqlServerConnString&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
&lt;/div&gt;&lt;/div&gt;&lt;div data-line='8' class='code-highlight-row numbered'&gt;&lt;div class='code-highlight-line'&gt;                        &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;numTasks&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;m&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;&lt;/span&gt;
&lt;/div&gt;&lt;/div&gt;&lt;div data-line='9' class='code-highlight-row numbered'&gt;&lt;div class='code-highlight-line'&gt;&lt;span class=&quot;c1&quot;&gt;# set the compute context to be the sql context&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;&lt;/span&gt;
&lt;/div&gt;&lt;/div&gt;&lt;div data-line='10' class='code-highlight-row numbered'&gt;&lt;div class='code-highlight-line'&gt;&lt;span class=&quot;n&quot;&gt;rxSetComputeContext&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;sqlCtx&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
&lt;/div&gt;&lt;/div&gt;&lt;div data-line='11' class='code-highlight-row numbered'&gt;&lt;div class='code-highlight-line'&gt;&lt;/span&gt;
&lt;/div&gt;&lt;/div&gt;&lt;div data-line='12' class='code-highlight-row numbered'&gt;&lt;div class='code-highlight-line'&gt;&lt;span class=&quot;n&quot;&gt;mydata&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;lt;-&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;RxSqlServerData&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;sqlQuery&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;SELECT y, rand1, rand2,
&lt;/div&gt;&lt;/div&gt;&lt;div data-line='13' class='code-highlight-row numbered'&gt;&lt;div class='code-highlight-line'&gt;                                      rand3, rand4, rand5
&lt;/div&gt;&lt;/div&gt;&lt;div data-line='14' class='code-highlight-row numbered'&gt;&lt;div class='code-highlight-line'&gt;                                      FROM dbo.tb_Rand_50M&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
&lt;/div&gt;&lt;/div&gt;&lt;div data-line='15' class='code-highlight-row numbered'&gt;&lt;div class='code-highlight-line'&gt;                          &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;connectionString&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;sqlServerConnString&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
&lt;/div&gt;&lt;/div&gt;&lt;div data-line='16' class='code-highlight-row numbered'&gt;&lt;div class='code-highlight-line'&gt;&lt;/span&gt;
&lt;/div&gt;&lt;/div&gt;&lt;div data-line='17' class='code-highlight-row numbered'&gt;&lt;div class='code-highlight-line'&gt;&lt;span class=&quot;n&quot;&gt;system.time&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;print&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;&lt;/span&gt;
&lt;/div&gt;&lt;/div&gt;&lt;div data-line='18' class='code-highlight-row numbered'&gt;&lt;div class='code-highlight-line'&gt;&lt;span class=&quot;n&quot;&gt;myModel&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;lt;-&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;rxLinMod&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;y&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;~&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;rand1&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;+&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;rand2&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;+&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;rand3&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;+&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;rand4&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;+&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;rand5&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
&lt;/div&gt;&lt;/div&gt;&lt;div data-line='19' class='code-highlight-row numbered'&gt;&lt;div class='code-highlight-line'&gt;                    &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;data&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;mydata&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)));&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;&lt;/span&gt;&lt;/div&gt;&lt;/div&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/figure&gt;&lt;/p&gt;

&lt;p&gt;&lt;strong&gt;Code Snippet 4:&lt;/strong&gt; &lt;em&gt;R Code - SQL Server Compute Context&lt;/em&gt;&lt;/p&gt;

&lt;p&gt;In the code above we use the &lt;code&gt;RxInSqlServer()&lt;/code&gt; function to indicate we want to execute in a SQL context. The &lt;code&gt;connectionString&lt;/code&gt; property defines where we execute, and the &lt;code&gt;numTasks&lt;/code&gt; property sets the number of tasks (processes) to run for each computation, in &lt;em&gt;Code Snippet 4&lt;/em&gt; it is set to 1 which from a processing perspective should match what we do in &lt;em&gt;Code Snippet 3&lt;/em&gt;. Before we execute the code in &lt;em&gt;Code Snippet 4&lt;/em&gt; we do what we did before we ran the code in &lt;em&gt;Code Snippet 3&lt;/em&gt;:&lt;/p&gt;

&lt;ul&gt;
&lt;li&gt;Run &lt;em&gt;Process Explorer&lt;/em&gt; as admin.&lt;/li&gt;
&lt;li&gt;Navigate to the &lt;code&gt;devenv.exe&lt;/code&gt; process in &lt;em&gt;Process Explorer&lt;/em&gt;.&lt;/li&gt;
&lt;li&gt;In addition, also look at the &lt;code&gt;Launchpad.exe&lt;/code&gt; process in &lt;em&gt;Process Explorer&lt;/em&gt;.&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;When we execute we see that the &lt;code&gt;BxlServer.exe&lt;/code&gt; processes under the &lt;code&gt;Microsoft.R.Host.exe&lt;/code&gt; processes are idling, but when we look at the &lt;code&gt;Launchpad.exe&lt;/code&gt; process we see this:&lt;/p&gt;

&lt;p&gt;&lt;img class=&quot;center&quot; src=&quot;/images/posts/sql_ml_services_comp_ctx2.png&quot; width=&quot;425&quot; height=&quot;340&quot;  &gt;
&lt;strong&gt;Figure 4:&lt;/strong&gt; &lt;em&gt;SQL Server Compute Context Execution&lt;/em&gt;&lt;/p&gt;

&lt;p&gt;Interesting, we see that one of the &lt;code&gt;BxlServer.exe&lt;/code&gt; processes under &lt;code&gt;Launchpad.exe&lt;/code&gt; is busy (highlighted in yellow). So we see that the code executes in the context of SQL Server. What also is interesting is that the output from &lt;code&gt;system.time()&lt;/code&gt;, is on my machine, around 32 seconds - 8 seconds less than when the execution happened in the local compute context! The fact that the execution time is shorter when executing in the SQL Server compute context than when executing in the local context is interesting since we do not do anything different - no more tasks, nothing. Later in this post, we come back to this, but now let us look at using the SQLCC when executing inside SQL Server - like when executing &lt;code&gt;sp_execute_external_script&lt;/code&gt;.&lt;/p&gt;

&lt;h2&gt;SQL Server and SQL Server Compute Context&lt;/h2&gt;

&lt;p&gt;So the question is now that if we execute from inside of SQL Server, is that not automatically within a SQLCC? It is a valid question since what we see in &lt;em&gt;Figure 4&lt;/em&gt; looks exactly what we saw in quite a few of the posts in the &lt;a href=&quot;/series/sql_server_2k16_r_services&quot;&gt;Internals&lt;/a&gt; series. In there we saw how the &lt;code&gt;Launchpad.exe&lt;/code&gt; process is hosting, via &lt;code&gt;RTerm.exe&lt;/code&gt;, a &lt;code&gt;BxlServer.exe&lt;/code&gt; server process which processes the data. So let us switch over to SQL Server and &lt;em&gt;SQL Server Management Studio&lt;/em&gt; &lt;em&gt;SSMS&lt;/em&gt; and try to see if we execute in the SQLCC or not.&lt;/p&gt;

&lt;p&gt;You see in &lt;em&gt;Code Snippet 4&lt;/em&gt; how we use the function &lt;code&gt;rxSetComputeContext()&lt;/code&gt; to set the compute context. There is also a function to retrieve the compute context you are in: &lt;code&gt;rxGetComputeContext()&lt;/code&gt; (in Python it is &lt;code&gt;rx_get_compute_context&lt;/code&gt;) which we now use:&lt;/p&gt;

&lt;p&gt;&lt;figure class='code-highlight-figure'&gt;&lt;figcaption class='code-highlight-caption'&gt;&lt;span class='code-highlight-caption-title'&gt;Get Compute Context&lt;/span&gt;&lt;/figcaption&gt;&lt;div class='code-highlight'&gt;&lt;pre class='code-highlight-pre'&gt;&lt;div data-line='1' class='code-highlight-row numbered'&gt;&lt;div class='code-highlight-line'&gt;&lt;span class=&quot;n&quot;&gt;EXEC&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;sp_execute_external_script&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
&lt;/div&gt;&lt;/div&gt;&lt;div data-line='2' class='code-highlight-row numbered'&gt;&lt;div class='code-highlight-line'&gt;      &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;@&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;language&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;N&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;'R'&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
&lt;/div&gt;&lt;/div&gt;&lt;div data-line='3' class='code-highlight-row numbered'&gt;&lt;div class='code-highlight-line'&gt;    &lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;@&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;script&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;N&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;'
&lt;/div&gt;&lt;/div&gt;&lt;div data-line='4' class='code-highlight-row numbered'&gt;&lt;div class='code-highlight-line'&gt;            ctx &amp;lt;- rxGetComputeContext();
&lt;/div&gt;&lt;/div&gt;&lt;div data-line='5' class='code-highlight-row numbered'&gt;&lt;div class='code-highlight-line'&gt;            show(ctx);'&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;&lt;/span&gt;&lt;/div&gt;&lt;/div&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/figure&gt;&lt;/p&gt;

&lt;p&gt;&lt;strong&gt;Code Snippet 5:&lt;/strong&gt; &lt;em&gt;Use rxGetComputeContext()&lt;/em&gt;&lt;/p&gt;

&lt;p&gt;So in &lt;em&gt;Code Snippet 5&lt;/em&gt; we call the &lt;code&gt;rxGetComputeContext()&lt;/code&gt; function and assign the context to a variable for which we then print out the information from the metadata columns of the variable. This is what we see when we execute the code:&lt;/p&gt;

&lt;p&gt;&lt;img class=&quot;center&quot; src=&quot;/images/posts/sql_ml_services_comp_local_ctx.png&quot; width=&quot;350&quot; height=&quot;65&quot;  &gt;
&lt;strong&gt;Figure 5:&lt;/strong&gt; &lt;em&gt;SQL Server Local Compute Context&lt;/em&gt;&lt;/p&gt;

&lt;p&gt;The highlighted part in &lt;em&gt;Figure 5&lt;/em&gt; says that we do run in the local compute context (&lt;code&gt;RxLocalSeq&lt;/code&gt;). So, even when executing in SQL Server we need to explicitly set the SQL Server compute context via &lt;code&gt;RxInSqlServer()&lt;/code&gt; and &lt;code&gt;rxSetComputeContext()&lt;/code&gt; as we did in &lt;em&gt;Code Snippet 4&lt;/em&gt;.&lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;&lt;strong&gt;NOTE:&lt;/strong&gt; The local compute context is named &lt;code&gt;RxLocalSeq&lt;/code&gt; (local sequential) and there is also another context &lt;code&gt;RxLocalParallel&lt;/code&gt; (local parallel), which you can use if you manually manage distributed processing in Hadoop or Spark.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt; Let us now take a closer look at &lt;code&gt;RxInSqlServer()&lt;/code&gt;.&lt;/p&gt;

&lt;h4&gt;RxInSqlServer()&lt;/h4&gt;

&lt;p&gt;When setting up a SQL Server Compute Context we use the &lt;code&gt;RxInSqlServer&lt;/code&gt; function. The function name is the same for both R and Python and the signatures look like so:&lt;/p&gt;

&lt;p&gt;&lt;figure class='code-highlight-figure'&gt;&lt;figcaption class='code-highlight-caption'&gt;&lt;span class='code-highlight-caption-title'&gt;R&lt;/span&gt;&lt;/figcaption&gt;&lt;div class='code-highlight'&gt;&lt;pre class='code-highlight-pre'&gt;&lt;div data-line='1' class='code-highlight-row numbered'&gt;&lt;div class='code-highlight-line'&gt;&lt;span class=&quot;n&quot;&gt;RxInSqlServer&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;object&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;connectionString&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
&lt;/div&gt;&lt;/div&gt;&lt;div data-line='2' class='code-highlight-row numbered'&gt;&lt;div class='code-highlight-line'&gt;              &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;numTasks&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;rxGetOption&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;numTasks&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;),&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
&lt;/div&gt;&lt;/div&gt;&lt;div data-line='3' class='code-highlight-row numbered'&gt;&lt;div class='code-highlight-line'&gt;              &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;autoCleanup&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;kc&quot;&gt;TRUE&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;consoleOutput&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;kc&quot;&gt;FALSE&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
&lt;/div&gt;&lt;/div&gt;&lt;div data-line='4' class='code-highlight-row numbered'&gt;&lt;div class='code-highlight-line'&gt;              &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;executionTimeoutSeconds&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;m&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;wait&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;kc&quot;&gt;TRUE&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
&lt;/div&gt;&lt;/div&gt;&lt;div data-line='5' class='code-highlight-row numbered'&gt;&lt;div class='code-highlight-line'&gt;              &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;packagesToLoad&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;kc&quot;&gt;NULL&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;shareDir&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;kc&quot;&gt;NULL&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
&lt;/div&gt;&lt;/div&gt;&lt;div data-line='6' class='code-highlight-row numbered'&gt;&lt;div class='code-highlight-line'&gt;              &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;server&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;kc&quot;&gt;NULL&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;databaseName&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;kc&quot;&gt;NULL&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;user&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;kc&quot;&gt;NULL&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
&lt;/div&gt;&lt;/div&gt;&lt;div data-line='7' class='code-highlight-row numbered'&gt;&lt;div class='code-highlight-line'&gt;              &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;password&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;kc&quot;&gt;NULL&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;   &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;  &lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;&lt;/span&gt;&lt;/div&gt;&lt;/div&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/figure&gt;&lt;/p&gt;

&lt;p&gt;&lt;strong&gt;Code Snippet 6:&lt;/strong&gt; &lt;em&gt;R Signature&lt;/em&gt;&lt;/p&gt;

&lt;p&gt;&lt;figure class='code-highlight-figure'&gt;&lt;figcaption class='code-highlight-caption'&gt;&lt;span class='code-highlight-caption-title'&gt;Python&lt;/span&gt;&lt;/figcaption&gt;&lt;div class='code-highlight'&gt;&lt;pre class='code-highlight-pre'&gt;&lt;div data-line='1' class='code-highlight-row numbered'&gt;&lt;div class='code-highlight-line'&gt;&lt;span class=&quot;n&quot;&gt;revoscalepy&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;RxInSqlServer&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;connection_string&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;str&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;
&lt;/div&gt;&lt;/div&gt;&lt;div data-line='2' class='code-highlight-row numbered'&gt;&lt;div class='code-highlight-line'&gt;                          &lt;span class=&quot;n&quot;&gt;num_tasks&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;int&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;
&lt;/div&gt;&lt;/div&gt;&lt;div data-line='3' class='code-highlight-row numbered'&gt;&lt;div class='code-highlight-line'&gt;                          &lt;span class=&quot;n&quot;&gt;auto_cleanup&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;bool&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;bp&quot;&gt;True&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;
&lt;/div&gt;&lt;/div&gt;&lt;div data-line='4' class='code-highlight-row numbered'&gt;&lt;div class='code-highlight-line'&gt;                          &lt;span class=&quot;n&quot;&gt;console_output&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;bool&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;bp&quot;&gt;None&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;
&lt;/div&gt;&lt;/div&gt;&lt;div data-line='5' class='code-highlight-row numbered'&gt;&lt;div class='code-highlight-line'&gt;                          &lt;span class=&quot;n&quot;&gt;execution_timeout_seconds&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;int&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;bp&quot;&gt;None&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;
&lt;/div&gt;&lt;/div&gt;&lt;div data-line='6' class='code-highlight-row numbered'&gt;&lt;div class='code-highlight-line'&gt;                          &lt;span class=&quot;n&quot;&gt;wait&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;bool&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;bp&quot;&gt;True&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;
&lt;/div&gt;&lt;/div&gt;&lt;div data-line='7' class='code-highlight-row numbered'&gt;&lt;div class='code-highlight-line'&gt;                          &lt;span class=&quot;n&quot;&gt;packages_to_load&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;list&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;bp&quot;&gt;None&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;/div&gt;&lt;/div&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/figure&gt;&lt;/p&gt;

&lt;p&gt;&lt;strong&gt;Code Snippet 7:&lt;/strong&gt; &lt;em&gt;Python Signature&lt;/em&gt;&lt;/p&gt;

&lt;p&gt;When we compare the signatures in &lt;em&gt;Code Snippet 6&lt;/em&gt; and &lt;em&gt;Code Snippet 7&lt;/em&gt; we see they differ somewhat, the reason for this I am not sure about but for now let us look at the parameters that are useful/important when executing &lt;code&gt;sp_execute_external_script&lt;/code&gt;.&lt;/p&gt;

&lt;p&gt;&lt;strong&gt;connectionString&lt;/strong&gt;/&lt;strong&gt;connection_string&lt;/strong&gt;:&lt;/p&gt;

&lt;p&gt;The ODBC connection string to the SQL Server where you want the computations to take place and you can use both Windows authentication mode as well as mixed mode.&lt;/p&gt;

&lt;p&gt;Please keep in mind that the connection string for the data source (where you get the data to process from) does not need to be the same as the connection string for the context and the context connection string does not have to point to a different database than the one you execute in.&lt;/p&gt;

&lt;p&gt;&lt;strong&gt;numTasks&lt;/strong&gt;/&lt;strong&gt;num_tasks&lt;/strong&gt;:&lt;/p&gt;

&lt;p&gt;This parameter is where you set the number of tasks (processes) to run for each computation. The parameter defines the maximum number of tasks SQL Server can use. SQL Server can, however, decide to start fewer processes:&lt;/p&gt;

&lt;ul&gt;
&lt;li&gt;Dependent on the volume of data (small dataset lower number of processes).&lt;/li&gt;
&lt;li&gt;If other jobs are already using too many resources.&lt;/li&gt;
&lt;li&gt;If num_tasks exceeds the MAXDOP (maximum degree of parallelism) configuration option in SQL Server.&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;Each of the tasks is given data in parallel and does computations in parallel, and so computation time may decrease as num_tasks increases.&lt;/p&gt;

&lt;h4&gt;Set the Context&lt;/h4&gt;

&lt;p&gt;To set the compute context we do the same as in &lt;em&gt;Code Snippet 4&lt;/em&gt;:&lt;/p&gt;

&lt;ul&gt;
&lt;li&gt;Set the connection string which defines where the computations take place.&lt;/li&gt;
&lt;li&gt;Call &lt;code&gt;RxInSqlServer()&lt;/code&gt; to create the context.&lt;/li&gt;
&lt;li&gt;Set the context via &lt;code&gt;rxSetComputeContext()&lt;/code&gt;.&lt;/li&gt;
&lt;li&gt;Computations using RevoScaleR/revoscalepy functionality is now &quot;automagically&quot; processed in the defined compute context whereas non RevoScaleR/revoscalepy functions run in the local context.&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;To see what it looks like we edit the code in &lt;em&gt;Code Snippet 4&lt;/em&gt; somewhat:&lt;/p&gt;

&lt;p&gt;&lt;figure class='code-highlight-figure'&gt;&lt;figcaption class='code-highlight-caption'&gt;&lt;span class='code-highlight-caption-title'&gt;SQL Compute Context&lt;/span&gt;&lt;/figcaption&gt;&lt;div class='code-highlight'&gt;&lt;pre class='code-highlight-pre'&gt;&lt;div data-line='1' class='code-highlight-row numbered'&gt;&lt;div class='code-highlight-line'&gt;&lt;span class=&quot;k&quot;&gt;DECLARE&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;@&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;start&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;datetime2&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;SYSUTCDATETIME&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;()&lt;/span&gt;
&lt;/div&gt;&lt;/div&gt;&lt;div data-line='2' class='code-highlight-row numbered'&gt;&lt;div class='code-highlight-line'&gt;&lt;span class=&quot;k&quot;&gt;EXEC&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;sp_execute_external_script&lt;/span&gt;&lt;br/&gt;
&lt;/div&gt;&lt;/div&gt;&lt;div data-line='3' class='code-highlight-row numbered'&gt;&lt;div class='code-highlight-line'&gt;      &lt;span class=&quot;o&quot;&gt;@&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;language&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;N&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;'R'&lt;/span&gt;
&lt;/div&gt;&lt;/div&gt;&lt;div data-line='4' class='code-highlight-row numbered'&gt;&lt;div class='code-highlight-line'&gt;    &lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;@&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;script&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;N&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;'
&lt;/div&gt;&lt;/div&gt;&lt;div data-line='5' class='code-highlight-row numbered'&gt;&lt;div class='code-highlight-line'&gt;      # set up the connection string
&lt;/div&gt;&lt;/div&gt;&lt;div data-line='6' class='code-highlight-row numbered'&gt;&lt;div class='code-highlight-line'&gt;      sqlServerConnString &amp;lt;- &quot;Driver=SQL Server;server=.&lt;/span&gt;&lt;span class=&quot;se&quot;&gt;\&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;inst2k17;
&lt;/div&gt;&lt;/div&gt;&lt;div data-line='7' class='code-highlight-row numbered'&gt;&lt;div class='code-highlight-line'&gt;                              database=testParallel;
&lt;/div&gt;&lt;/div&gt;&lt;div data-line='8' class='code-highlight-row numbered'&gt;&lt;div class='code-highlight-line'&gt;                              uid=&amp;lt;the user id&amp;gt;;pwd=&amp;lt;the password&amp;gt;&quot;
&lt;/div&gt;&lt;/div&gt;&lt;div data-line='9' class='code-highlight-row numbered'&gt;&lt;div class='code-highlight-line'&gt; &lt;/div&gt;&lt;/div&gt;&lt;div data-line='10' class='code-highlight-row numbered'&gt;&lt;div class='code-highlight-line'&gt;      # set up a compute context
&lt;/div&gt;&lt;/div&gt;&lt;div data-line='11' class='code-highlight-row numbered'&gt;&lt;div class='code-highlight-line'&gt;      sqlCtx &amp;lt;- RxInSqlServer(connectionString = sqlServerConnString,
&lt;/div&gt;&lt;/div&gt;&lt;div data-line='12' class='code-highlight-row numbered'&gt;&lt;div class='code-highlight-line'&gt;                              numTasks = 1)
&lt;/div&gt;&lt;/div&gt;&lt;div data-line='13' class='code-highlight-row numbered'&gt;&lt;div class='code-highlight-line'&gt;      # set the compute context to be the sql context
&lt;/div&gt;&lt;/div&gt;&lt;div data-line='14' class='code-highlight-row numbered'&gt;&lt;div class='code-highlight-line'&gt;      rxSetComputeContext(sqlCtx)
&lt;/div&gt;&lt;/div&gt;&lt;div data-line='15' class='code-highlight-row numbered'&gt;&lt;div class='code-highlight-line'&gt; &lt;/div&gt;&lt;/div&gt;&lt;div data-line='16' class='code-highlight-row numbered'&gt;&lt;div class='code-highlight-line'&gt;      mydata &amp;lt;- RxSqlServerData(sqlQuery = &quot;SELECT y, rand1, rand2,
&lt;/div&gt;&lt;/div&gt;&lt;div data-line='17' class='code-highlight-row numbered'&gt;&lt;div class='code-highlight-line'&gt;                                           rand3, rand4, rand5
&lt;/div&gt;&lt;/div&gt;&lt;div data-line='18' class='code-highlight-row numbered'&gt;&lt;div class='code-highlight-line'&gt;                                           FROM dbo.tb_Rand_50M&quot;,
&lt;/div&gt;&lt;/div&gt;&lt;div data-line='19' class='code-highlight-row numbered'&gt;&lt;div class='code-highlight-line'&gt;                                connectionString = sqlServerConnString);
&lt;/div&gt;&lt;/div&gt;&lt;div data-line='20' class='code-highlight-row numbered'&gt;&lt;div class='code-highlight-line'&gt; &lt;/div&gt;&lt;/div&gt;&lt;div data-line='21' class='code-highlight-row numbered'&gt;&lt;div class='code-highlight-line'&gt;      myModel &amp;lt;- rxLinMod(y ~ rand1 + rand2 + rand3 + rand4 + rand5,
&lt;/div&gt;&lt;/div&gt;&lt;div data-line='22' class='code-highlight-row numbered'&gt;&lt;div class='code-highlight-line'&gt;                          data = mydata);
&lt;/div&gt;&lt;/div&gt;&lt;div data-line='23' class='code-highlight-row numbered'&gt;&lt;div class='code-highlight-line'&gt; &lt;/div&gt;&lt;/div&gt;&lt;div data-line='24' class='code-highlight-row numbered'&gt;&lt;div class='code-highlight-line'&gt;      ctx &amp;lt;- rxGetComputeContext();
&lt;/div&gt;&lt;/div&gt;&lt;div data-line='25' class='code-highlight-row numbered'&gt;&lt;div class='code-highlight-line'&gt;      show(ctx);'&lt;/span&gt;
&lt;/div&gt;&lt;/div&gt;&lt;div data-line='26' class='code-highlight-row numbered'&gt;&lt;div class='code-highlight-line'&gt;&lt;span class=&quot;k&quot;&gt;SELECT&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;DATEDIFF&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;ss&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;@&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;start&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;SYSUTCDATETIME&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;())&lt;/span&gt;&lt;/div&gt;&lt;/div&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/figure&gt;&lt;/p&gt;

&lt;p&gt;&lt;strong&gt;Code Snippet 8:&lt;/strong&gt; &lt;em&gt;SQL Compute Context from sp_execute_external_script&lt;/em&gt;&lt;/p&gt;

&lt;p&gt;The only difference between the code in &lt;em&gt;Code Snippet 8&lt;/em&gt; and &lt;em&gt;Code Snippet 4&lt;/em&gt; is that we do not use &lt;code&gt;system.time&lt;/code&gt; anymore, but instead do a&lt;code&gt;DATEDIFF&lt;/code&gt;. We also print out the context at the very end, and when we execute we see that we are in the SQLCC:&lt;/p&gt;

&lt;p&gt;&lt;img class=&quot;center&quot; src=&quot;/images/posts/sql_ml_services_comp_sql_ctx.png&quot; width=&quot;440&quot; height=&quot;295&quot;  &gt;
&lt;strong&gt;Figure 5:&lt;/strong&gt; &lt;em&gt;Compute Context Output&lt;/em&gt;&lt;/p&gt;

&lt;p&gt;The two highlighted parts in &lt;em&gt;Figure 5&lt;/em&gt; shows that we indeed executed inside the SQLCC. As for the execution time; I see in the &lt;em&gt;Results&lt;/em&gt; tab in &lt;em&gt;SSMS&lt;/em&gt; that the execution took ~30 seconds. If you were to comment out the &lt;code&gt;RxInSqlServer&lt;/code&gt; and &lt;code&gt;rxSetComputeContext&lt;/code&gt; statements and re-run the code, you'd see the same as we saw above when we used Visual Studio. E.g. executing inside the SQLCC is faster than in the local context, even though it runs in the same database and with the same number of tasks (1). As mentioned in the part where we looked at executing from Visual Studio, something is &quot;going on&quot;, and that is a topic for a future post.&lt;/p&gt;

&lt;h2&gt;Under the Covers&lt;/h2&gt;

&lt;p&gt;Now it is time to see how it works when we execute code running in a SQL Server compute context set up with multiple tasks. Remember what we saw in &lt;a href=&quot;/2018/03/21/microsoft-sql-server-r-services-sp-execute-external-script-iii/&quot;&gt;sp_execute_external_script - III&lt;/a&gt; when we executed code that ran in parallel:&lt;/p&gt;

&lt;p&gt;&lt;img class=&quot;center&quot; src=&quot;/images/posts/sql_r_services_ext_scriptIII_proc_exp2.png&quot; width=&quot;720&quot; height=&quot;575&quot;  &gt;
&lt;strong&gt;Figure 6:&lt;/strong&gt; &lt;em&gt;Parallel Execution&lt;/em&gt;&lt;/p&gt;

&lt;p&gt;What we see in &lt;em&gt;Figure 6&lt;/em&gt; is what we discussed in the Recap; how multiple RTerm and &lt;code&gt;BxlServer.exe&lt;/code&gt; processes ran and handled the data independently. So what does it look like when we use the SQLCC, and we execute the code in &lt;em&gt;Code Snippet 8&lt;/em&gt;, but the compute context's number of tasks is set to 4: &lt;code&gt;numTasks = 4&lt;/code&gt;?&lt;/p&gt;

&lt;p&gt;So to investigate, let us do the following:&lt;/p&gt;

&lt;ul&gt;
&lt;li&gt;Run &lt;em&gt;Process Explorer&lt;/em&gt; as admin.&lt;/li&gt;
&lt;li&gt;Restart the Launchpad service for the SQL Server compute context's instance  (this is to clean-up any RTerm processes).&lt;/li&gt;
&lt;li&gt;Navigate to the &lt;code&gt;Launchpad.exe&lt;/code&gt; process in &lt;em&gt;Process Explorer&lt;/em&gt;.&lt;/li&gt;
&lt;li&gt;Execute the code in &lt;em&gt;Code Snippet 8&lt;/em&gt;, but ensure you have changed &lt;code&gt;numTasks&lt;/code&gt; to 4.&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;While the code is executing, look under the &lt;code&gt;Launchpad.exe&lt;/code&gt; process in &lt;em&gt;Process Explorer&lt;/em&gt; and you see something like so:&lt;/p&gt;

&lt;p&gt;&lt;img class=&quot;center&quot; src=&quot;/images/posts/sql_ml_services_comp_mpi.png&quot; width=&quot;620&quot; height=&quot;500&quot;  &gt;
&lt;strong&gt;Figure 7:&lt;/strong&gt; &lt;em&gt;Parallel Execution in Compute Context&lt;/em&gt;&lt;/p&gt;

&lt;p&gt;Well, that is interesting! In &lt;em&gt;Figure 7&lt;/em&gt; we now see not only the &quot;usual&quot; RTerm and &lt;code&gt;BxlServer.exe&lt;/code&gt; processes but also a new hosting process, outlined in red, &lt;code&gt;mpiexec.exe&lt;/code&gt;. Underneath the &lt;code&gt;mpiexec.exe&lt;/code&gt; process we see the &lt;code&gt;smpd.exe&lt;/code&gt; process (outlined in green) and then four RTerm processes with &lt;code&gt;BxlServer.exe&lt;/code&gt; processes which handle the workload. So, &lt;code&gt;mpiexec.exe&lt;/code&gt; and &lt;code&gt;smpd.exe&lt;/code&gt; are parts of &lt;a href=&quot;https://msdn.microsoft.com/en-us/library/bb524831%28v=vs.85%29.aspx?f=255&amp;amp;MSPPError=-2147217396&quot;&gt;&lt;strong&gt;Microsoft MPI&lt;/strong&gt;&lt;/a&gt; which is an implementation of MPI which is a communication protocol for programming parallel computers. We talk briefly about MPI a bit later in this post, but first, let us understand the flow.&lt;/p&gt;

&lt;h4&gt;Flow&lt;/h4&gt;

&lt;p&gt;We execute &lt;code&gt;sp_execute_external_script&lt;/code&gt; and that &quot;spins up&quot; the usual RTerm and BxlServer process which we discussed in quite a few &lt;a href=&quot;/series/sql_server_2k16_r_services&quot;&gt;Internals&lt;/a&gt; posts. SQL Server creates the compute context via another &lt;code&gt;sp_execute_external_script&lt;/code&gt; call to the Launchpad service.&lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;&lt;strong&gt;NOTE:&lt;/strong&gt; Above I say &lt;em&gt;another &lt;code&gt;sp_execute_external_script&lt;/code&gt; call&lt;/em&gt;, it is in fact two calls. Hopefully a future post covers why and how there are multiple calls&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;The Launchpad service creates the &lt;code&gt;mpiexec.exe&lt;/code&gt; process which in turns creates the &lt;code&gt;smpd.exe&lt;/code&gt; process and the Rterm/BxlServer pairs. If &lt;code&gt;numTasks&lt;/code&gt; is set to 1, the Launchpad service does not create a &lt;code&gt;mpiexec.exe&lt;/code&gt; process, but instead, it creates a Rterm/BxlServer pair.&lt;/p&gt;

&lt;h2&gt;MPI&lt;/h2&gt;

&lt;p&gt;As I mentioned above Microsoft MPI is a Microsoft implementation of the Message Passing Interface standard for developing and running parallel applications on the Windows platform, and it is an integral part of Microsoft HPC (High Performance Computing).&lt;/p&gt;

&lt;h4&gt;mpiexec &amp;amp; smpd&lt;/h4&gt;

&lt;p&gt;The &lt;code&gt;mpiexec&lt;/code&gt; is called from the launchpad service to start the parallel job. The &lt;code&gt;mpiexec&lt;/code&gt; process in turn calls &lt;code&gt;smpd&lt;/code&gt; which is a parallel process manager and it launches/monitors RTerm/BxlServer processes.&lt;/p&gt;

&lt;h2&gt;Summary&lt;/h2&gt;

&lt;ul&gt;
&lt;li&gt;The compute context defines where/what executes a workload.&lt;/li&gt;
&lt;li&gt;RevoScaleR exposes multiple contexts, where SQL Server is one of them.&lt;/li&gt;
&lt;li&gt;You create the SQL Server compute-context by calling &lt;code&gt;RxInSqlServer&lt;/code&gt; followed by &lt;code&gt;rxSetComputeContext&lt;/code&gt;.&lt;/li&gt;
&lt;li&gt;You define how many processes to tun by the &lt;code&gt;RxInSqlServer&lt;/code&gt;'s &lt;code&gt;numTasks&lt;/code&gt; parameter.&lt;/li&gt;
&lt;li&gt;The execution of the code inside the SQLCC is initiated via two &quot;extra&quot; &lt;code&gt;sp_execute_external_script&lt;/code&gt; calls.&lt;/li&gt;
&lt;li&gt;The compute context pushes fragments of the data to the tasks, which processes the data.&lt;/li&gt;
&lt;li&gt;The results are merged back into one result.&lt;/li&gt;
&lt;/ul&gt;


&lt;h2&gt;~ Finally&lt;/h2&gt;

&lt;p&gt;If you have comments, questions etc., please comment on this post or &lt;a href=&quot;mailto:niels.it.berglund@gmail.com&quot;&gt;ping&lt;/a&gt; me.&lt;/p&gt;
</content>
 </entry>
 
 <entry>
   <title>Interesting Stuff - Week 19</title>
   <link href="http://nielsberglund.com/2018/05/13/interesting-stuff-week-19/"/>
   <updated>2018-05-13T20:09:52+02:00</updated>
   <id>http://nielsberglund.com/2018/05/13/interesting-stuff---week-19</id>
   <content type="html">&lt;p&gt;Throughout the week, I read a lot of blog-posts, articles, and so forth, that has to do with things that interest me:&lt;/p&gt;

&lt;ul&gt;
&lt;li&gt;data science&lt;/li&gt;
&lt;li&gt;data in general&lt;/li&gt;
&lt;li&gt;distributed computing&lt;/li&gt;
&lt;li&gt;SQL Server&lt;/li&gt;
&lt;li&gt;transactions (both db as well as non db)&lt;/li&gt;
&lt;li&gt;and other &quot;stuff&quot;&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;This blog-post is the &quot;roundup&quot; of the things that have been most interesting to me, for the week just ending.&lt;/p&gt;

&lt;!--more--&gt;


&lt;h2&gt;Distributed Computing&lt;/h2&gt;

&lt;ul&gt;
&lt;li&gt;&lt;a href=&quot;https://engineering.skybettingandgaming.com/2018/05/04/firedrills-in-core/&quot;&gt;Crash! Bang! Wallop! Practice makes perfect&lt;/a&gt;. A very interesting blog post about how &lt;strong&gt;Sky Betting &amp;amp; Gaming&lt;/strong&gt; conducts &lt;em&gt;Chaos&lt;/em&gt; and &lt;em&gt;Disaster Recovery&lt;/em&gt; testing.&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;https://www.infoq.com/articles/microservices-and-containers-book-review&quot;&gt;Book Review and Q&amp;amp;A: Microservices and Containers by Parminder Singh Kocher&lt;/a&gt;. An &lt;a href=&quot;https://www.infoq.com/&quot;&gt;InfoQ&lt;/a&gt; book review of &lt;strong&gt;Microservices and Containers&lt;/strong&gt;. The book provides a deep dive into the central concepts, patterns and technologies used to implement modern, highly available, highly scalable cloud-native applications.&lt;/li&gt;
&lt;/ul&gt;


&lt;h2&gt;Streaming&lt;/h2&gt;

&lt;ul&gt;
&lt;li&gt;&lt;a href=&quot;https://www.confluent.io/blog/level-up-your-ksql/&quot;&gt;Level Up Your KSQL&lt;/a&gt;. A blog post announcing a video series to skill up on KSQL. This is a must watch if you are interested Kafka!&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;https://azure.microsoft.com/en-us/blog/4-new-features-now-available-in-azure-stream-analytics/&quot;&gt;4 new features now available in Azure Stream Analytics&lt;/a&gt;. This post announces four new features in Azure Stream Analytics. Of the new features, I am most excited about the &lt;code&gt;SessionWindow&lt;/code&gt; feature. The &lt;code&gt;SessionWindow&lt;/code&gt; allows users to filter out periods of time where there is no data. The new feature does this by creating dynamic temporal windows of variable sizes based on the batches of incoming data.&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;https://www.confluent.io/blog/rounding-up-kafka-summit-london-2018/&quot;&gt;Rounding Up Kafka Summit London 2018&lt;/a&gt;. This post is not so much a roundup as an announcement that videos are now available for the recently concluded Kafka 2018 summit. Now I know what to do with all the free time I have - watch Kafka videos!&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;https://azure.microsoft.com/en-us/blog/azure-event-hubs-for-kafka-ecosystems-in-public-preview/&quot;&gt;Azure Event Hubs for Kafka Ecosystems in public preview&lt;/a&gt;. This is so very exciting! The ability to integrate Kafka with Azure Event Hubs.&lt;/li&gt;
&lt;/ul&gt;


&lt;h2&gt;Data Science&lt;/h2&gt;

&lt;ul&gt;
&lt;li&gt;&lt;a href=&quot;https://blogs.msdn.microsoft.com/dotnet/2018/05/07/introducing-ml-net-cross-platform-proven-and-open-source-machine-learning-framework/&quot;&gt;Introducing ML.NET: Cross-platform, Proven and Open Source Machine Learning Framework&lt;/a&gt;. A blog post announcing ML.NET: a cross-platform, open source machine learning framework. ML.NET allows .NET developers to develop their models and infuse custom ML into their applications without prior expertise in developing or tuning machine learning models.&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;http://blog.revolutionanalytics.com/2018/05/open-source-machine-learning-in-azure.html&quot;&gt;Open-Source Machine Learning in Azure&lt;/a&gt;. This post by &lt;a href=&quot;https://twitter.com/revodavid&quot;&gt;David&lt;/a&gt; is about a presentation he gave at Microsoft Build 2018 about how you can take your open-source tools and workflows you already use for machine learning and data science and easily transition them to the Azure cloud to take advantage of its capacity and scale.&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;https://simplystatistics.org/2018/04/30/relationships-in-data-analysis/&quot;&gt;Relationships in Data Analysis&lt;/a&gt;.  A thought-provoking post about how data analysis is very much dependent upon human relationships.&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;https://www.infoq.com/news/2018/05/Azure-Machine-Learning-New&quot;&gt;What’s New in Azure Machine Learning?&lt;/a&gt;. An &lt;a href=&quot;https://www.infoq.com/&quot;&gt;InfoQ&lt;/a&gt; summary from Microsoft Build 2018 about new features in Azure Machine Learning. There are quite a few new cool things coming.&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;https://www.infoq.com/presentations/uber-ml-architecture-models&quot;&gt;Machine Learning Pipeline for Real-time Forecasting @Uber Marketplace&lt;/a&gt;. An &lt;a href=&quot;https://www.infoq.com/&quot;&gt;InfoQ&lt;/a&gt; presentation where [Danny Yuan]  discusses how Uber is using ML to improve their forecasting models, the architecture of their ML platform and lessons learned running it in production. I got so many cool ideas seeing this presentation.&lt;/li&gt;
&lt;/ul&gt;


&lt;h2&gt;Durban Azure User Group&lt;/h2&gt;

&lt;p&gt;Last Wednesday (May 9) The Durban Azure User Group had its monthly meetup, and I did a presentation:&lt;/p&gt;

&lt;ul&gt;
&lt;li&gt;&lt;a href=&quot;https://www.meetup.com/Azure-Transformation-Labs/events/250299101&quot;&gt;Get Insight Into and Analyze Your Data with Azure EventHubs &amp;amp; Stream Analytics&lt;/a&gt;. As the title says, the presentation was bout Azure Event Hubs and Azure Stream Analytics. For you who attended (and everyone else as well), there is a zip file to download &lt;a href=&quot;/downloads/presentations/azureusergroup/azureusergroup_2018-05-09.zip&quot;&gt;here&lt;/a&gt;, which contains the slide deck in pdf format and a text file with various resource links.&lt;/li&gt;
&lt;/ul&gt;


&lt;h2&gt;SQL Server Machine Learning Services&lt;/h2&gt;

&lt;p&gt;I am still working on the post to correct the errors I had in the post; [sp_execute_external_script - III][sext3] in the &lt;a href=&quot;/series/sql_server_2k16_r_services&quot;&gt;SQL Server R Services&lt;/a&gt; series. Please, bear with me!&lt;/p&gt;

&lt;h2&gt;~ Finally&lt;/h2&gt;

&lt;p&gt;That's all for this week. I hope you enjoy what I did put together. If you have ideas for what to cover, please comment on this post or &lt;a href=&quot;mailto:niels.it.berglund@gmail.com&quot;&gt;ping&lt;/a&gt; me.&lt;/p&gt;
</content>
 </entry>
 

</feed>
